<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>videojs-mse-over-clsp Demo</title>
  <link href="http://vjs.zencdn.net/6.2.5/video-js.css" rel="stylesheet">
  <link href="videojs-mse-over-clsp.css" rel="stylesheet">
  <script
    src="https://code.jquery.com/jquery-3.2.1.min.js"
    integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
    crossorigin="anonymous"
  ></script>
  <style>
    video-container {
      width: 356,
      height: 244
    }
  </style>
</head>
<body>
  <table>
    <tr>
      <td class="video-container">
        <video
          id="vw1"
          width="352"
          height="240"
          class="video-js vjs-default-skin"
          controls
        >
          <source
            id="src1"
            src=""
            type="video/mp4; codecs='avc1.42E01E'"
          />
          <source
            id="hls1"
            src=""
            type="application/x-mpegURL"
          />
        </video>
      </td>
      <td class="video-container">
        <video
          id="vw2"
          width="352"
          height="240"
          class="video-js vjs-default-skin"
          controls
        >
          <source
            id="src2"
            src=""
            type="video/mp4; codecs='avc1.42E01E'"
          />
          <source
            id="hls2"
            src=""
            type="application/x-mpegURL"
          />
        </video>
      </td>
    </tr>
    <tr>
      <td class="video-container">
        <video
          id="vw3"
          width="352"
          height="240"
          class="video-js vjs-default-skin"
          controls
        >
          <source
            id="src3"
            src=""
            type="video/mp4; codecs='avc1.42E01E'"
          />
          <source
            id="hls3"
            src=""
            type="application/x-mpegURL"
          />
        </video>
      </td>
      <td  class="video-container">
        <video
          id="vw4"
          width="352"
          height="240"
          class="video-js vjs-default-skin"
          controls
        >
          <source
            id="src4"
            src=""
            type="video/mp4; codecs='avc1.42E01E'"
          />
          <source
            id="hls4"
            src=""
            type="application/x-mpegURL"
          />
        </video>
      </td>
    </tr>

    <tr><td colspan="2"><hr></td></tr>
    <tr>
      <td colspan="2">URL format: clsp://(sfs ip):9001/(stream name)</td>
    </tr>
    <tr><td colspan="2"><hr></td></tr>
    <tr>
      <td>
        <span>CLSP URL</span>
        <input id="url1" style="width: 352;" />
      </td>
      <td>
        <span>Fallback URL</span>
        <input id="fburl1" style="width: 352;" />
      </td>
    </tr>
    <tr>
      <td>
        <span>CLSP URL</span>
        <input id="url2" style="width: 352;" />
      </td>
      <td>
        <span>Fallback URL</span>
        <input id="fburl2" style="width: 352;" />
      </td>
    </tr>
    <tr>
      <td>
        <span>CLSP URL</span>
        <input id="url3" style="width: 352;" />
      </td>
      <td>
        <span>Fallback URL</span>
        <input id="fburl3" style="width: 352;" />
      </td>
    </tr>
    <tr>
      <td>
        <span>CLSP URL</span>
        <input id="url4" style="width: 352;" />
      </td>
      <td>
        <span>Fallback URL</span>
        <input id="fburl4" style="width: 352;" />
      </td>
    </tr>
    <tr>
      <td colspan="2"><button id="submit">Submit</button></td>
    </tr>
    <tr>
      <td colspan="2"><div id="message"></div></td>
    </tr>
  </table>

  <script src="http://vjs.zencdn.net/6.2.5/video.js"></script>
  <script src="https://unpkg.com/videojs-flash/dist/videojs-flash.js"></script>
  <script src="https://unpkg.com/videojs-contrib-hls/dist/videojs-contrib-hls.js"></script>
  <script src="videojs-mse-over-clsp.js"></script>
  <script>
    $('#submit').click(function () {
      $('#message').html('processing video urls...');

      var urlCount = 0;

      for (var i = 1; i <= 4; i++) {
        var url = $('#url' + i).val();
        var fburl = $('#fburl' + i).val();

        if (url || fburl) {
          urlCount++;

          // Set the stream source/s
          $('#src' + i).attr('src', url);
          $('#hls' + i).attr('src', fburl);

          // initialize the video player
          if (url && window.clspPlugin.utils.supported()) {
            console.log('clsp is supported in your browser');
            window.videojs('vw' + i).clsp();
          } else {
            console.error('clsp is NOT supported in your browser');
            window.videojs('vw' + i);
          }
        }
      }

      if (urlCount > 0) {
        $('#message').html('videos configured');
      } else {
        $('#message').html('no video urls found!');
      }
    });
  </script>


  <hr>

<script>

function setupVwallCell(eid, src, cellId) {
    if (document.getElementById(eid) === null) {
        alert("(1) No match for " + eid);
        return;
    }

    // return markup for
    var cell = document.getElementById('cell');
    var html = cell.innerHTML.replace(/\$cellId/g,parseInt(cellId));
    var html = html.replace("$src",src);

    $('#'+eid).html(html);
    $(function(){
        var celm = document.getElementById('video-'+parseInt(cellId));
        if (celm !== null){
            $(function(){
                window.videojs(celm).clsp({
                       onPlayFailed: function(player) {
                           console.log("failed to play");
                           console.log(player);
                       }
                });
            });

            //window.videojs(celm).clsp();
        } else {
            alert("(2) No match for video-"+parseInt(cellId));
        }
    });
}

function setupVwall(eid, urlList) {
    var html = "<table>";
    for(var cellId = 0; cellId < urlList.length; cellId++){
        if (cellId % 4 === 0) {
            html += "<tr>";
        }

        var vwcel = 'vwcell-'+parseInt(cellId);
        html += '<td id="'+vwcel+'"></td>';
        if (cellId % 4 === 3) {
            html += "</tr>";
        }
    }
    if (urlList.length < 4) {
        html += "</tr>";
    }
    html += "</table>";
    console.log(html);
    $('#'+eid).html(html);

    $(function(){
        for(cellId = 0; cellId < urlList.length; cellId++){
            var vwcel = 'vwcell-'+parseInt(cellId);
            var url = urlList[cellId];
            setupVwallCell(vwcel, url, cellId);
        }
    });

}


function onclick() {
    var urlList = [];
    var eid = "videowall";

    var numvideos = $('#numvideos').val();
    for(var i = 0; i < numvideos; i++) {
        urlList.push( $('#url').val() );
    }
    setupVwall(eid,urlList);
}


$(function(){
   $('#walltest').click(onclick);
});

</script>




<div>Url:<input id="url" value="clsp://172.28.12.247:9001/testpattern"></div>
<div>Number of videos: <input id="numvideos" value="4" type="number"></div>
<br>

<button id="walltest">video wall</button>
<div id="videowall">
</div>

<template id="cell">
    <div  class="video-container">
     <video
       id="video-$cellId"
       width="352"
       height="240"
       class="video-js vjs-default-skin"
       controls
       autoplay
     >
       <source id="src-$cellId" src="$src"
              type="video/mp4; codecs='avc1.42E01E'"/>
     </video>
    </div>
</template>



</body>

</html>
