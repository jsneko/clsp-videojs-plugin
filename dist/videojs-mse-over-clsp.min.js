!function(e){function t(s){if(n[s])return n[s].exports;var o=n[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,s){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:s})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(e,t,n){(function(s){function o(){return!("undefined"===typeof window||!window.process||"renderer"!==window.process.type)||("undefined"===typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function i(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),n){var s="color: "+this.color;e.splice(1,0,s,"color: inherit");var o=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(o++,"%c"===e&&(i=o))}),e.splice(i,0,s)}}function r(){return"object"===("undefined"===typeof console?"undefined":u(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function a(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}}function c(){var e;try{e=t.storage.debug}catch(e){}return!e&&"undefined"!==typeof s&&"env"in s&&(e=s.env.DEBUG),e}var u="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t=e.exports=n(12),t.log=r,t.formatArgs=i,t.save=a,t.load=c,t.useColors=o,t.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(c())}).call(t,n(11))},function(e,t){e.exports=videojs},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function i(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function r(){var e=!!window.chrome&&!!window.chrome.webstore,t=!1;return!0===e&&function(){var e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);return e?parseInt(e[2],10):-1}()>=52&&(t=!0),t}Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),c=n.n(a),u=(n(3),n(7)),d=(n.n(u),n(8)),l=(n.n(d),n(9)),h=(n.n(l),n(10)),f=n(22),p=(n.n(f),function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}()),g=c.a.getComponent("Component"),_={},m=function(e){function t(e,n,i){s(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n,i.mqtt));return r.tech_=n,r.source_=e,r.enabled=!1,r.playing=!1,r}return i(t,e),p(t,[{key:"src",value:function(e){if(e){var t=document.createElement("a"),n=e.replace("clsp","http");t.href=n;var s=t.hostname,o=t.port,i=t.pathname.split("/"),r=i[i.length-1];this.useSSL=!1,t.search.substr(1).split("&").forEach(function(e){var t=e.split("="),n=t[0],s=t[1];"secure"===n&&"0"!==s&&(useSSL=!0)}),0===o.length&&(o="9001"),"@"===s&&(s=window.location.hostname),this.mqtt_player=null,this.port=parseInt(o),this.address=s,this.streamName=r,this.enabled=!0,_[e]=this}}},{key:"launchIovPlayer",value:function(e){var t=this,n=this.player().el();new h.a({port:this.port,address:this.address,appStart:function(s){var o=s.player(),i=new CustomEvent("mqttReady");t.player().el().dispatchEvent(i),e(o),n.addEventListener("mse-error-event",function(e){o.restart()},!1)},useSSL:this.useSSL,videoElement:n}).initialize()}}]),t}(g),v=function(e){var t={canPlayType:function(e){var t="";return"MediaSource"in window&&("video/mp4; codecs='avc1.42E01E'"===e?t="maybe":console.log("clsp type='"+e+"' rejected")),t},canHandleSource:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c.a.mergeOptions(c.a.options,n);return e.src?!1===e.src.startsWith("clsp:")?(console.log("srcObj.src is not clsp protocol"),!1):!1===r()?(console.log("Browser not supported. Chrome 52+ is required."),!1):t.canPlayType(e.type):(console.log("srcObj doesn't contain src"),console.log(e),!1)},handleSource:function(t,n){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=c.a.mergeOptions(c.a.options,s,{mqtt:{mode:e}});return n.mqtt=new m(t,n,o),n.mqtt.src(t.src),n.mqtt}};return t};c.a.mqttSupported=!0,c.a.mqttHandler=m,c.a.mqttSourceHandler=v,c.a.getTech("Html5").registerSourceHandler(v("html5"),0);var y={},b=c.a.registerPlugin||c.a.plugin,w=function(e,t){e.addClass("vjs-mse-over-mqtt")},E={},M=function(e){var t=this;if(this.errors({errors:{PLAYER_ERR_NOT_COMPAT:{headline:"This browser is unsupported.",message:"Chrome 52+ is required."}}}),!1===r())return void this.error({code:"PLAYER_ERR_NOT_COMPAT",dismiss:!1});this.on("play",function(e){var t=E[e.target.firstChild.id];if("undefined"===typeof t||!1===t){E[e.target.firstChild.id]=!0;var n=this.player_.loadingSpinner,s=this.player_,o=Object.assign({},s.error());s.error=function(e){if("undefined"===typeof e)return o;null!==e&&-2!==e.code&&s.old_error(e)};var i=this.currentSource();if(i.src in _){var r=_[i.src];r.launchIovPlayer(function(t){function o(){s.controlBar.addClass("vjs-live"),window._ThePlayer=s,s.controlBar.children_[0].el_.addEventListener("click",function(){setTimeout(function(){!0===t.playing?(t.stop(),t.playing=!1,s.controlBar.playToggle.handlePause()):(n.show(),t.resume(function(){setTimeout(function(){n.hide()},0)},function(){s.trigger("timeupdate")}),t.playing=!0,s.controlBar.playToggle.handlePlay())},0)})}null!==t&&!0!==t.playing&&(t.playing=!0,t.play(e.target.firstChild.id,r.streamName,function(){document.getElementById(e.target.id),document.getElementById(e.target.firstChild.id);setTimeout(function(){n.hide(),s.controlBar.playToggle.handlePlay(),o()},0)},function(){s.trigger("timeupdate")}))})}else console.log("src not in lookup table")}}),this.ready(function(){var n=t.children()[0],s=t;n.addEventListener("mqttReady",function(e){null!==n.getAttribute("autoplay")&&s.trigger("play",n)}),w(t,c.a.mergeOptions(y,e))})};b("clsp",M),M.VERSION=l.version,t.default=M},function(e,t,n){"use strict";var s=n(1),o=n.n(s),i=n(4),r=n.n(i),a=o.a.getComponent("Flash"),c=!o.a.browser.IS_IPHONE,u=o.a.registerPlugin||o.a.plugin,d={header:"",code:"",message:"",timeout:45e3,dismiss:c,progressDisabled:!1,errors:{1:{type:"MEDIA_ERR_ABORTED",headline:"The video download was cancelled"},2:{type:"MEDIA_ERR_NETWORK",headline:"The video connection was lost, please confirm you are connected to the internet"},3:{type:"MEDIA_ERR_DECODE",headline:"The video is bad or in a format that cannot be played on your browser"},4:{type:"MEDIA_ERR_SRC_NOT_SUPPORTED",headline:"This video is either unavailable or not supported in this browser"},5:{type:"MEDIA_ERR_ENCRYPTED",headline:"The video you are trying to watch is encrypted and we do not know how to decrypt it"},unknown:{type:"MEDIA_ERR_UNKNOWN",headline:"An unanticipated problem was encountered, check back soon and try again"},"-1":{type:"PLAYER_ERR_NO_SRC",headline:"No video has been loaded"},"-2":{type:"PLAYER_ERR_TIMEOUT",headline:"Could not download the video"},PLAYER_ERR_DOMAIN_RESTRICTED:{headline:"This video is restricted from playing on your current domain"},PLAYER_ERR_IP_RESTRICTED:{headline:"This video is restricted at your current IP address"},PLAYER_ERR_GEO_RESTRICTED:{headline:"This video is restricted from playing in your current geographic region"},FLASHLS_ERR_CROSS_DOMAIN:{headline:"The video could not be loaded: crossdomain access denied."}}},l=function e(t,n){var s=void 0,i=void 0,c=void 0,u=[],l=function(e){n.errors=o.a.mergeOptions(n.errors,e),Object.keys(n.errors).forEach(function(e){var t=n.errors[e];t.type||(t.type=e)})};l();var h=function(){t.clearTimeout(i),c&&(c=!1,t.removeClass("vjs-waiting")),i=t.setTimeout(function(){t.error()||t.paused()||t.ended()||(c=!0,t.addClass("vjs-waiting"))},1e3),t.clearTimeout(s),s=t.setTimeout(function(){t.error()||t.paused()||t.ended()||t.error({code:-2,type:"PLAYER_ERR_TIMEOUT"})},n.timeout),t.error()&&-2===t.error().code&&t.error(null)},f=function(){for(var e=void 0;u.length;)e=u.shift(),t.off(e[0],e[1]);t.clearTimeout(s),t.clearTimeout(i)},p=function(e,n){var s=function(){if(!t.error()){var e=t.$(".vjs-tech");if(e&&"application/x-shockwave-flash"===e.type&&!e.vjs_getProperty)return void t.error({code:-2,type:"PLAYER_ERR_TIMEOUT"});if(t.paused())return h();if(t.ended())return h()}n.call(this)};t.on(e,s),u.push([e,s])},g=function(){var e=0;f(),h(),p(["timeupdate","adtimeupdate"],function(){var n=t.currentTime();n!==e&&(e=n,h())}),n.progressDisabled||p("progress",h)},_=function(){t.currentSrc()||t.error({code:-1,type:"PLAYER_ERR_NO_SRC"})},m=function(){var e="",s=t.error(),i=r.a.createElement("div"),c="";if(s){if(s=o.a.mergeOptions(s,n.errors[s.code||s.type||0]),s.message&&(e='<div class="vjs-errors-details">'+t.localize("Technical details")+'\n        : <div class="vjs-errors-message">'+t.localize(s.message)+"</div>\n        </div>"),4===s.code&&a&&!a.isSupported()){e+='<span class="vjs-errors-flashmessage">'+t.localize("If you are using an older browser please try upgrading or installing Flash.")+"</span>"}var u=t.getChild("errorDisplay");i.className="vjs-errors-dialog",i.id="vjs-errors-dialog",c='<div class="vjs-errors-content-container">\n      <h2 class="vjs-errors-headline">'+this.localize(s.headline)+"</h2>\n        <div><b>"+this.localize("Error Code")+"</b>: "+(s.type||s.code)+"</div>\n        "+e+"\n      </div>";if(u.closeable(!("dismiss"in s)||s.dismiss)){c+='<div class="vjs-errors-ok-button-container">\n          <button class="vjs-errors-ok-button">'+this.localize("OK")+"</button>\n        </div>",i.innerHTML=c,u.fillWith(i),u.contentEl().firstChild.appendChild(u.getChild("closeButton").el());var d=u.el().querySelector(".vjs-errors-ok-button");t.on(d,"click",function(){u.close()})}else i.innerHTML=c,u.fillWith(i);(t.currentWidth()<=600||t.currentHeight()<=250)&&u.addClass("vjs-xs"),u.one("modalclose",function(){return t.error(null)})}},v=function e(){f(),t.removeClass("vjs-errors"),t.off("play",g),t.off("play",_),t.off("dispose",e),t.off(["aderror","error"],m)},y=function(n){v(),e(t,o.a.mergeOptions(d,n))};y.extend=function(e){return l(e)},y.getAll=function(){return o.a.mergeOptions(n.errors)},y.disableProgress=function(e){n.progressDisabled=e,g()},t.on("play",g),t.on("play",_),t.on("dispose",v),t.on(["aderror","error"],m),t.ready(function(){t.addClass("vjs-errors")}),t.errors=y},h=function(e){l(this,o.a.mergeOptions(d,e))};["extend","getAll","disableProgress"].forEach(function(e){h[e]=function(){o.a.log.warn("The errors."+e+"() method is not available until the plugin has been initialized!")}}),u("errors",h)},function(e,t,n){(function(t){var s,o="undefined"!==typeof t?t:"undefined"!==typeof window?window:{},i=n(6);"undefined"!==typeof document?s=document:(s=o["__GLOBAL_DOCUMENT_CACHE@4"])||(s=o["__GLOBAL_DOCUMENT_CACHE@4"]=i),e.exports=s}).call(t,n(5))},function(e,t){var n,s="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"===("undefined"===typeof window?"undefined":s(window))&&(n=window)}e.exports=n},function(e,t){},function(e,t,n){var s,o;"function"===typeof Symbol&&Symbol.iterator;!function(n,i){var r=window.srcDoc;s=[t],void 0!==(o=function(e){i(e,r),n.srcDoc=e}.apply(t,s))&&(e.exports=o)}(this,function(e,t){var n,s,o,i=!!("srcdoc"in document.createElement("iframe")),r="Polyfill may not function in the presence of the `sandbox` attribute. Consider using the `force` option.",a=/\ballow-same-origin\b/,c=function(e,t){var n=e.getAttribute("sandbox");"string"!==typeof n||a.test(n)||(t&&t.force?e.removeAttribute("sandbox"):t&&!1===t.force||(o(r),e.setAttribute("data-srcdoc-polyfill",r)))},u={compliant:function(e,t,n){t&&(c(e,n),e.setAttribute("srcdoc",t))},legacy:function(e,t,n){var s;e&&e.getAttribute&&(t?e.setAttribute("srcdoc",t):t=e.getAttribute("srcdoc"),t&&(c(e,n),s="javascript: window.frameElement.getAttribute('srcdoc');",e.contentWindow&&(e.contentWindow.location=s),e.setAttribute("src",s)))}},d=e;if(o=window.console&&window.console.error?function(e){window.console.error("[srcdoc-polyfill] "+e)}:function(){},d.set=u.compliant,d.noConflict=function(){return window.srcDoc=t,d},!i)for(d.set=u.legacy,s=document.getElementsByTagName("iframe"),n=s.length;n--;)d.set(s[n])})},function(e,t){function n(e,t,n){function s(t){if(null!==e.contentWindow)return void e.contentWindow.postMessage(t,"*");var n=setInterval(function(){null!==e.contentWindow&&(e.contentWindow.postMessage(t,"*"),clearInterval(n))},1e3)}var o={dispatch:{}};return o.onReady=n,o.inboundHandler=function(e){var t=o.dispatch[e.destinationName];if("undefined"!==typeof t)try{t(e)}catch(e){console.log(e)}else console.log("No handler for "+e.destinationName)},o.subscribe=function(e,t){o.dispatch[e]=t,s({method:"subscribe",topic:e})},o.unsubscribe=function(e){e in o.dispatch&&delete o.dispatch[e],s({method:"unsubscribe",topic:e})},o.publish=function(e,t){s({method:"publish",topic:e,data:t})},o.transaction=function(e,n,s){s.resp_topic=t.clientId+"/response/"+parseInt(1e6*Math.random()),o.subscribe(s.resp_topic,function(e){var t=JSON.parse(e.payloadString);n(t),o.unsubscribe(s.resp_topic)}),o.publish(e,s)},o}window.mqttConduit=function(e,t){var s=document.createElement("iframe"),o=e.useSSL?"true":"false",i="<html><head><script>\nvar MqttIp = '"+e.wsbroker+"' ; \nvar MqttPort = "+e.wsport+"; \nvar MqttUseSSL = "+o+"; \nvar MqttClientId = '"+e.clientId+"' ; \nvar Origin = '"+window.location.origin+'\' ; \n/*******************************************************************************\n * Copyright (c) 2013, 2014 IBM Corp.\n *\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * and Eclipse Distribution License v1.0 which accompany this distribution. \n *\n * The Eclipse Public License is available at \n *    http://www.eclipse.org/legal/epl-v10.html\n * and the Eclipse Distribution License is available at \n *   http://www.eclipse.org/org/documents/edl-v10.php.\n *\n *******************************************************************************/\n\n"undefined"===typeof Paho&&(Paho={});\nPaho.MQTT=function(t){function x(a,b,c){b[c++]=a>>8;b[c++]=a%256;return c}function r(a,b,c,h){h=x(b,c,h);E(a,c,h);return h+b}function m(a){for(var b=0,c=0;c<a.length;c++){var h=a.charCodeAt(c);2047<h?(55296<=h&&56319>=h&&(c++,b++),b+=3):127<h?b+=2:b++}return b}function E(a,b,c){for(var h=0;h<a.length;h++){var e=a.charCodeAt(h);if(55296<=e&&56319>=e){var d=a.charCodeAt(++h);if(isNaN(d))throw Error(f(g.MALFORMED_UNICODE,[e,d]));e=(e-55296<<10)+(d-56320)+65536}127>=e?b[c++]=e:(2047>=e?b[c++]=e>>6&31|\n192:(65535>=e?b[c++]=e>>12&15|224:(b[c++]=e>>18&7|240,b[c++]=e>>12&63|128),b[c++]=e>>6&63|128),b[c++]=e&63|128)}return b}function F(a,b,c){for(var h="",e,d=b;d<b+c;){e=a[d++];if(!(128>e)){var p=a[d++]-128;if(0>p)throw Error(f(g.MALFORMED_UTF,[e.toString(16),p.toString(16),""]));if(224>e)e=64*(e-192)+p;else{var s=a[d++]-128;if(0>s)throw Error(f(g.MALFORMED_UTF,[e.toString(16),p.toString(16),s.toString(16)]));if(240>e)e=4096*(e-224)+64*p+s;else{var l=a[d++]-128;if(0>l)throw Error(f(g.MALFORMED_UTF,\n[e.toString(16),p.toString(16),s.toString(16),l.toString(16)]));if(248>e)e=262144*(e-240)+4096*p+64*s+l;else throw Error(f(g.MALFORMED_UTF,[e.toString(16),p.toString(16),s.toString(16),l.toString(16)]));}}}65535<e&&(e-=65536,h+=String.fromCharCode(55296+(e>>10)),e=56320+(e&1023));h+=String.fromCharCode(e)}return h}var z=function(a,b){for(var c in a)if(a.hasOwnProperty(c))if(b.hasOwnProperty(c)){if(typeof a[c]!==b[c])throw Error(f(g.INVALID_TYPE,[typeof a[c],c]));}else{var h="Unknown property, "+c+\n". Valid properties are:";for(c in b)b.hasOwnProperty(c)&&(h=h+" "+c);throw Error(h);}},q=function(a,b){return function(){return a.apply(b,arguments)}},g={OK:{code:0,text:"AMQJSC0000I OK."},CONNECT_TIMEOUT:{code:1,text:"AMQJSC0001E Connect timed out."},SUBSCRIBE_TIMEOUT:{code:2,text:"AMQJS0002E Subscribe timed out."},UNSUBSCRIBE_TIMEOUT:{code:3,text:"AMQJS0003E Unsubscribe timed out."},PING_TIMEOUT:{code:4,text:"AMQJS0004E Ping timed out."},INTERNAL_ERROR:{code:5,text:"AMQJS0005E Internal error. Error Message: {0}, Stack trace: {1}"},\nCONNACK_RETURNCODE:{code:6,text:"AMQJS0006E Bad Connack return code:{0} {1}."},SOCKET_ERROR:{code:7,text:"AMQJS0007E Socket error:{0}."},SOCKET_CLOSE:{code:8,text:"AMQJS0008I Socket closed."},MALFORMED_UTF:{code:9,text:"AMQJS0009E Malformed UTF data:{0} {1} {2}."},UNSUPPORTED:{code:10,text:"AMQJS0010E {0} is not supported by this browser."},INVALID_STATE:{code:11,text:"AMQJS0011E Invalid state {0}."},INVALID_TYPE:{code:12,text:"AMQJS0012E Invalid type {0} for {1}."},INVALID_ARGUMENT:{code:13,text:"AMQJS0013E Invalid argument {0} for {1}."},\nUNSUPPORTED_OPERATION:{code:14,text:"AMQJS0014E Unsupported operation."},INVALID_STORED_DATA:{code:15,text:"AMQJS0015E Invalid data in local storage key\\x3d{0} value\\x3d{1}."},INVALID_MQTT_MESSAGE_TYPE:{code:16,text:"AMQJS0016E Invalid MQTT message type {0}."},MALFORMED_UNICODE:{code:17,text:"AMQJS0017E Malformed Unicode string:{0} {1}."}},I={0:"Connection Accepted",1:"Connection Refused: unacceptable protocol version",2:"Connection Refused: identifier rejected",3:"Connection Refused: server unavailable",\n4:"Connection Refused: bad user name or password",5:"Connection Refused: not authorized"},f=function(a,b){var c=a.text;if(b)for(var h,e,d=0;d<b.length;d++)if(h="{"+d+"}",e=c.indexOf(h),0<e)var g=c.substring(0,e),c=c.substring(e+h.length),c=g+b[d]+c;return c},A=[0,6,77,81,73,115,100,112,3],B=[0,4,77,81,84,84,4],n=function(a,b){this.type=a;for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])};n.prototype.encode=function(){var a=(this.type&15)<<4,b=0,c=[],h=0;void 0!=this.messageIdentifier&&(b+=2);switch(this.type){case 1:switch(this.mqttVersion){case 3:b+=\nA.length+3;break;case 4:b+=B.length+3}b+=m(this.clientId)+2;if(void 0!=this.willMessage){var b=b+(m(this.willMessage.destinationName)+2),e=this.willMessage.payloadBytes;e instanceof Uint8Array||(e=new Uint8Array(g));b+=e.byteLength+2}void 0!=this.userName&&(b+=m(this.userName)+2);void 0!=this.password&&(b+=m(this.password)+2);break;case 8:for(var a=a|2,d=0;d<this.topics.length;d++)c[d]=m(this.topics[d]),b+=c[d]+2;b+=this.requestedQos.length;break;case 10:a|=2;for(d=0;d<this.topics.length;d++)c[d]=\nm(this.topics[d]),b+=c[d]+2;break;case 6:a|=2;break;case 3:this.payloadMessage.duplicate&&(a|=8);a=a|=this.payloadMessage.qos<<1;this.payloadMessage.retained&&(a|=1);var h=m(this.payloadMessage.destinationName),g=this.payloadMessage.payloadBytes,b=b+(h+2)+g.byteLength;g instanceof ArrayBuffer?g=new Uint8Array(g):g instanceof Uint8Array||(g=new Uint8Array(g.buffer))}var f=b,d=Array(1),l=0;do{var y=f%128,f=f>>7;0<f&&(y|=128);d[l++]=y}while(0<f&&4>l);f=d.length+1;b=new ArrayBuffer(b+f);l=new Uint8Array(b);\nl[0]=a;l.set(d,1);if(3==this.type)f=r(this.payloadMessage.destinationName,h,l,f);else if(1==this.type){switch(this.mqttVersion){case 3:l.set(A,f);f+=A.length;break;case 4:l.set(B,f),f+=B.length}a=0;this.cleanSession&&(a=2);void 0!=this.willMessage&&(a=a|4|this.willMessage.qos<<3,this.willMessage.retained&&(a|=32));void 0!=this.userName&&(a|=128);void 0!=this.password&&(a|=64);l[f++]=a;f=x(this.keepAliveInterval,l,f)}void 0!=this.messageIdentifier&&(f=x(this.messageIdentifier,l,f));switch(this.type){case 1:f=\nr(this.clientId,m(this.clientId),l,f);void 0!=this.willMessage&&(f=r(this.willMessage.destinationName,m(this.willMessage.destinationName),l,f),f=x(e.byteLength,l,f),l.set(e,f),f+=e.byteLength);void 0!=this.userName&&(f=r(this.userName,m(this.userName),l,f));void 0!=this.password&&r(this.password,m(this.password),l,f);break;case 3:l.set(g,f);break;case 8:for(d=0;d<this.topics.length;d++)f=r(this.topics[d],c[d],l,f),l[f++]=this.requestedQos[d];break;case 10:for(d=0;d<this.topics.length;d++)f=r(this.topics[d],\nc[d],l,f)}return b};var G=function(a,b,c){this._client=a;this._window=b;this._keepAliveInterval=1E3*c;this.isReset=!1;var h=(new n(12)).encode(),e=function(a){return function(){return d.apply(a)}},d=function(){this.isReset?(this.isReset=!1,this._client._trace("Pinger.doPing","send PINGREQ"),this._client.socket.send(h),this.timeout=this._window.setTimeout(e(this),this._keepAliveInterval)):(this._client._trace("Pinger.doPing","Timed out"),this._client._disconnected(g.PING_TIMEOUT.code,f(g.PING_TIMEOUT)))};\nthis.reset=function(){this.isReset=!0;this._window.clearTimeout(this.timeout);0<this._keepAliveInterval&&(this.timeout=setTimeout(e(this),this._keepAliveInterval))};this.cancel=function(){this._window.clearTimeout(this.timeout)}},C=function(a,b,c,f,e){this._window=b;c||(c=30);this.timeout=setTimeout(function(a,b,c){return function(){return a.apply(b,c)}}(f,a,e),1E3*c);this.cancel=function(){this._window.clearTimeout(this.timeout)}},k=function(a,b,c,h,e){if(!("WebSocket"in t&&null!==t.WebSocket))throw Error(f(g.UNSUPPORTED,\n["WebSocket"]));if(!("localStorage"in t&&null!==t.localStorage))throw Error(f(g.UNSUPPORTED,["localStorage"]));if(!("ArrayBuffer"in t&&null!==t.ArrayBuffer))throw Error(f(g.UNSUPPORTED,["ArrayBuffer"]));this._trace("Paho.MQTT.Client",a,b,c,h,e);this.host=b;this.port=c;this.path=h;this.uri=a;this.clientId=e;this._localKey=b+":"+c+("/mqtt"!=h?":"+h:"")+":"+e+":";this._msg_queue=[];this._sentMessages={};this._receivedMessages={};this._notify_msg_sent={};this._message_identifier=1;this._sequence=0;for(var d in localStorage)0!=\nd.indexOf("Sent:"+this._localKey)&&0!=d.indexOf("Received:"+this._localKey)||this.restore(d)};k.prototype.host;k.prototype.port;k.prototype.path;k.prototype.uri;k.prototype.clientId;k.prototype.socket;k.prototype.connected=!1;k.prototype.maxMessageIdentifier=65536;k.prototype.connectOptions;k.prototype.hostIndex;k.prototype.onConnectionLost;k.prototype.onMessageDelivered;k.prototype.onMessageArrived;k.prototype.traceFunction;k.prototype._msg_queue=null;k.prototype._connectTimeout;k.prototype.sendPinger=\nnull;k.prototype.receivePinger=null;k.prototype.receiveBuffer=null;k.prototype._traceBuffer=null;k.prototype._MAX_TRACE_ENTRIES=100;k.prototype.connect=function(a){var b=this._traceMask(a,"password");this._trace("Client.connect",b,this.socket,this.connected);if(this.connected)throw Error(f(g.INVALID_STATE,["already connected"]));if(this.socket)throw Error(f(g.INVALID_STATE,["already connected"]));this.connectOptions=a;a.uris?(this.hostIndex=0,this._doConnect(a.uris[0])):this._doConnect(this.uri)};\nk.prototype.subscribe=function(a,b){this._trace("Client.subscribe",a,b);if(!this.connected)throw Error(f(g.INVALID_STATE,["not connected"]));var c=new n(8);c.topics=[a];c.requestedQos=void 0!=b.qos?[b.qos]:[0];b.onSuccess&&(c.onSuccess=function(a){b.onSuccess({invocationContext:b.invocationContext,grantedQos:a})});b.onFailure&&(c.onFailure=function(a){b.onFailure({invocationContext:b.invocationContext,errorCode:a})});b.timeout&&(c.timeOut=new C(this,window,b.timeout,b.onFailure,[{invocationContext:b.invocationContext,\nerrorCode:g.SUBSCRIBE_TIMEOUT.code,errorMessage:f(g.SUBSCRIBE_TIMEOUT)}]));this._requires_ack(c);this._schedule_message(c)};k.prototype.unsubscribe=function(a,b){this._trace("Client.unsubscribe",a,b);if(!this.connected)throw Error(f(g.INVALID_STATE,["not connected"]));var c=new n(10);c.topics=[a];b.onSuccess&&(c.callback=function(){b.onSuccess({invocationContext:b.invocationContext})});b.timeout&&(c.timeOut=new C(this,window,b.timeout,b.onFailure,[{invocationContext:b.invocationContext,errorCode:g.UNSUBSCRIBE_TIMEOUT.code,\nerrorMessage:f(g.UNSUBSCRIBE_TIMEOUT)}]));this._requires_ack(c);this._schedule_message(c)};k.prototype.send=function(a){this._trace("Client.send",a);if(!this.connected)throw Error(f(g.INVALID_STATE,["not connected"]));wireMessage=new n(3);wireMessage.payloadMessage=a;0<a.qos?this._requires_ack(wireMessage):this.onMessageDelivered&&(this._notify_msg_sent[wireMessage]=this.onMessageDelivered(wireMessage.payloadMessage));this._schedule_message(wireMessage)};k.prototype.disconnect=function(){this._trace("Client.disconnect");\nif(!this.socket)throw Error(f(g.INVALID_STATE,["not connecting or connected"]));wireMessage=new n(14);this._notify_msg_sent[wireMessage]=q(this._disconnected,this);this._schedule_message(wireMessage)};k.prototype.getTraceLog=function(){if(null!==this._traceBuffer){this._trace("Client.getTraceLog",new Date);this._trace("Client.getTraceLog in flight messages",this._sentMessages.length);for(var a in this._sentMessages)this._trace("_sentMessages ",a,this._sentMessages[a]);for(a in this._receivedMessages)this._trace("_receivedMessages ",\na,this._receivedMessages[a]);return this._traceBuffer}};k.prototype.startTrace=function(){null===this._traceBuffer&&(this._traceBuffer=[]);this._trace("Client.startTrace",new Date,"1.0.2")};k.prototype.stopTrace=function(){delete this._traceBuffer};k.prototype._doConnect=function(a){this.connectOptions.useSSL&&(a=a.split(":"),a[0]="wss",a=a.join(":"));this.connected=!1;this.socket=4>this.connectOptions.mqttVersion?new WebSocket(a,["mqttv3.1"]):new WebSocket(a,["mqtt"]);this.socket.binaryType=\n"arraybuffer";this.socket.onopen=q(this._on_socket_open,this);this.socket.onmessage=q(this._on_socket_message,this);this.socket.onerror=q(this._on_socket_error,this);this.socket.onclose=q(this._on_socket_close,this);this.sendPinger=new G(this,window,this.connectOptions.keepAliveInterval);this.receivePinger=new G(this,window,this.connectOptions.keepAliveInterval);this._connectTimeout=new C(this,window,this.connectOptions.timeout,this._disconnected,[g.CONNECT_TIMEOUT.code,f(g.CONNECT_TIMEOUT)])};k.prototype._schedule_message=\nfunction(a){this._msg_queue.push(a);this.connected&&this._process_queue()};k.prototype.store=function(a,b){var c={type:b.type,messageIdentifier:b.messageIdentifier,version:1};switch(b.type){case 3:b.pubRecReceived&&(c.pubRecReceived=!0);c.payloadMessage={};for(var h="",e=b.payloadMessage.payloadBytes,d=0;d<e.length;d++)h=15>=e[d]?h+"0"+e[d].toString(16):h+e[d].toString(16);c.payloadMessage.payloadHex=h;c.payloadMessage.qos=b.payloadMessage.qos;c.payloadMessage.destinationName=b.payloadMessage.destinationName;\nb.payloadMessage.duplicate&&(c.payloadMessage.duplicate=!0);b.payloadMessage.retained&&(c.payloadMessage.retained=!0);0==a.indexOf("Sent:")&&(void 0===b.sequence&&(b.sequence=++this._sequence),c.sequence=b.sequence);break;default:throw Error(f(g.INVALID_STORED_DATA,[key,c]));}localStorage.setItem(a+this._localKey+b.messageIdentifier,JSON.stringify(c))};k.prototype.restore=function(a){var b=localStorage.getItem(a),c=JSON.parse(b),h=new n(c.type,c);switch(c.type){case 3:for(var b=c.payloadMessage.payloadHex,\ne=new ArrayBuffer(b.length/2),e=new Uint8Array(e),d=0;2<=b.length;){var k=parseInt(b.substring(0,2),16),b=b.substring(2,b.length);e[d++]=k}b=new Paho.MQTT.Message(e);b.qos=c.payloadMessage.qos;b.destinationName=c.payloadMessage.destinationName;c.payloadMessage.duplicate&&(b.duplicate=!0);c.payloadMessage.retained&&(b.retained=!0);h.payloadMessage=b;break;default:throw Error(f(g.INVALID_STORED_DATA,[a,b]));}0==a.indexOf("Sent:"+this._localKey)?(h.payloadMessage.duplicate=!0,this._sentMessages[h.messageIdentifier]=\nh):0==a.indexOf("Received:"+this._localKey)&&(this._receivedMessages[h.messageIdentifier]=h)};k.prototype._process_queue=function(){for(var a=null,b=this._msg_queue.reverse();a=b.pop();)this._socket_send(a),this._notify_msg_sent[a]&&(this._notify_msg_sent[a](),delete this._notify_msg_sent[a])};k.prototype._requires_ack=function(a){var b=Object.keys(this._sentMessages).length;if(b>this.maxMessageIdentifier)throw Error("Too many messages:"+b);for(;void 0!==this._sentMessages[this._message_identifier];)this._message_identifier++;\na.messageIdentifier=this._message_identifier;this._sentMessages[a.messageIdentifier]=a;3===a.type&&this.store("Sent:",a);this._message_identifier===this.maxMessageIdentifier&&(this._message_identifier=1)};k.prototype._on_socket_open=function(){var a=new n(1,this.connectOptions);a.clientId=this.clientId;this._socket_send(a)};k.prototype._on_socket_message=function(a){this._trace("Client._on_socket_message",a.data);a=this._deframeMessages(a.data);for(var b=0;b<a.length;b+=1)this._handleMessage(a[b])};\nk.prototype._deframeMessages=function(a){a=new Uint8Array(a);if(this.receiveBuffer){var b=new Uint8Array(this.receiveBuffer.length+a.length);b.set(this.receiveBuffer);b.set(a,this.receiveBuffer.length);a=b;delete this.receiveBuffer}try{for(var b=0,c=[];b<a.length;){var h;a:{var e=a,d=b,k=d,s=e[d],l=s>>4,y=s&15,d=d+1,u=void 0,D=0,m=1;do{if(d==e.length){h=[null,k];break a}u=e[d++];D+=(u&127)*m;m*=128}while(0!=(u&128));u=d+D;if(u>e.length)h=[null,k];else{var v=new n(l);switch(l){case 2:e[d++]&1&&(v.sessionPresent=\n!0);v.returnCode=e[d++];break;case 3:var k=y>>1&3,r=256*e[d]+e[d+1],d=d+2,t=F(e,d,r),d=d+r;0<k&&(v.messageIdentifier=256*e[d]+e[d+1],d+=2);var q=new Paho.MQTT.Message(e.subarray(d,u));1==(y&1)&&(q.retained=!0);8==(y&8)&&(q.duplicate=!0);q.qos=k;q.destinationName=t;v.payloadMessage=q;break;case 4:case 5:case 6:case 7:case 11:v.messageIdentifier=256*e[d]+e[d+1];break;case 9:v.messageIdentifier=256*e[d]+e[d+1],d+=2,v.returnCode=e.subarray(d,u)}h=[v,u]}}var w=h[0],b=h[1];if(null!==w)c.push(w);else break}b<\na.length&&(this.receiveBuffer=a.subarray(b))}catch(x){this._disconnected(g.INTERNAL_ERROR.code,f(g.INTERNAL_ERROR,[x.message,x.stack.toString()]));return}return c};k.prototype._handleMessage=function(a){this._trace("Client._handleMessage",a);try{switch(a.type){case 2:this._connectTimeout.cancel();if(this.connectOptions.cleanSession){for(var b in this._sentMessages){var c=this._sentMessages[b];localStorage.removeItem("Sent:"+this._localKey+c.messageIdentifier)}this._sentMessages={};for(b in this._receivedMessages){var h=\nthis._receivedMessages[b];localStorage.removeItem("Received:"+this._localKey+h.messageIdentifier)}this._receivedMessages={}}if(0===a.returnCode)this.connected=!0,this.connectOptions.uris&&(this.hostIndex=this.connectOptions.uris.length);else{this._disconnected(g.CONNACK_RETURNCODE.code,f(g.CONNACK_RETURNCODE,[a.returnCode,I[a.returnCode]]));break}a=[];for(var e in this._sentMessages)this._sentMessages.hasOwnProperty(e)&&a.push(this._sentMessages[e]);a=a.sort(function(a,b){return a.sequence-b.sequence});\ne=0;for(var d=a.length;e<d;e++)if(c=a[e],3==c.type&&c.pubRecReceived){var k=new n(6,{messageIdentifier:c.messageIdentifier});this._schedule_message(k)}else this._schedule_message(c);if(this.connectOptions.onSuccess)this.connectOptions.onSuccess({invocationContext:this.connectOptions.invocationContext});this._process_queue();break;case 3:this._receivePublish(a);break;case 4:if(c=this._sentMessages[a.messageIdentifier])if(delete this._sentMessages[a.messageIdentifier],localStorage.removeItem("Sent:"+\nthis._localKey+a.messageIdentifier),this.onMessageDelivered)this.onMessageDelivered(c.payloadMessage);break;case 5:if(c=this._sentMessages[a.messageIdentifier])c.pubRecReceived=!0,k=new n(6,{messageIdentifier:a.messageIdentifier}),this.store("Sent:",c),this._schedule_message(k);break;case 6:h=this._receivedMessages[a.messageIdentifier];localStorage.removeItem("Received:"+this._localKey+a.messageIdentifier);h&&(this._receiveMessage(h),delete this._receivedMessages[a.messageIdentifier]);var m=new n(7,\n{messageIdentifier:a.messageIdentifier});this._schedule_message(m);break;case 7:c=this._sentMessages[a.messageIdentifier];delete this._sentMessages[a.messageIdentifier];localStorage.removeItem("Sent:"+this._localKey+a.messageIdentifier);if(this.onMessageDelivered)this.onMessageDelivered(c.payloadMessage);break;case 9:if(c=this._sentMessages[a.messageIdentifier]){c.timeOut&&c.timeOut.cancel();if(128===a.returnCode[0]){if(c.onFailure)c.onFailure(a.returnCode)}else if(c.onSuccess)c.onSuccess(a.returnCode);\ndelete this._sentMessages[a.messageIdentifier]}break;case 11:if(c=this._sentMessages[a.messageIdentifier])c.timeOut&&c.timeOut.cancel(),c.callback&&c.callback(),delete this._sentMessages[a.messageIdentifier];break;case 13:this.sendPinger.reset();break;case 14:this._disconnected(g.INVALID_MQTT_MESSAGE_TYPE.code,f(g.INVALID_MQTT_MESSAGE_TYPE,[a.type]));break;default:this._disconnected(g.INVALID_MQTT_MESSAGE_TYPE.code,f(g.INVALID_MQTT_MESSAGE_TYPE,[a.type]))}}catch(l){this._disconnected(g.INTERNAL_ERROR.code,\nf(g.INTERNAL_ERROR,[l.message,l.stack.toString()]))}};k.prototype._on_socket_error=function(a){this._disconnected(g.SOCKET_ERROR.code,f(g.SOCKET_ERROR,[a.data]))};k.prototype._on_socket_close=function(){this._disconnected(g.SOCKET_CLOSE.code,f(g.SOCKET_CLOSE))};k.prototype._socket_send=function(a){if(1==a.type){var b=this._traceMask(a,"password");this._trace("Client._socket_send",b)}else this._trace("Client._socket_send",a);this.socket.send(a.encode());this.sendPinger.reset()};k.prototype._receivePublish=\nfunction(a){switch(a.payloadMessage.qos){case "undefined":case 0:this._receiveMessage(a);break;case 1:var b=new n(4,{messageIdentifier:a.messageIdentifier});this._schedule_message(b);this._receiveMessage(a);break;case 2:this._receivedMessages[a.messageIdentifier]=a;this.store("Received:",a);a=new n(5,{messageIdentifier:a.messageIdentifier});this._schedule_message(a);break;default:throw Error("Invaild qos\\x3d"+wireMmessage.payloadMessage.qos);}};k.prototype._receiveMessage=function(a){if(this.onMessageArrived)this.onMessageArrived(a.payloadMessage)};\nk.prototype._disconnected=function(a,b){this._trace("Client._disconnected",a,b);this.sendPinger.cancel();this.receivePinger.cancel();this._connectTimeout&&this._connectTimeout.cancel();this._msg_queue=[];this._notify_msg_sent={};this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,1===this.socket.readyState&&this.socket.close(),delete this.socket);if(this.connectOptions.uris&&this.hostIndex<this.connectOptions.uris.length-1)this.hostIndex++,\nthis._doConnect(this.connectOptions.uris[this.hostIndex]);else if(void 0===a&&(a=g.OK.code,b=f(g.OK)),this.connected){if(this.connected=!1,this.onConnectionLost)this.onConnectionLost({errorCode:a,errorMessage:b})}else if(4===this.connectOptions.mqttVersion&&!1===this.connectOptions.mqttVersionExplicit)this._trace("Failed to connect V4, dropping back to V3"),this.connectOptions.mqttVersion=3,this.connectOptions.uris?(this.hostIndex=0,this._doConnect(this.connectOptions.uris[0])):this._doConnect(this.uri);\nelse if(this.connectOptions.onFailure)this.connectOptions.onFailure({invocationContext:this.connectOptions.invocationContext,errorCode:a,errorMessage:b})};k.prototype._trace=function(){if(this.traceFunction){for(var a in arguments)"undefined"!==typeof arguments[a]&&(arguments[a]=JSON.stringify(arguments[a]));a=Array.prototype.slice.call(arguments).join("");this.traceFunction({severity:"Debug",message:a})}if(null!==this._traceBuffer){a=0;for(var b=arguments.length;a<b;a++)this._traceBuffer.length==\nthis._MAX_TRACE_ENTRIES&&this._traceBuffer.shift(),0===a?this._traceBuffer.push(arguments[a]):"undefined"===typeof arguments[a]?this._traceBuffer.push(arguments[a]):this._traceBuffer.push("  "+JSON.stringify(arguments[a]))}};k.prototype._traceMask=function(a,b){var c={},f;for(f in a)a.hasOwnProperty(f)&&(c[f]=f==b?"******":a[f]);return c};var H=function(a,b,c,h){var e;if("string"!==typeof a)throw Error(f(g.INVALID_TYPE,[typeof a,"host"]));if(2==arguments.length){h=b;e=a;var d=e.match(/^(wss?):\\/\\/((\\[(.+)\\])|([^\\/]+?))(:(\\d+))?(\\/.*)$/);\nif(d)a=d[4]||d[2],b=parseInt(d[7]),c=d[8];else throw Error(f(g.INVALID_ARGUMENT,[a,"host"]));}else{3==arguments.length&&(h=c,c="/mqtt");if("number"!==typeof b||0>b)throw Error(f(g.INVALID_TYPE,[typeof b,"port"]));if("string"!==typeof c)throw Error(f(g.INVALID_TYPE,[typeof c,"path"]));e="ws://"+(-1!=a.indexOf(":")&&"["!=a.slice(0,1)&&"]"!=a.slice(-1)?"["+a+"]":a)+":"+b+c}for(var p=d=0;p<h.length;p++){var m=h.charCodeAt(p);55296<=m&&56319>=m&&p++;d++}if("string"!==typeof h||65535<d)throw Error(f(g.INVALID_ARGUMENT,\n[h,"clientId"]));var l=new k(e,a,b,c,h);this._getHost=function(){return a};this._setHost=function(){throw Error(f(g.UNSUPPORTED_OPERATION));};this._getPort=function(){return b};this._setPort=function(){throw Error(f(g.UNSUPPORTED_OPERATION));};this._getPath=function(){return c};this._setPath=function(){throw Error(f(g.UNSUPPORTED_OPERATION));};this._getURI=function(){return e};this._setURI=function(){throw Error(f(g.UNSUPPORTED_OPERATION));};this._getClientId=function(){return l.clientId};this._setClientId=\nfunction(){throw Error(f(g.UNSUPPORTED_OPERATION));};this._getOnConnectionLost=function(){return l.onConnectionLost};this._setOnConnectionLost=function(a){if("function"===typeof a)l.onConnectionLost=a;else throw Error(f(g.INVALID_TYPE,[typeof a,"onConnectionLost"]));};this._getOnMessageDelivered=function(){return l.onMessageDelivered};this._setOnMessageDelivered=function(a){if("function"===typeof a)l.onMessageDelivered=a;else throw Error(f(g.INVALID_TYPE,[typeof a,"onMessageDelivered"]));};this._getOnMessageArrived=\nfunction(){return l.onMessageArrived};this._setOnMessageArrived=function(a){if("function"===typeof a)l.onMessageArrived=a;else throw Error(f(g.INVALID_TYPE,[typeof a,"onMessageArrived"]));};this._getTrace=function(){return l.traceFunction};this._setTrace=function(a){if("function"===typeof a)l.traceFunction=a;else throw Error(f(g.INVALID_TYPE,[typeof a,"onTrace"]));};this.connect=function(a){a=a||{};z(a,{timeout:"number",userName:"string",password:"string",willMessage:"object",keepAliveInterval:"number",\ncleanSession:"boolean",useSSL:"boolean",invocationContext:"object",onSuccess:"function",onFailure:"function",hosts:"object",ports:"object",mqttVersion:"number",mqttVersionExplicit:"boolean",uris:"object"});void 0===a.keepAliveInterval&&(a.keepAliveInterval=60);if(4<a.mqttVersion||3>a.mqttVersion)throw Error(f(g.INVALID_ARGUMENT,[a.mqttVersion,"connectOptions.mqttVersion"]));void 0===a.mqttVersion?(a.mqttVersionExplicit=!1,a.mqttVersion=4):a.mqttVersionExplicit=!0;if(void 0!==a.password&&void 0===\na.userName)throw Error(f(g.INVALID_ARGUMENT,[a.password,"connectOptions.password"]));if(a.willMessage){if(!(a.willMessage instanceof w))throw Error(f(g.INVALID_TYPE,[a.willMessage,"connectOptions.willMessage"]));a.willMessage.stringPayload;if("undefined"===typeof a.willMessage.destinationName)throw Error(f(g.INVALID_TYPE,[typeof a.willMessage.destinationName,"connectOptions.willMessage.destinationName"]));}"undefined"===typeof a.cleanSession&&(a.cleanSession=!0);if(a.hosts){if(!(a.hosts instanceof\nArray))throw Error(f(g.INVALID_ARGUMENT,[a.hosts,"connectOptions.hosts"]));if(1>a.hosts.length)throw Error(f(g.INVALID_ARGUMENT,[a.hosts,"connectOptions.hosts"]));for(var b=!1,d=0;d<a.hosts.length;d++){if("string"!==typeof a.hosts[d])throw Error(f(g.INVALID_TYPE,[typeof a.hosts[d],"connectOptions.hosts["+d+"]"]));if(/^(wss?):\\/\\/((\\[(.+)\\])|([^\\/]+?))(:(\\d+))?(\\/.*)$/.test(a.hosts[d]))if(0==d)b=!0;else{if(!b)throw Error(f(g.INVALID_ARGUMENT,[a.hosts[d],"connectOptions.hosts["+d+"]"]));}else if(b)throw Error(f(g.INVALID_ARGUMENT,\n[a.hosts[d],"connectOptions.hosts["+d+"]"]));}if(b)a.uris=a.hosts;else{if(!a.ports)throw Error(f(g.INVALID_ARGUMENT,[a.ports,"connectOptions.ports"]));if(!(a.ports instanceof Array))throw Error(f(g.INVALID_ARGUMENT,[a.ports,"connectOptions.ports"]));if(a.hosts.length!=a.ports.length)throw Error(f(g.INVALID_ARGUMENT,[a.ports,"connectOptions.ports"]));a.uris=[];for(d=0;d<a.hosts.length;d++){if("number"!==typeof a.ports[d]||0>a.ports[d])throw Error(f(g.INVALID_TYPE,[typeof a.ports[d],"connectOptions.ports["+\nd+"]"]));var b=a.hosts[d],h=a.ports[d];e="ws://"+(-1!=b.indexOf(":")?"["+b+"]":b)+":"+h+c;a.uris.push(e)}}}l.connect(a)};this.subscribe=function(a,b){if("string"!==typeof a)throw Error("Invalid argument:"+a);b=b||{};z(b,{qos:"number",invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"});if(b.timeout&&!b.onFailure)throw Error("subscribeOptions.timeout specified with no onFailure callback.");if("undefined"!==typeof b.qos&&0!==b.qos&&1!==b.qos&&2!==b.qos)throw Error(f(g.INVALID_ARGUMENT,\n[b.qos,"subscribeOptions.qos"]));l.subscribe(a,b)};this.unsubscribe=function(a,b){if("string"!==typeof a)throw Error("Invalid argument:"+a);b=b||{};z(b,{invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"});if(b.timeout&&!b.onFailure)throw Error("unsubscribeOptions.timeout specified with no onFailure callback.");l.unsubscribe(a,b)};this.send=function(a,b,c,d){var e;if(0==arguments.length)throw Error("Invalid argument.length");if(1==arguments.length){if(!(a instanceof\nw)&&"string"!==typeof a)throw Error("Invalid argument:"+typeof a);e=a;if("undefined"===typeof e.destinationName)throw Error(f(g.INVALID_ARGUMENT,[e.destinationName,"Message.destinationName"]));}else e=new w(b),e.destinationName=a,3<=arguments.length&&(e.qos=c),4<=arguments.length&&(e.retained=d);l.send(e)};this.disconnect=function(){l.disconnect()};this.getTraceLog=function(){return l.getTraceLog()};this.startTrace=function(){l.startTrace()};this.stopTrace=function(){l.stopTrace()};this.isConnected=\nfunction(){return l.connected}};H.prototype={get host(){return this._getHost()},set host(a){this._setHost(a)},get port(){return this._getPort()},set port(a){this._setPort(a)},get path(){return this._getPath()},set path(a){this._setPath(a)},get clientId(){return this._getClientId()},set clientId(a){this._setClientId(a)},get onConnectionLost(){return this._getOnConnectionLost()},set onConnectionLost(a){this._setOnConnectionLost(a)},get onMessageDelivered(){return this._getOnMessageDelivered()},set onMessageDelivered(a){this._setOnMessageDelivered(a)},\nget onMessageArrived(){return this._getOnMessageArrived()},set onMessageArrived(a){this._setOnMessageArrived(a)},get trace(){return this._getTrace()},set trace(a){this._setTrace(a)}};var w=function(a){var b;if("string"===typeof a||a instanceof ArrayBuffer||a instanceof Int8Array||a instanceof Uint8Array||a instanceof Int16Array||a instanceof Uint16Array||a instanceof Int32Array||a instanceof Uint32Array||a instanceof Float32Array||a instanceof Float64Array)b=a;else throw f(g.INVALID_ARGUMENT,[a,"newPayload"]);\nthis._getPayloadString=function(){return"string"===typeof b?b:F(b,0,b.length)};this._getPayloadBytes=function(){if("string"===typeof b){var a=new ArrayBuffer(m(b)),a=new Uint8Array(a);E(b,a,0);return a}return b};var c=void 0;this._getDestinationName=function(){return c};this._setDestinationName=function(a){if("string"===typeof a)c=a;else throw Error(f(g.INVALID_ARGUMENT,[a,"newDestinationName"]));};var h=0;this._getQos=function(){return h};this._setQos=function(a){if(0===a||1===a||2===a)h=a;else throw Error("Invalid argument:"+\na);};var e=!1;this._getRetained=function(){return e};this._setRetained=function(a){if("boolean"===typeof a)e=a;else throw Error(f(g.INVALID_ARGUMENT,[a,"newRetained"]));};var d=!1;this._getDuplicate=function(){return d};this._setDuplicate=function(a){d=a}};w.prototype={get payloadString(){return this._getPayloadString()},get payloadBytes(){return this._getPayloadBytes()},get destinationName(){return this._getDestinationName()},set destinationName(a){this._setDestinationName(a)},get qos(){return this._getQos()},\nset qos(a){this._setQos(a)},get retained(){return this._getRetained()},set retained(a){this._setRetained(a)},get duplicate(){return this._getDuplicate()},set duplicate(a){this._setDuplicate(a)}};return{Client:H,Message:w}}(window);\nfunction _clspRouter() {\n    function send(m){\n        // route message to parent which will in turn route to the correct\n        // player based on clientId.\n        m.clientId = MqttClientId;\n        // console.log(m);\n        window.parent.postMessage(m,"*");\n    }// end send\n\n\n    function routeInbound(message){\n        var pstring = "";\n\n        try {\n            pstring = message.payloadString;\n        } catch(e) {\n            //bogus excepton?\n        }\n\n        send({\n          event: \'data\',\n          destinationName: message.destinationName,\n          payloadString: pstring,\n          payloadBytes: message.payloadBytes || null\n        });\n    }// end route inbound\n\n\n    function eventHandler(evt){\n        var m = evt.data;\n\n        try {\n            if (m.method === \'subscribe\') {\n                MQTTClient.subscribe(m.topic);\n            } else if (m.method === \'unsubscribe\') {\n                MQTTClient.unsubscribe(m.topic);\n            } else if (m.method === \'publish\') {\n                var mqtt_payload = null;\n                try {\n                    mqtt_payload = JSON.stringify(m.data);\n                } catch( json_error ) {\n                    console.log("json stringify error: " + m.data);\n                    return;\n                }\n\n                var mqtt_msg = new Paho.MQTT.Message(mqtt_payload);\n                mqtt_msg.destinationName = m.topic;\n                MQTTClient.send(mqtt_msg);\n            }\n        } catch(e) {\n            console.log("mqtt fatal error");\n            console.log(e);\n            // we are dead!\n            MQTTClient.disconnect();\n        }\n    }\n\n    function AppReady() {\n        if (window.addEventListener) {\n            window.addEventListener("message", eventHandler, false);\n        } else if (window.attachEvent) {\n            window.attachEvent(\'onmessage\', eventHandler);\n        }\n\n        send({\n          event: \'ready\'\n        });\n    }// application ready\n\n\n    function AppFail(message) {\n      var e = "Error code " +\n          parseInt(message.errorCode) + ": " + message.errorMessage;\n      send({\n        event: \'fail\',\n        reason: e\n      });\n    }\n\n    MQTTClient = new Paho.MQTT.Client(\n        MqttIp,\n        MqttPort,\n        MqttClientId\n    );\n\n    // perhaps the busiest function in this module ;)\n    MQTTClient.onMessageArrived = function(message) {\n        //// console.log(message);\n        try {\n             routeInbound(message);\n        }catch(e) {\n            if (e) {\n                // console.log("Exception");\n                console.log(e);\n            }\n        }\n    };\n\n    // setup connection options\n    var options = {\n        timeout: 60,\n        onSuccess:  AppReady,\n        onFailure: AppFail\n    };\n    // last will message sent on disconnect\n    var willmsg = new Paho.MQTT.Message(JSON.stringify({\n        clientId: MqttClientId\n    }));\n    willmsg.destinationName = "iov/clientDisconnect";\n    options.willMessage = willmsg;\n\n    if (MqttUseSSL === true) {\n        options.useSSL = true;\n    }\n\n\n    MQTTClient.connect(options);\n}\n\nfunction clspRouter() {\n    try {\n        _clspRouter();\n    } catch(e) {\n        console.log("IFRAME error");\n        console.log(e);\n    }\n}\n\nfunction onunload()\n{\n    if (typeof MQTTClient !== \'undefined\') {\n        MQTTClient.disconnect();\n    }\n}\n\n<\/script>\n</head><body onload="clspRouter();" onunload="onunload();"><body><div id="message"></div></body></html>';if("undefined"!==typeof s.srcdoc?s.srcdoc=i:window.srcDoc(s,i),s.width=0,s.height=0,s.setAttribute("style","display:none;"),s.setAttribute("id",e.clientId),null!==e.videoElement.parentNode)e.videoElement.parentNode.appendChild(s);else var r=setInterval(function(){null!==e.videoElement.parentNode&&(e.videoElement.parentNode.appendChild(s),clearInterval(r))},1e3);return n(s,e,t)}},function(e,t){e.exports={name:"videojs-mse-over-clsp",version:"0.1.8",description:"Uses clsp (iot) as a video distribution system, video is is received via the clsp client then rendered using the media source extensions. ",main:"dist/videojs-mse-over-clsp.js","generator-videojs-plugin":{version:"5.0.0"},scripts:{build:"gulp build",postversion:"git push && git push --tags","start-dev":"webpack-dev-server"},keywords:["videojs","videojs-plugin"],author:"dschere@skylinenet.net",license:"MIT",dependencies:{debug:"^3.1.0","paho-mqtt":"1.0.3","videojs-errors":"^3.0.3"},devDependencies:{"babel-core":"^6.26.0","babel-eslint":"^8.0.1","babel-loader":"^7.1.2","babel-plugin-transform-class-properties":"^6.24.1","babel-plugin-transform-object-rest-spread":"^6.26.0","babel-polyfill":"^6.26.0","babel-preset-env":"^1.6.0","css-loader":"^0.28.5","extract-text-webpack-plugin":"^3.0.0",gulp:"^3.9.1","gulp-load-plugins":"^1.5.0","gulp-rm":"^1.0.5","js-string-escape":"^1.0.1","node-sass":"^4.5.3","run-sequence":"^2.2.0","sass-loader":"^6.0.6","style-loader":"^0.18.2",webpack:"^3.1.0","webpack-dev-server":"^2.7.1"}}},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=n(0),i=n.n(o),r=n(14),a=n.n(r),c=n(17),u=n(18),d=n(19),l=n(20),h=n(21),f=(n.n(h),function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}()),p="clsp:iov",g=function(){function e(t){s(this,e),this.id=a()(),this.debug=i()(p+":"+this.id+":main"),this.config={wsbroker:t.address,wsport:t.port,clientId:this.id,appStart:t.appStart,useSSL:t.useSSL||!1,videoElement:t.videoElement},this.mqttTopicHandlers=new c.a(this.id,this),this.mqttConduitCollection=new u.a(this.id),this.transport=new d.a(this.id,this),this.events={connection_lost:function(e){console.log("MQTT connection lost"),console.log(e)},on_message:this.mqttTopicHandlers.msghandler,exception:function(e,t){console.log(e),"undefined"!==typeof t&&console.log(t.stack)}}}return f(e,null,[{key:"compatibilityCheck",value:function(){var e=!1;window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.MediaSource||(!1===e&&alert("Media Source Extensions not supported in your browser: Claris Live Streaming will not work!"),e=!0)}}]),f(e,[{key:"initialize",value:function(){var t=this;e.compatibilityCheck(),window.addEventListener("message",function(e){t.debug("message received",e.data);var n=e.data.clientId;if(t.mqttConduitCollection.exists(n)){var s=t.mqttConduitCollection.getById(n),o=e.data.event;switch(o){case"data":s.inboundHandler(e.data);break;case"ready":s.onReady();break;case"fail":console.error("network error",e.reason);break;default:console.log("No match for event = "+o)}}})}},{key:"player",value:function(){return Object(l.a)(this)}},{key:"getAvailableStreams",value:function(e){this.transport.transaction("iov/video/list",e,{})}}]),e}();t.a=g},function(e,t){function n(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(d===setTimeout)return setTimeout(e,0);if((d===n||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(t){try{return d.call(null,e,0)}catch(t){return d.call(this,e,0)}}}function i(e){if(l===clearTimeout)return clearTimeout(e);if((l===s||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{return l(e)}catch(t){try{return l.call(null,e)}catch(t){return l.call(this,e)}}}function r(){g&&f&&(g=!1,f.length?p=f.concat(p):_=-1,p.length&&a())}function a(){if(!g){var e=o(r);g=!0;for(var t=p.length;t;){for(f=p,p=[];++_<t;)f&&f[_].run();_=-1,t=p.length}f=null,g=!1,i(e)}}function c(e,t){this.fun=e,this.array=t}function u(){}var d,l,h=e.exports={};!function(){try{d="function"===typeof setTimeout?setTimeout:n}catch(e){d=n}try{l="function"===typeof clearTimeout?clearTimeout:s}catch(e){l=s}}();var f,p=[],g=!1,_=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];p.push(new c(e,t)),1!==p.length||g||o(a)},c.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=u,h.addListener=u,h.once=u,h.off=u,h.removeListener=u,h.removeAllListeners=u,h.emit=u,h.prependListener=u,h.prependOnceListener=u,h.listeners=function(e){return[]},h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(e,t,n){function s(e){var n,s=0;for(n in e)s=(s<<5)-s+e.charCodeAt(n),s|=0;return t.colors[Math.abs(s)%t.colors.length]}function o(e){function n(){if(n.enabled){var e=n,s=+new Date,i=s-(o||s);e.diff=i,e.prev=o,e.curr=s,o=s;for(var r=new Array(arguments.length),a=0;a<r.length;a++)r[a]=arguments[a];r[0]=t.coerce(r[0]),"string"!==typeof r[0]&&r.unshift("%O");var c=0;r[0]=r[0].replace(/%([a-zA-Z%])/g,function(n,s){if("%%"===n)return n;c++;var o=t.formatters[s];if("function"===typeof o){var i=r[c];n=o.call(e,i),r.splice(c,1),c--}return n}),t.formatArgs.call(e,r);(n.log||t.log||console.log.bind(console)).apply(e,r)}}var o;return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=s(e),n.destroy=i,"function"===typeof t.init&&t.init(n),t.instances.push(n),n}function i(){var e=t.instances.indexOf(this);return-1!==e&&(t.instances.splice(e,1),!0)}function r(e){t.save(e),t.names=[],t.skips=[];var n,s=("string"===typeof e?e:"").split(/[\s,]+/),o=s.length;for(n=0;n<o;n++)s[n]&&(e=s[n].replace(/\*/g,".*?"),"-"===e[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")));for(n=0;n<t.instances.length;n++){var i=t.instances[n];i.enabled=t.enabled(i.namespace)}}function a(){t.enable("")}function c(e){if("*"===e[e.length-1])return!0;var n,s;for(n=0,s=t.skips.length;n<s;n++)if(t.skips[n].test(e))return!1;for(n=0,s=t.names.length;n<s;n++)if(t.names[n].test(e))return!0;return!1}function u(e){return e instanceof Error?e.stack||e.message:e}t=e.exports=o.debug=o.default=o,t.coerce=u,t.disable=a,t.enable=r,t.enabled=c,t.humanize=n(13),t.instances=[],t.names=[],t.skips=[],t.formatters={}},function(e,t){function n(e){if(e=String(e),!(e.length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*l;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*u;case"minutes":case"minute":case"mins":case"min":case"m":return n*c;case"seconds":case"second":case"secs":case"sec":case"s":return n*a;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function s(e){return e>=d?Math.round(e/d)+"d":e>=u?Math.round(e/u)+"h":e>=c?Math.round(e/c)+"m":e>=a?Math.round(e/a)+"s":e+"ms"}function o(e){return i(e,d,"day")||i(e,u,"hour")||i(e,c,"minute")||i(e,a,"second")||e+" ms"}function i(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=1e3,c=60*a,u=60*c,d=24*u,l=365.25*d;e.exports=function(e,t){t=t||{};var i="undefined"===typeof e?"undefined":r(e);if("string"===i&&e.length>0)return n(e);if("number"===i&&!1===isNaN(e))return t.long?o(e):s(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){function s(e,t,n){var s=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null),e=e||{};var r=e.random||(e.rng||o)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t)for(var a=0;a<16;++a)t[s+a]=r[a];return t||i(r)}var o=n(15),i=n(16);e.exports=s},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(n){var s=new Uint8Array(16);e.exports=function(){return n(s),s}}else{var o=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0===(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},function(e,t){function n(e,t){var n=t||0,o=s;return o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+"-"+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]+o[e[n++]]}for(var s=[],o=0;o<256;++o)s[o]=(o+256).toString(16).substr(1);e.exports=n},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=n(0),i=n.n(o),r=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),a="clsp:iov",c=function(){function e(t,n){s(this,e),this.id=t,this.debug=i()(a+":"+this.id+":MqttTopicHandlers"),this.debug("constructing..."),this.iov=n,this._handlers={}}return r(e,[{key:"get",value:function(e){return this.debug("getting...",e),this._handlers[e]}},{key:"register",value:function(e,t){var n=this;this.debug("register...",e),this._handlers[e]=function(){n.debug("executing handler...",e),t.apply(void 0,arguments)}}},{key:"unregister",value:function(e){this.debug("unregistering...",e),this.exists(e)&&delete this._handlers[e]}},{key:"exists",value:function(e){return this.debug("exists?",e),this._handlers.hasOwnProperty(e)}},{key:"msghandler",value:function(e){this.debug("msghandler...",e);var t=e.destinationName;if(!this.exists(t))return void debug("No handler for "+t+" - message dropped",e);try{this.get(t)(e)}catch(e){this.iov.events.exception(t+" handler exception",e)}}}]),e}();t.a=c},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=n(0),i=n.n(o),r=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),a="clsp:iov",c=function(){function e(t){s(this,e),this.id=t,this.debug=i()(a+":"+this.id+":MqttConduitCollection"),this.debug("constructing..."),this._conduits={}}return r(e,[{key:"set",value:function(e,t){return this.debug("setting...",e,t),this._conduits[e]=t,t}},{key:"addFromIov",value:function(e,t){var n=this;return this.debug("adding from iov...",t),this.set(t.config.clientId,mqttConduit(t.config,function(){n.debug("onReady...",t.config.clientId),t.config.appStart(t),t._statsTimer=setInterval(function(){t.statsMsg.inkbps=8*t.statsMsg.byteCount/3e4,t.statsMsg.byteCount=0,e.publish("iov/stats",t.statsMsg),n.debug("iov status",t.statsMsg)},5e3)}))}},{key:"getById",value:function(e){return this.debug("getting...",e),this._conduits[e]}},{key:"exists",value:function(e){return this.debug("exists?",e),this._conduits.hasOwnProperty(e)}}]),e}();t.a=c},function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=n(0),i=n.n(o),r=function(){function e(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,n,s){return n&&e(t.prototype,n),s&&e(t,s),t}}(),a="clsp:iov",c=function(){function e(t,n){s(this,e),this.id=t,this.debug=i()(a+":"+this.id+":MqttConduitCollection"),this.debug("constructing..."),n.statsMsg={byteCount:0,inkbps:0,host:document.location.host,clientId:n.config.clientId},this.clientId=n.config.clientId,this.iov=n,this.conduit=n.mqttConduitCollection.addFromIov(this,n)}return r(e,[{key:"transaction",value:function(e,t,n){var s=this;this.debug("transaction..."),this.conduit.transaction(e,function(e){s.debug("transaction callback...",e),t&&t(e)},n)}},{key:"subscribe",value:function(e,t){var n=this;this.debug("subscribe..."),this.conduit.subscribe(e,function(e){n.debug("subscribe callback...",e),t&&t(e)})}},{key:"unsubscribe",value:function(e,t){var n=this;this.debug("unsubscribe..."),this.conduit.unsubscribe(e,function(e){n.debug("unsubscribe callback...",e),t&&t(e)})}},{key:"publish",value:function(e,t,n){var s=this;this.debug("publish..."),this.conduit.publish(e,t,function(e){s.debug("publish callback...",e),n&&n(e)})}}]),e}();t.a=c},function(e,t,n){"use strict";var s=n(0),o=n.n(s);o()("clsp:iov:player");t.a=function(e){var t={};return t.LogSourceBuffer=!1,t.LogSourceBufferTopic=null,t.state="idle",t.seqnum=1,t.seqnumProcessed=1,t.MAX_SEQ_PROC=2,t.dropCounter=0,t.moovBox=null,t.moofBox=null,t.retry_count=3,t.source_buffer_ready=!1,t._fault=function(e){console.log(e),t.state="fault"},t.restart=function(){t.stop(),t.play(t.eid,t.streamName,t.onFirstChunk,t.onVideoRecv)},t.play=function(n,s,o,i){if(t.eid=n,t.streamName=s,t.onFirstChunk=o,t.video=document.getElementById(n),t.onVideoRecv=i,"undefined"===typeof t.video)return void t._fault("Unable to match id '"+n+"'");var r={clientId:e.config.clientId},a="iov/video/"+window.btoa(t.streamName)+"/request";e.transport.transaction(a,t._start_play,r)},t.resume=function(n,s){t.onFirstChunk=n,t.onVideoRecv=s;var o={clientId:e.config.clientId},i="iov/video/"+window.btoa(t.streamName)+"/request";e.transport.transaction(i,t._start_play,o)},t._appendBuffer_event=function(n){if(!0===t.LogSourceBuffer&&null!==t.LogSourceBufferTopic){var s=new Paho.MQTT.Message(n);s.destinationName=t.LogSourceBufferTopic,MQTTClient.send(s)}e.statsMsg.byteCount+=n.length},t.stop=function(){"undefined"!==typeof t.guid&&e.transport.unsubscribe("iov/video/"+t.guid+"/live"),t.state="idle",t.seqnum=1,t.moovBox=null,t.moofBox=null;var n={clientId:e.config.clientId};e.transport.publish("iov/video/"+t.guid+"/stop",n)},t._start_play=function(n){if(t.mimeCodec=n.mimeCodec,t.guid=n.guid,"MediaSource"in window&&MediaSource.isTypeSupported(t.mimeCodec)){var s=e.config.clientId+"/init-segment/"+parseInt(1e6*Math.random());t._async_play_loop(n,s);var o="iov/video/"+t.guid+"/play";e.transport.publish(o,{initSegmentTopic:s,clientId:e.config.clientId})}else t._fault("Unsuppored mime codec "+t.mimeCodec)},t._async_play_loop=function(n,s){t.vqueue=[],t.state="waiting-for-moov",e.transport.subscribe(s,function(n){t.moovBox=n.payloadBytes,t.state="waiting-for-moof",e.transport.unsubscribe(s),t.state="playing",e.transport.subscribe("iov/video/"+t.guid+"/live",t._on_moof),t.onFirstChunk(),t.mediaSource=new MediaSource;var o=t.video.cloneNode(),i=t.video.parentNode;null!==i&&(i.replaceChild(o,t.video),t.video=o),t.mediaSource.addEventListener("sourceopen",t._on_sourceopen),t.mediaSource.addEventListener("sourceended",t._on_sourceended),t.mediaSource.addEventListener("error",function(e){console.log("MSE error"),console.log(e)}),t.video.src=URL.createObjectURL(t.mediaSource),e.transport.subscribe("iov/video/"+t.guid+"/resync",function(e){console.log("sync received from server restarting stream"),t.restart()})})},t._on_moof=function(e){if(0!=t.source_buffer_ready&&!(t.seqnum-t.seqnumProcessed>t.MAX_SEQ_PROC)){var n=e.payloadBytes;if(n[20]=(4278190080&t.seqnum)>>24,n[21]=(16711680&t.seqnum)>>16,n[22]=(65280&t.seqnum)>>8,n[23]=255&t.seqnum,!1===t.sourceBuffer.updating)try{t._appendBuffer_event(n),t.sourceBuffer.appendBuffer(n),t.seqnum+=1}catch(e){t.stop(),console.log(e.stack)}else t.vqueue.push(n.slice(0))}},t._on_sourceopen=function(){if("open"===t.mediaSource.readyState)return void t._do_on_sourceopen();var e=setInterval(function(){"open"===t.mediaSource.readyState&&(t._do_on_sourceopen(),clearInterval(e))},1e3)},t._do_on_sourceopen=function(){t.sourceBuffer=t.mediaSource.addSourceBuffer(t.mimeCodec),t.sourceBuffer.mode="sequence",t.sourceBuffer.addEventListener("updateend",t._on_updateend),t.sourceBuffer.addEventListener("update",function(){!1===t.sourceBuffer.updating&&t.vqueue.length>0&&(t._appendBuffer_event(t.vqueue[0]),t.sourceBuffer.appendBuffer(t.vqueue[0]),t.vqueue=t.vqueue.slice(1))}),t.sourceBuffer.addEventListener("updatestart",function(){}),t.sourceBuffer.addEventListener("error",function(e){console.log("MSE sourceBffer error"),console.log(e)}),t.source_buffer_ready=!0,t._appendBuffer_event(t.moovBox),t.sourceBuffer.appendBuffer(t.moovBox)},t._on_sourceended=function(){t.stop(),t.source_buffer_ready=!1},t._on_updateend=function(){if(t.seqnumProcessed+=1,"open"===t.mediaSource.readyState&&(t.vqueue.length>0&&(t._appendBuffer_event(t.vqueue[0]),setTimeout(function(){if(!1===t.sourceBuffer.updating)try{t.sourceBuffer.appendBuffer(t.vqueue[0])}catch(e){}t.vqueue=t.vqueue.slice(1)},0)),!0===t.video.paused))try{var e=t.video.play();"undefined"!==typeof e&&e.then(function(e){}).catch(function(e){})}catch(e){console.log("Exception while trying to play:"+e.message)}},t}},function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};"undefined"===typeof Paho&&(Paho={}),Paho.MQTT=function(e){function t(e,t,n){return t[n++]=e>>8,t[n++]=e%256,n}function s(e,n,s,o){return o=t(n,s,o),i(e,s,o),o+n}function o(e){for(var t=0,n=0;n<e.length;n++){var s=e.charCodeAt(n);2047<s?(55296<=s&&56319>=s&&(n++,t++),t+=3):127<s?t+=2:t++}return t}function i(e,t,n){for(var s=0;s<e.length;s++){var o=e.charCodeAt(s);if(55296<=o&&56319>=o){var i=e.charCodeAt(++s);if(isNaN(i))throw Error(l(u.MALFORMED_UNICODE,[o,i]));o=i-56320+(o-55296<<10)+65536}127>=o?t[n++]=o:(2047>=o?t[n++]=o>>6&31|192:(65535>=o?t[n++]=o>>12&15|224:(t[n++]=o>>18&7|240,t[n++]=o>>12&63|128),t[n++]=o>>6&63|128),t[n++]=63&o|128)}return t}function r(e,t,n){for(var s,o="",i=t;i<t+n;){if(!(128>(s=e[i++]))){var r=e[i++]-128;if(0>r)throw Error(l(u.MALFORMED_UTF,[s.toString(16),r.toString(16),""]));if(224>s)s=64*(s-192)+r;else{var a=e[i++]-128;if(0>a)throw Error(l(u.MALFORMED_UTF,[s.toString(16),r.toString(16),a.toString(16)]));if(240>s)s=4096*(s-224)+64*r+a;else{var c=e[i++]-128;if(0>c)throw Error(l(u.MALFORMED_UTF,[s.toString(16),r.toString(16),a.toString(16),c.toString(16)]));if(!(248>s))throw Error(l(u.MALFORMED_UTF,[s.toString(16),r.toString(16),a.toString(16),c.toString(16)]));s=262144*(s-240)+4096*r+64*a+c}}}65535<s&&(s-=65536,o+=String.fromCharCode(55296+(s>>10)),s=56320+(1023&s)),o+=String.fromCharCode(s)}return o}var a=function(e,t){for(var s in e)if(e.hasOwnProperty(s)){if(!t.hasOwnProperty(s)){var o="Unknown property, "+s+". Valid properties are:";for(s in t)t.hasOwnProperty(s)&&(o=o+" "+s);throw Error(o)}if(n(e[s])!==t[s])throw Error(l(u.INVALID_TYPE,[n(e[s]),s]))}},c=function(e,t){return function(){return e.apply(t,arguments)}},u={OK:{code:0,text:"AMQJSC0000I OK."},CONNECT_TIMEOUT:{code:1,text:"AMQJSC0001E Connect timed out."},SUBSCRIBE_TIMEOUT:{code:2,text:"AMQJS0002E Subscribe timed out."},UNSUBSCRIBE_TIMEOUT:{code:3,text:"AMQJS0003E Unsubscribe timed out."},PING_TIMEOUT:{code:4,text:"AMQJS0004E Ping timed out."},INTERNAL_ERROR:{code:5,text:"AMQJS0005E Internal error. Error Message: {0}, Stack trace: {1}"},CONNACK_RETURNCODE:{code:6,text:"AMQJS0006E Bad Connack return code:{0} {1}."},SOCKET_ERROR:{code:7,text:"AMQJS0007E Socket error:{0}."},SOCKET_CLOSE:{code:8,text:"AMQJS0008I Socket closed."},MALFORMED_UTF:{code:9,text:"AMQJS0009E Malformed UTF data:{0} {1} {2}."},UNSUPPORTED:{code:10,text:"AMQJS0010E {0} is not supported by this browser."},INVALID_STATE:{code:11,text:"AMQJS0011E Invalid state {0}."},INVALID_TYPE:{code:12,text:"AMQJS0012E Invalid type {0} for {1}."},INVALID_ARGUMENT:{code:13,text:"AMQJS0013E Invalid argument {0} for {1}."},UNSUPPORTED_OPERATION:{code:14,text:"AMQJS0014E Unsupported operation."},INVALID_STORED_DATA:{code:15,text:"AMQJS0015E Invalid data in local storage key={0} value={1}."},INVALID_MQTT_MESSAGE_TYPE:{code:16,text:"AMQJS0016E Invalid MQTT message type {0}."},MALFORMED_UNICODE:{code:17,text:"AMQJS0017E Malformed Unicode string:{0} {1}."}},d={0:"Connection Accepted",1:"Connection Refused: unacceptable protocol version",2:"Connection Refused: identifier rejected",3:"Connection Refused: server unavailable",4:"Connection Refused: bad user name or password",5:"Connection Refused: not authorized"},l=function(e,t){var n=e.text;if(t)for(var s,o,i=0;i<t.length;i++)if(s="{"+i+"}",0<(o=n.indexOf(s)))var r=n.substring(0,o),n=n.substring(o+s.length),n=r+t[i]+n;return n},h=[0,6,77,81,73,115,100,112,3],f=[0,4,77,81,84,84,4],p=function(e,t){this.type=e;for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n])};p.prototype.encode=function(){var e=(15&this.type)<<4,n=0,i=[],r=0;switch(void 0!=this.messageIdentifier&&(n+=2),this.type){case 1:switch(this.mqttVersion){case 3:n+=h.length+3;break;case 4:n+=f.length+3}if(n+=o(this.clientId)+2,void 0!=this.willMessage){var n=n+(o(this.willMessage.destinationName)+2),a=this.willMessage.payloadBytes;a instanceof Uint8Array||(a=new Uint8Array(u)),n+=a.byteLength+2}void 0!=this.userName&&(n+=o(this.userName)+2),void 0!=this.password&&(n+=o(this.password)+2);break;case 8:for(var e=2|e,c=0;c<this.topics.length;c++)i[c]=o(this.topics[c]),n+=i[c]+2;n+=this.requestedQos.length;break;case 10:for(e|=2,c=0;c<this.topics.length;c++)i[c]=o(this.topics[c]),n+=i[c]+2;break;case 6:e|=2;break;case 3:this.payloadMessage.duplicate&&(e|=8),e=e|=this.payloadMessage.qos<<1,this.payloadMessage.retained&&(e|=1);var r=o(this.payloadMessage.destinationName),u=this.payloadMessage.payloadBytes,n=n+(r+2)+u.byteLength;u instanceof ArrayBuffer?u=new Uint8Array(u):u instanceof Uint8Array||(u=new Uint8Array(u.buffer))}var d=n,c=Array(1),l=0;do{var p=d%128,d=d>>7;0<d&&(p|=128),c[l++]=p}while(0<d&&4>l);if(d=c.length+1,n=new ArrayBuffer(n+d),l=new Uint8Array(n),l[0]=e,l.set(c,1),3==this.type)d=s(this.payloadMessage.destinationName,r,l,d);else if(1==this.type){switch(this.mqttVersion){case 3:l.set(h,d),d+=h.length;break;case 4:l.set(f,d),d+=f.length}e=0,this.cleanSession&&(e=2),void 0!=this.willMessage&&(e=4|e|this.willMessage.qos<<3,this.willMessage.retained&&(e|=32)),void 0!=this.userName&&(e|=128),void 0!=this.password&&(e|=64),l[d++]=e,d=t(this.keepAliveInterval,l,d)}switch(void 0!=this.messageIdentifier&&(d=t(this.messageIdentifier,l,d)),this.type){case 1:d=s(this.clientId,o(this.clientId),l,d),void 0!=this.willMessage&&(d=s(this.willMessage.destinationName,o(this.willMessage.destinationName),l,d),d=t(a.byteLength,l,d),l.set(a,d),d+=a.byteLength),void 0!=this.userName&&(d=s(this.userName,o(this.userName),l,d)),void 0!=this.password&&s(this.password,o(this.password),l,d);break;case 3:l.set(u,d);break;case 8:for(c=0;c<this.topics.length;c++)d=s(this.topics[c],i[c],l,d),l[d++]=this.requestedQos[c];break;case 10:for(c=0;c<this.topics.length;c++)d=s(this.topics[c],i[c],l,d)}return n};var g=function(e,t,n){this._client=e,this._window=t,this._keepAliveInterval=1e3*n,this.isReset=!1;var s=new p(12).encode(),o=function(e){return function(){return i.apply(e)}},i=function(){this.isReset?(this.isReset=!1,this._client._trace("Pinger.doPing","send PINGREQ"),this._client.socket.send(s),this.timeout=this._window.setTimeout(o(this),this._keepAliveInterval)):(this._client._trace("Pinger.doPing","Timed out"),this._client._disconnected(u.PING_TIMEOUT.code,l(u.PING_TIMEOUT)))};this.reset=function(){this.isReset=!0,this._window.clearTimeout(this.timeout),0<this._keepAliveInterval&&(this.timeout=setTimeout(o(this),this._keepAliveInterval))},this.cancel=function(){this._window.clearTimeout(this.timeout)}},_=function(e,t,n,s,o){this._window=t,n||(n=30),this.timeout=setTimeout(function(e,t,n){return function(){return e.apply(t,n)}}(s,e,o),1e3*n),this.cancel=function(){this._window.clearTimeout(this.timeout)}},m=function(t,n,s,o,i){if(!("WebSocket"in e&&null!==e.WebSocket))throw Error(l(u.UNSUPPORTED,["WebSocket"]));if(!("localStorage"in e&&null!==e.localStorage))throw Error(l(u.UNSUPPORTED,["localStorage"]));if(!("ArrayBuffer"in e&&null!==e.ArrayBuffer))throw Error(l(u.UNSUPPORTED,["ArrayBuffer"]));this._trace("Paho.MQTT.Client",t,n,s,o,i),this.host=n,this.port=s,this.path=o,this.uri=t,this.clientId=i,this._localKey=n+":"+s+("/mqtt"!=o?":"+o:"")+":"+i+":",this._msg_queue=[],this._sentMessages={},this._receivedMessages={},this._notify_msg_sent={},this._message_identifier=1,this._sequence=0;for(var r in localStorage)0!=r.indexOf("Sent:"+this._localKey)&&0!=r.indexOf("Received:"+this._localKey)||this.restore(r)};m.prototype.host,m.prototype.port,m.prototype.path,m.prototype.uri,m.prototype.clientId,m.prototype.socket,m.prototype.connected=!1,m.prototype.maxMessageIdentifier=65536,m.prototype.connectOptions,m.prototype.hostIndex,m.prototype.onConnectionLost,m.prototype.onMessageDelivered,m.prototype.onMessageArrived,m.prototype.traceFunction,m.prototype._msg_queue=null,m.prototype._connectTimeout,m.prototype.sendPinger=null,m.prototype.receivePinger=null,m.prototype.receiveBuffer=null,m.prototype._traceBuffer=null,m.prototype._MAX_TRACE_ENTRIES=100,m.prototype.connect=function(e){var t=this._traceMask(e,"password");if(this._trace("Client.connect",t,this.socket,this.connected),this.connected)throw Error(l(u.INVALID_STATE,["already connected"]));if(this.socket)throw Error(l(u.INVALID_STATE,["already connected"]));this.connectOptions=e,e.uris?(this.hostIndex=0,this._doConnect(e.uris[0])):this._doConnect(this.uri)},m.prototype.subscribe=function(e,t){if(this._trace("Client.subscribe",e,t),!this.connected)throw Error(l(u.INVALID_STATE,["not connected"]));var n=new p(8);n.topics=[e],n.requestedQos=void 0!=t.qos?[t.qos]:[0],t.onSuccess&&(n.onSuccess=function(e){t.onSuccess({invocationContext:t.invocationContext,grantedQos:e})}),t.onFailure&&(n.onFailure=function(e){t.onFailure({invocationContext:t.invocationContext,errorCode:e})}),t.timeout&&(n.timeOut=new _(this,window,t.timeout,t.onFailure,[{invocationContext:t.invocationContext,errorCode:u.SUBSCRIBE_TIMEOUT.code,errorMessage:l(u.SUBSCRIBE_TIMEOUT)}])),this._requires_ack(n),this._schedule_message(n)},m.prototype.unsubscribe=function(e,t){if(this._trace("Client.unsubscribe",e,t),!this.connected)throw Error(l(u.INVALID_STATE,["not connected"]));var n=new p(10);n.topics=[e],t.onSuccess&&(n.callback=function(){t.onSuccess({invocationContext:t.invocationContext})}),t.timeout&&(n.timeOut=new _(this,window,t.timeout,t.onFailure,[{invocationContext:t.invocationContext,errorCode:u.UNSUBSCRIBE_TIMEOUT.code,errorMessage:l(u.UNSUBSCRIBE_TIMEOUT)}])),this._requires_ack(n),this._schedule_message(n)},m.prototype.send=function(e){if(this._trace("Client.send",e),!this.connected)throw Error(l(u.INVALID_STATE,["not connected"]));wireMessage=new p(3),wireMessage.payloadMessage=e,0<e.qos?this._requires_ack(wireMessage):this.onMessageDelivered&&(this._notify_msg_sent[wireMessage]=this.onMessageDelivered(wireMessage.payloadMessage)),this._schedule_message(wireMessage)},m.prototype.disconnect=function(){if(this._trace("Client.disconnect"),!this.socket)throw Error(l(u.INVALID_STATE,["not connecting or connected"]));wireMessage=new p(14),this._notify_msg_sent[wireMessage]=c(this._disconnected,this),this._schedule_message(wireMessage)},m.prototype.getTraceLog=function(){if(null!==this._traceBuffer){this._trace("Client.getTraceLog",new Date),this._trace("Client.getTraceLog in flight messages",this._sentMessages.length);for(var e in this._sentMessages)this._trace("_sentMessages ",e,this._sentMessages[e]);for(e in this._receivedMessages)this._trace("_receivedMessages ",e,this._receivedMessages[e]);return this._traceBuffer}},m.prototype.startTrace=function(){null===this._traceBuffer&&(this._traceBuffer=[]),this._trace("Client.startTrace",new Date,"1.0.2")},m.prototype.stopTrace=function(){delete this._traceBuffer},m.prototype._doConnect=function(e){this.connectOptions.useSSL&&(e=e.split(":"),e[0]="wss",e=e.join(":")),this.connected=!1,this.socket=4>this.connectOptions.mqttVersion?new WebSocket(e,["mqttv3.1"]):new WebSocket(e,["mqtt"]),this.socket.binaryType="arraybuffer",this.socket.onopen=c(this._on_socket_open,this),this.socket.onmessage=c(this._on_socket_message,this),this.socket.onerror=c(this._on_socket_error,this),this.socket.onclose=c(this._on_socket_close,this),this.sendPinger=new g(this,window,this.connectOptions.keepAliveInterval),this.receivePinger=new g(this,window,this.connectOptions.keepAliveInterval),this._connectTimeout=new _(this,window,this.connectOptions.timeout,this._disconnected,[u.CONNECT_TIMEOUT.code,l(u.CONNECT_TIMEOUT)])},m.prototype._schedule_message=function(e){this._msg_queue.push(e),this.connected&&this._process_queue()},m.prototype.store=function(e,t){var n={type:t.type,messageIdentifier:t.messageIdentifier,version:1};switch(t.type){case 3:t.pubRecReceived&&(n.pubRecReceived=!0),n.payloadMessage={};for(var s="",o=t.payloadMessage.payloadBytes,i=0;i<o.length;i++)s=15>=o[i]?s+"0"+o[i].toString(16):s+o[i].toString(16);n.payloadMessage.payloadHex=s,n.payloadMessage.qos=t.payloadMessage.qos,n.payloadMessage.destinationName=t.payloadMessage.destinationName,t.payloadMessage.duplicate&&(n.payloadMessage.duplicate=!0),t.payloadMessage.retained&&(n.payloadMessage.retained=!0),0==e.indexOf("Sent:")&&(void 0===t.sequence&&(t.sequence=++this._sequence),n.sequence=t.sequence);break;default:throw Error(l(u.INVALID_STORED_DATA,[key,n]))}localStorage.setItem(e+this._localKey+t.messageIdentifier,JSON.stringify(n))},m.prototype.restore=function(e){var t=localStorage.getItem(e),n=JSON.parse(t),s=new p(n.type,n);switch(n.type){case 3:for(var t=n.payloadMessage.payloadHex,o=new ArrayBuffer(t.length/2),o=new Uint8Array(o),i=0;2<=t.length;){var r=parseInt(t.substring(0,2),16),t=t.substring(2,t.length);o[i++]=r}t=new Paho.MQTT.Message(o),t.qos=n.payloadMessage.qos,t.destinationName=n.payloadMessage.destinationName,n.payloadMessage.duplicate&&(t.duplicate=!0),n.payloadMessage.retained&&(t.retained=!0),s.payloadMessage=t;break;default:throw Error(l(u.INVALID_STORED_DATA,[e,t]))}0==e.indexOf("Sent:"+this._localKey)?(s.payloadMessage.duplicate=!0,this._sentMessages[s.messageIdentifier]=s):0==e.indexOf("Received:"+this._localKey)&&(this._receivedMessages[s.messageIdentifier]=s)},m.prototype._process_queue=function(){for(var e=null,t=this._msg_queue.reverse();e=t.pop();)this._socket_send(e),this._notify_msg_sent[e]&&(this._notify_msg_sent[e](),delete this._notify_msg_sent[e])},m.prototype._requires_ack=function(e){var t=Object.keys(this._sentMessages).length;if(t>this.maxMessageIdentifier)throw Error("Too many messages:"+t);for(;void 0!==this._sentMessages[this._message_identifier];)this._message_identifier++;e.messageIdentifier=this._message_identifier,this._sentMessages[e.messageIdentifier]=e,3===e.type&&this.store("Sent:",e),this._message_identifier===this.maxMessageIdentifier&&(this._message_identifier=1)},m.prototype._on_socket_open=function(){var e=new p(1,this.connectOptions);e.clientId=this.clientId,this._socket_send(e)},m.prototype._on_socket_message=function(e){this._trace("Client._on_socket_message",e.data),e=this._deframeMessages(e.data);for(var t=0;t<e.length;t+=1)this._handleMessage(e[t])},m.prototype._deframeMessages=function(e){if(e=new Uint8Array(e),this.receiveBuffer){var t=new Uint8Array(this.receiveBuffer.length+e.length);t.set(this.receiveBuffer),t.set(e,this.receiveBuffer.length),e=t,delete this.receiveBuffer}try{for(var t=0,n=[];t<e.length;){var s;e:{var o=e,i=t,a=i,c=o[i],d=c>>4,h=15&c,i=i+1,f=void 0,g=0,_=1;do{if(i==o.length){s=[null,a];break e}f=o[i++],g+=(127&f)*_,_*=128}while(0!=(128&f));if((f=i+g)>o.length)s=[null,a];else{var m=new p(d);switch(d){case 2:1&o[i++]&&(m.sessionPresent=!0),m.returnCode=o[i++];break;case 3:var a=h>>1&3,v=256*o[i]+o[i+1],i=i+2,y=r(o,i,v),i=i+v;0<a&&(m.messageIdentifier=256*o[i]+o[i+1],i+=2);var b=new Paho.MQTT.Message(o.subarray(i,f));1==(1&h)&&(b.retained=!0),8==(8&h)&&(b.duplicate=!0),b.qos=a,b.destinationName=y,m.payloadMessage=b;break;case 4:case 5:case 6:case 7:case 11:m.messageIdentifier=256*o[i]+o[i+1];break;case 9:m.messageIdentifier=256*o[i]+o[i+1],i+=2,m.returnCode=o.subarray(i,f)}s=[m,f]}}var w=s[0],t=s[1];if(null===w)break;n.push(w)}t<e.length&&(this.receiveBuffer=e.subarray(t))}catch(e){return void this._disconnected(u.INTERNAL_ERROR.code,l(u.INTERNAL_ERROR,[e.message,e.stack.toString()]))}return n},m.prototype._handleMessage=function(e){this._trace("Client._handleMessage",e);try{switch(e.type){case 2:if(this._connectTimeout.cancel(),this.connectOptions.cleanSession){for(var t in this._sentMessages){var n=this._sentMessages[t];localStorage.removeItem("Sent:"+this._localKey+n.messageIdentifier)}this._sentMessages={};for(t in this._receivedMessages){var s=this._receivedMessages[t];localStorage.removeItem("Received:"+this._localKey+s.messageIdentifier)}this._receivedMessages={}}if(0!==e.returnCode){this._disconnected(u.CONNACK_RETURNCODE.code,l(u.CONNACK_RETURNCODE,[e.returnCode,d[e.returnCode]]));break}this.connected=!0,this.connectOptions.uris&&(this.hostIndex=this.connectOptions.uris.length),e=[];for(var o in this._sentMessages)this._sentMessages.hasOwnProperty(o)&&e.push(this._sentMessages[o]);e=e.sort(function(e,t){return e.sequence-t.sequence}),o=0;for(var i=e.length;o<i;o++)if(n=e[o],3==n.type&&n.pubRecReceived){var r=new p(6,{messageIdentifier:n.messageIdentifier});this._schedule_message(r)}else this._schedule_message(n);this.connectOptions.onSuccess&&this.connectOptions.onSuccess({invocationContext:this.connectOptions.invocationContext}),this._process_queue();break;case 3:this._receivePublish(e);break;case 4:(n=this._sentMessages[e.messageIdentifier])&&(delete this._sentMessages[e.messageIdentifier],localStorage.removeItem("Sent:"+this._localKey+e.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(n.payloadMessage));break;case 5:(n=this._sentMessages[e.messageIdentifier])&&(n.pubRecReceived=!0,r=new p(6,{messageIdentifier:e.messageIdentifier}),this.store("Sent:",n),this._schedule_message(r));break;case 6:s=this._receivedMessages[e.messageIdentifier],localStorage.removeItem("Received:"+this._localKey+e.messageIdentifier),s&&(this._receiveMessage(s),delete this._receivedMessages[e.messageIdentifier]);var a=new p(7,{messageIdentifier:e.messageIdentifier});this._schedule_message(a);break;case 7:n=this._sentMessages[e.messageIdentifier],delete this._sentMessages[e.messageIdentifier],localStorage.removeItem("Sent:"+this._localKey+e.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(n.payloadMessage);break;case 9:(n=this._sentMessages[e.messageIdentifier])&&(n.timeOut&&n.timeOut.cancel(),128===e.returnCode[0]?n.onFailure&&n.onFailure(e.returnCode):n.onSuccess&&n.onSuccess(e.returnCode),delete this._sentMessages[e.messageIdentifier]);break;case 11:(n=this._sentMessages[e.messageIdentifier])&&(n.timeOut&&n.timeOut.cancel(),n.callback&&n.callback(),delete this._sentMessages[e.messageIdentifier]);break;case 13:this.sendPinger.reset();break;case 14:this._disconnected(u.INVALID_MQTT_MESSAGE_TYPE.code,l(u.INVALID_MQTT_MESSAGE_TYPE,[e.type]));break;default:this._disconnected(u.INVALID_MQTT_MESSAGE_TYPE.code,l(u.INVALID_MQTT_MESSAGE_TYPE,[e.type]))}}catch(e){this._disconnected(u.INTERNAL_ERROR.code,l(u.INTERNAL_ERROR,[e.message,e.stack.toString()]))}},m.prototype._on_socket_error=function(e){this._disconnected(u.SOCKET_ERROR.code,l(u.SOCKET_ERROR,[e.data]))},m.prototype._on_socket_close=function(){this._disconnected(u.SOCKET_CLOSE.code,l(u.SOCKET_CLOSE))},m.prototype._socket_send=function(e){if(1==e.type){var t=this._traceMask(e,"password");this._trace("Client._socket_send",t)}else this._trace("Client._socket_send",e);this.socket.send(e.encode()),this.sendPinger.reset()},m.prototype._receivePublish=function(e){switch(e.payloadMessage.qos){case"undefined":case 0:this._receiveMessage(e);break;case 1:var t=new p(4,{messageIdentifier:e.messageIdentifier});this._schedule_message(t),this._receiveMessage(e);break;case 2:this._receivedMessages[e.messageIdentifier]=e,this.store("Received:",e),e=new p(5,{messageIdentifier:e.messageIdentifier}),this._schedule_message(e);break;default:throw Error("Invaild qos="+wireMmessage.payloadMessage.qos)}},m.prototype._receiveMessage=function(e){this.onMessageArrived&&this.onMessageArrived(e.payloadMessage)},m.prototype._disconnected=function(e,t){this._trace("Client._disconnected",e,t),this.sendPinger.cancel(),this.receivePinger.cancel(),this._connectTimeout&&this._connectTimeout.cancel(),this._msg_queue=[],this._notify_msg_sent={},this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,1===this.socket.readyState&&this.socket.close(),delete this.socket),this.connectOptions.uris&&this.hostIndex<this.connectOptions.uris.length-1?(this.hostIndex++,this._doConnect(this.connectOptions.uris[this.hostIndex])):(void 0===e&&(e=u.OK.code,t=l(u.OK)),this.connected?(this.connected=!1,this.onConnectionLost&&this.onConnectionLost({errorCode:e,errorMessage:t})):4===this.connectOptions.mqttVersion&&!1===this.connectOptions.mqttVersionExplicit?(this._trace("Failed to connect V4, dropping back to V3"),this.connectOptions.mqttVersion=3,this.connectOptions.uris?(this.hostIndex=0,this._doConnect(this.connectOptions.uris[0])):this._doConnect(this.uri)):this.connectOptions.onFailure&&this.connectOptions.onFailure({invocationContext:this.connectOptions.invocationContext,errorCode:e,errorMessage:t}))},m.prototype._trace=function(){if(this.traceFunction){for(var e in arguments)"undefined"!==typeof arguments[e]&&(arguments[e]=JSON.stringify(arguments[e]));e=Array.prototype.slice.call(arguments).join(""),this.traceFunction({severity:"Debug",message:e})}if(null!==this._traceBuffer){e=0;for(var t=arguments.length;e<t;e++)this._traceBuffer.length==this._MAX_TRACE_ENTRIES&&this._traceBuffer.shift(),0===e?this._traceBuffer.push(arguments[e]):"undefined"===typeof arguments[e]?this._traceBuffer.push(arguments[e]):this._traceBuffer.push("  "+JSON.stringify(arguments[e]))}},m.prototype._traceMask=function(e,t){var n,s={};for(n in e)e.hasOwnProperty(n)&&(s[n]=n==t?"******":e[n]);return s};var v=function(e,t,s,o){var i;if("string"!==typeof e)throw Error(l(u.INVALID_TYPE,["undefined"===typeof e?"undefined":n(e),"host"]));if(2==arguments.length){o=t,i=e;var r=i.match(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/);if(!r)throw Error(l(u.INVALID_ARGUMENT,[e,"host"]));e=r[4]||r[2],t=parseInt(r[7]),s=r[8]}else{if(3==arguments.length&&(o=s,s="/mqtt"),"number"!==typeof t||0>t)throw Error(l(u.INVALID_TYPE,["undefined"===typeof t?"undefined":n(t),"port"]));if("string"!==typeof s)throw Error(l(u.INVALID_TYPE,["undefined"===typeof s?"undefined":n(s),"path"]));i="ws://"+(-1!=e.indexOf(":")&&"["!=e.slice(0,1)&&"]"!=e.slice(-1)?"["+e+"]":e)+":"+t+s}for(var c=r=0;c<o.length;c++){var d=o.charCodeAt(c);55296<=d&&56319>=d&&c++,r++}if("string"!==typeof o||65535<r)throw Error(l(u.INVALID_ARGUMENT,[o,"clientId"]));var h=new m(i,e,t,s,o);this._getHost=function(){return e},this._setHost=function(){throw Error(l(u.UNSUPPORTED_OPERATION))},this._getPort=function(){return t},this._setPort=function(){throw Error(l(u.UNSUPPORTED_OPERATION))},this._getPath=function(){return s},this._setPath=function(){throw Error(l(u.UNSUPPORTED_OPERATION))},this._getURI=function(){return i},this._setURI=function(){throw Error(l(u.UNSUPPORTED_OPERATION))},this._getClientId=function(){return h.clientId},this._setClientId=function(){throw Error(l(u.UNSUPPORTED_OPERATION))},this._getOnConnectionLost=function(){return h.onConnectionLost},this._setOnConnectionLost=function(e){if("function"!==typeof e)throw Error(l(u.INVALID_TYPE,["undefined"===typeof e?"undefined":n(e),"onConnectionLost"]));h.onConnectionLost=e},this._getOnMessageDelivered=function(){return h.onMessageDelivered},this._setOnMessageDelivered=function(e){if("function"!==typeof e)throw Error(l(u.INVALID_TYPE,["undefined"===typeof e?"undefined":n(e),"onMessageDelivered"]));h.onMessageDelivered=e},this._getOnMessageArrived=function(){return h.onMessageArrived},this._setOnMessageArrived=function(e){if("function"!==typeof e)throw Error(l(u.INVALID_TYPE,["undefined"===typeof e?"undefined":n(e),"onMessageArrived"]));h.onMessageArrived=e},this._getTrace=function(){return h.traceFunction},this._setTrace=function(e){if("function"!==typeof e)throw Error(l(u.INVALID_TYPE,["undefined"===typeof e?"undefined":n(e),"onTrace"]));h.traceFunction=e},this.connect=function(e){if(e=e||{},a(e,{timeout:"number",userName:"string",password:"string",willMessage:"object",keepAliveInterval:"number",cleanSession:"boolean",useSSL:"boolean",invocationContext:"object",onSuccess:"function",onFailure:"function",hosts:"object",ports:"object",mqttVersion:"number",mqttVersionExplicit:"boolean",uris:"object"}),void 0===e.keepAliveInterval&&(e.keepAliveInterval=60),4<e.mqttVersion||3>e.mqttVersion)throw Error(l(u.INVALID_ARGUMENT,[e.mqttVersion,"connectOptions.mqttVersion"]));if(void 0===e.mqttVersion?(e.mqttVersionExplicit=!1,e.mqttVersion=4):e.mqttVersionExplicit=!0,void 0!==e.password&&void 0===e.userName)throw Error(l(u.INVALID_ARGUMENT,[e.password,"connectOptions.password"]));if(e.willMessage){if(!(e.willMessage instanceof y))throw Error(l(u.INVALID_TYPE,[e.willMessage,"connectOptions.willMessage"]));if(e.willMessage.stringPayload,"undefined"===typeof e.willMessage.destinationName)throw Error(l(u.INVALID_TYPE,[n(e.willMessage.destinationName),"connectOptions.willMessage.destinationName"]))}if("undefined"===typeof e.cleanSession&&(e.cleanSession=!0),e.hosts){if(!(e.hosts instanceof Array))throw Error(l(u.INVALID_ARGUMENT,[e.hosts,"connectOptions.hosts"]));if(1>e.hosts.length)throw Error(l(u.INVALID_ARGUMENT,[e.hosts,"connectOptions.hosts"]));for(var t=!1,o=0;o<e.hosts.length;o++){if("string"!==typeof e.hosts[o])throw Error(l(u.INVALID_TYPE,[n(e.hosts[o]),"connectOptions.hosts["+o+"]"]));if(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/.test(e.hosts[o])){if(0==o)t=!0;else if(!t)throw Error(l(u.INVALID_ARGUMENT,[e.hosts[o],"connectOptions.hosts["+o+"]"]))}else if(t)throw Error(l(u.INVALID_ARGUMENT,[e.hosts[o],"connectOptions.hosts["+o+"]"]))}if(t)e.uris=e.hosts;else{if(!e.ports)throw Error(l(u.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));if(!(e.ports instanceof Array))throw Error(l(u.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));if(e.hosts.length!=e.ports.length)throw Error(l(u.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));for(e.uris=[],o=0;o<e.hosts.length;o++){if("number"!==typeof e.ports[o]||0>e.ports[o])throw Error(l(u.INVALID_TYPE,[n(e.ports[o]),"connectOptions.ports["+o+"]"]));var t=e.hosts[o],r=e.ports[o];i="ws://"+(-1!=t.indexOf(":")?"["+t+"]":t)+":"+r+s,e.uris.push(i)}}}h.connect(e)},this.subscribe=function(e,t){if("string"!==typeof e)throw Error("Invalid argument:"+e);if(t=t||{},a(t,{qos:"number",invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),t.timeout&&!t.onFailure)throw Error("subscribeOptions.timeout specified with no onFailure callback.");if("undefined"!==typeof t.qos&&0!==t.qos&&1!==t.qos&&2!==t.qos)throw Error(l(u.INVALID_ARGUMENT,[t.qos,"subscribeOptions.qos"]));h.subscribe(e,t)},this.unsubscribe=function(e,t){if("string"!==typeof e)throw Error("Invalid argument:"+e);if(t=t||{},a(t,{invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),t.timeout&&!t.onFailure)throw Error("unsubscribeOptions.timeout specified with no onFailure callback.");h.unsubscribe(e,t)},this.send=function(e,t,s,o){var i;if(0==arguments.length)throw Error("Invalid argument.length");if(1==arguments.length){if(!(e instanceof y)&&"string"!==typeof e)throw Error("Invalid argument:"+("undefined"===typeof e?"undefined":n(e)));if(i=e,"undefined"===typeof i.destinationName)throw Error(l(u.INVALID_ARGUMENT,[i.destinationName,"Message.destinationName"]))}else i=new y(t),i.destinationName=e,3<=arguments.length&&(i.qos=s),4<=arguments.length&&(i.retained=o);h.send(i)},this.disconnect=function(){h.disconnect()},this.getTraceLog=function(){return h.getTraceLog()},this.startTrace=function(){h.startTrace()},this.stopTrace=function(){h.stopTrace()},this.isConnected=function(){return h.connected}};v.prototype={get host(){return this._getHost()},set host(e){this._setHost(e)},get port(){return this._getPort()},set port(e){this._setPort(e)},get path(){return this._getPath()},set path(e){this._setPath(e)},get clientId(){return this._getClientId()},set clientId(e){this._setClientId(e)},get onConnectionLost(){return this._getOnConnectionLost()},set onConnectionLost(e){this._setOnConnectionLost(e)},get onMessageDelivered(){return this._getOnMessageDelivered()},set onMessageDelivered(e){this._setOnMessageDelivered(e)},get onMessageArrived(){return this._getOnMessageArrived()},set onMessageArrived(e){this._setOnMessageArrived(e)},get trace(){return this._getTrace()},set trace(e){this._setTrace(e)}};var y=function(e){var t;if(!("string"===typeof e||e instanceof ArrayBuffer||e instanceof Int8Array||e instanceof Uint8Array||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array))throw l(u.INVALID_ARGUMENT,[e,"newPayload"]);t=e,this._getPayloadString=function(){return"string"===typeof t?t:r(t,0,t.length)},this._getPayloadBytes=function(){if("string"===typeof t){var e=new ArrayBuffer(o(t)),e=new Uint8Array(e);return i(t,e,0),e}return t};var n=void 0;this._getDestinationName=function(){return n},this._setDestinationName=function(e){if("string"!==typeof e)throw Error(l(u.INVALID_ARGUMENT,[e,"newDestinationName"]));n=e};var s=0;this._getQos=function(){return s},this._setQos=function(e){if(0!==e&&1!==e&&2!==e)throw Error("Invalid argument:"+e);s=e};var a=!1;this._getRetained=function(){return a},this._setRetained=function(e){if("boolean"!==typeof e)throw Error(l(u.INVALID_ARGUMENT,[e,"newRetained"]));a=e};var c=!1;this._getDuplicate=function(){return c},this._setDuplicate=function(e){c=e}};return y.prototype={get payloadString(){return this._getPayloadString()},get payloadBytes(){return this._getPayloadBytes()},get destinationName(){return this._getDestinationName()},set destinationName(e){this._setDestinationName(e)},get qos(){return this._getQos()},set qos(e){this._setQos(e)},get retained(){return this._getRetained()},set retained(e){this._setRetained(e)},get duplicate(){return this._getDuplicate()},set duplicate(e){this._setDuplicate(e)}},{Client:v,Message:y}}(window)},function(e,t){}]);