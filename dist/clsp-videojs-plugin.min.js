!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}({"./dist/Router.js":function(e,t,n){(function(e){var n,r,o,i,s="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};window,i=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==("undefined"===typeof e?"undefined":s(e))&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";n.r(t),t.default=function(){var e;function t(t,n){console.warn("Error for "+e.id+":"),console.warn(t),n&&console.error(n)}function n(){if(window.MQTTClient)try{window.MQTTClient.disconnect()}catch(e){if(e.message.startsWith("AMQJS0011E"))return;t("Error while trying to disconnect...",e)}}return{onunload:function(){n()},clspRouter:function(){var r=-1;function o(n){try{n.clientId=e.id,window.parent.postMessage(n,"*")}catch(e){t('Error while executing "postMessage"...',e)}}function i(e){var t="";try{t=e.payloadString}catch(e){}o({event:"data",destinationName:e.destinationName,payloadString:t,payloadBytes:e.payloadBytes||null})}function s(e){var r=e.data;try{switch(r.method){case"destroy":n();break;case"subscribe":window.MQTTClient.subscribe(r.topic);break;case"unsubscribe":window.MQTTClient.unsubscribe(r.topic);break;case"publish":try{!function(e,n){try{var r=new window.parent.Paho.Message(n);r.destinationName=e,window.MQTTClient.send(r)}catch(e){t("Error while sending mqtt message...",e)}}(r.topic,JSON.stringify(r.data))}catch(e){return t("Unable to parse message data..."),void t(r.data)}break;default:t('Unknown message method "'+r.method+'" received...')}}catch(e){t("Unknown onMessage error...",e),o({event:"fail",reason:"network failure"}),n()}}function a(){try{n()}catch(e){}-1===r&&(r=setInterval(function(){l()},2e3))}function u(){window.addEventListener?window.addEventListener("message",s,!1):window.attachEvent("onmessage",s),o({event:"ready"}),-1!==r&&(clearInterval(r),r=-1)}function c(e){var n="Failed to connect: Error code "+parseInt(e.errorCode)+": "+e.errorMessage;t(n),o({event:"fail",reason:n}),a()}function d(e){if(0!==e.errorCode){var n="Lost connection: Error code "+parseInt(e.errorCode)+": "+e.errorMessage;t(n),o({event:"fail",reason:n}),a()}}function l(){var n=new window.parent.Paho.Message(JSON.stringify({clientId:e.id}));n.destinationName="iov/clientDisconnect";var r={timeout:120,onSuccess:u,onFailure:c,willMessage:n};!0===e.config.useSSL&&(r.useSSL=!0);try{window.MQTTClient.connected||window.MQTTClient.socket?console.warn("Trying to connect to an already-connected client!"):window.MQTTClient.connect(r)}catch(e){t("Unknown connection failure...",e),o({event:"fail",reason:"connect failed"})}}e=window.parent.videojs.getPlugin("clsp").conduits.getById(window.MqttClientId).iov,function(){try{window.MQTTClient=new window.parent.Paho.Client(e.config.wsbroker,e.config.wsport,e.id),window.MQTTClient.onConnectionLost=d,window.MQTTClient.onMessageArrived=i,l()}catch(e){console.error("IFRAME error"),console.error(e)}}()}}}}])},"object"==s(t)&&"object"==s(e)?e.exports=i():(r=[],void 0===(o="function"===typeof(n=i)?n.apply(t,r):n)||(e.exports=o))}).call(this,n("./node_modules/webpack/buildin/module.js")(e))},"./node_modules/debug/src/browser.js":function(e,t,n){"use strict";(function(r){var o="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e){return(i="function"===typeof Symbol&&"symbol"===o(Symbol.iterator)?function(e){return"undefined"===typeof e?"undefined":o(e)}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":"undefined"===typeof e?"undefined":o(e)})(e)}t.log=function(){var e;return"object"===("undefined"===typeof console?"undefined":i(console))&&console.log&&(e=console).log.apply(e,arguments)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,o=0;t[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&"%c"===e&&(o=++r)}),t.splice(o,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!==typeof r&&"env"in r&&(e=r.env.DEBUG);return e},t.useColors=function(){if("undefined"!==typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=n("./node_modules/debug/src/common.js")(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,n("./node_modules/node-libs-browser/node_modules/process/browser.js"))},"./node_modules/debug/src/common.js":function(e,t,n){"use strict";e.exports=function(e){function t(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){var n;function s(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];if(s.enabled){var i=s,a=Number(new Date),u=a-(n||a);i.diff=u,i.prev=n,i.curr=a,n=a,t[0]=r.coerce(t[0]),"string"!==typeof t[0]&&t.unshift("%O");var c=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,function(e,n){if("%%"===e)return e;c++;var o=r.formatters[n];if("function"===typeof o){var s=t[c];e=o.call(i,s),t.splice(c,1),c--}return e}),r.formatArgs.call(i,t),(i.log||r.log).apply(i,t)}}return s.namespace=e,s.enabled=r.enabled(e),s.useColors=r.useColors(),s.color=t(e),s.destroy=o,s.extend=i,"function"===typeof r.init&&r.init(s),r.instances.push(s),s}function o(){var e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}function i(e,t){return r(this.namespace+("undefined"===typeof t?":":t)+e)}return r.debug=r,r.default=r,r.coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){r.enable("")},r.enable=function(e){var t;r.save(e),r.names=[],r.skips=[];var n=("string"===typeof e?e:"").split(/[\s,]+/),o=n.length;for(t=0;t<o;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){var i=r.instances[t];i.enabled=r.enabled(i.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=n("./node_modules/ms/index.js"),Object.keys(e).forEach(function(t){r[t]=e[t]}),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.enable(r.load()),r}},"./node_modules/lodash/_Symbol.js":function(e,t,n){var r=n("./node_modules/lodash/_root.js").Symbol;e.exports=r},"./node_modules/lodash/_apply.js":function(e,t){e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},"./node_modules/lodash/_arrayLikeKeys.js":function(e,t,n){var r=n("./node_modules/lodash/_baseTimes.js"),o=n("./node_modules/lodash/isArguments.js"),i=n("./node_modules/lodash/isArray.js"),s=n("./node_modules/lodash/isBuffer.js"),a=n("./node_modules/lodash/_isIndex.js"),u=n("./node_modules/lodash/isTypedArray.js"),c=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=i(e),d=!n&&o(e),l=!n&&!d&&s(e),f=!n&&!d&&!l&&u(e),h=n||d||l||f,p=h?r(e.length,String):[],m=p.length;for(var y in e)!t&&!c.call(e,y)||h&&("length"==y||l&&("offset"==y||"parent"==y)||f&&("buffer"==y||"byteLength"==y||"byteOffset"==y)||a(y,m))||p.push(y);return p}},"./node_modules/lodash/_baseGetTag.js":function(e,t,n){var r=n("./node_modules/lodash/_Symbol.js"),o=n("./node_modules/lodash/_getRawTag.js"),i=n("./node_modules/lodash/_objectToString.js"),s="[object Null]",a="[object Undefined]",u=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?a:s:u&&u in Object(e)?o(e):i(e)}},"./node_modules/lodash/_baseIsArguments.js":function(e,t,n){var r=n("./node_modules/lodash/_baseGetTag.js"),o=n("./node_modules/lodash/isObjectLike.js"),i="[object Arguments]";e.exports=function(e){return o(e)&&r(e)==i}},"./node_modules/lodash/_baseIsNative.js":function(e,t,n){var r=n("./node_modules/lodash/isFunction.js"),o=n("./node_modules/lodash/_isMasked.js"),i=n("./node_modules/lodash/isObject.js"),s=n("./node_modules/lodash/_toSource.js"),a=/^\[object .+?Constructor\]$/,u=Function.prototype,c=Object.prototype,d=u.toString,l=c.hasOwnProperty,f=RegExp("^"+d.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!i(e)||o(e))&&(r(e)?f:a).test(s(e))}},"./node_modules/lodash/_baseIsTypedArray.js":function(e,t,n){var r=n("./node_modules/lodash/_baseGetTag.js"),o=n("./node_modules/lodash/isLength.js"),i=n("./node_modules/lodash/isObjectLike.js"),s={};s["[object Float32Array]"]=s["[object Float64Array]"]=s["[object Int8Array]"]=s["[object Int16Array]"]=s["[object Int32Array]"]=s["[object Uint8Array]"]=s["[object Uint8ClampedArray]"]=s["[object Uint16Array]"]=s["[object Uint32Array]"]=!0,s["[object Arguments]"]=s["[object Array]"]=s["[object ArrayBuffer]"]=s["[object Boolean]"]=s["[object DataView]"]=s["[object Date]"]=s["[object Error]"]=s["[object Function]"]=s["[object Map]"]=s["[object Number]"]=s["[object Object]"]=s["[object RegExp]"]=s["[object Set]"]=s["[object String]"]=s["[object WeakMap]"]=!1,e.exports=function(e){return i(e)&&o(e.length)&&!!s[r(e)]}},"./node_modules/lodash/_baseKeysIn.js":function(e,t,n){var r=n("./node_modules/lodash/isObject.js"),o=n("./node_modules/lodash/_isPrototype.js"),i=n("./node_modules/lodash/_nativeKeysIn.js"),s=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return i(e);var t=o(e),n=[];for(var a in e)("constructor"!=a||!t&&s.call(e,a))&&n.push(a);return n}},"./node_modules/lodash/_baseRest.js":function(e,t,n){var r=n("./node_modules/lodash/identity.js"),o=n("./node_modules/lodash/_overRest.js"),i=n("./node_modules/lodash/_setToString.js");e.exports=function(e,t){return i(o(e,t,r),e+"")}},"./node_modules/lodash/_baseSetToString.js":function(e,t,n){var r=n("./node_modules/lodash/constant.js"),o=n("./node_modules/lodash/_defineProperty.js"),i=n("./node_modules/lodash/identity.js"),s=o?function(e,t){return o(e,"toString",{configurable:!0,enumerable:!1,value:r(t),writable:!0})}:i;e.exports=s},"./node_modules/lodash/_baseTimes.js":function(e,t){e.exports=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}},"./node_modules/lodash/_baseUnary.js":function(e,t){e.exports=function(e){return function(t){return e(t)}}},"./node_modules/lodash/_coreJsData.js":function(e,t,n){var r=n("./node_modules/lodash/_root.js")["__core-js_shared__"];e.exports=r},"./node_modules/lodash/_defineProperty.js":function(e,t,n){var r=n("./node_modules/lodash/_getNative.js"),o=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=o},"./node_modules/lodash/_freeGlobal.js":function(e,t,n){(function(t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r="object"==("undefined"===typeof t?"undefined":n(t))&&t&&t.Object===Object&&t;e.exports=r}).call(this,n("./node_modules/webpack/buildin/global.js"))},"./node_modules/lodash/_getNative.js":function(e,t,n){var r=n("./node_modules/lodash/_baseIsNative.js"),o=n("./node_modules/lodash/_getValue.js");e.exports=function(e,t){var n=o(e,t);return r(n)?n:void 0}},"./node_modules/lodash/_getRawTag.js":function(e,t,n){var r=n("./node_modules/lodash/_Symbol.js"),o=Object.prototype,i=o.hasOwnProperty,s=o.toString,a=r?r.toStringTag:void 0;e.exports=function(e){var t=i.call(e,a),n=e[a];try{e[a]=void 0;var r=!0}catch(e){}var o=s.call(e);return r&&(t?e[a]=n:delete e[a]),o}},"./node_modules/lodash/_getValue.js":function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},"./node_modules/lodash/_isIndex.js":function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=9007199254740991,o=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var i="undefined"===typeof e?"undefined":n(e);return!!(t=null==t?r:t)&&("number"==i||"symbol"!=i&&o.test(e))&&e>-1&&e%1==0&&e<t}},"./node_modules/lodash/_isIterateeCall.js":function(e,t,n){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n("./node_modules/lodash/eq.js"),i=n("./node_modules/lodash/isArrayLike.js"),s=n("./node_modules/lodash/_isIndex.js"),a=n("./node_modules/lodash/isObject.js");e.exports=function(e,t,n){if(!a(n))return!1;var u="undefined"===typeof t?"undefined":r(t);return!!("number"==u?i(n)&&s(t,n.length):"string"==u&&t in n)&&o(n[t],e)}},"./node_modules/lodash/_isMasked.js":function(e,t,n){var r,o=n("./node_modules/lodash/_coreJsData.js"),i=(r=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!i&&i in e}},"./node_modules/lodash/_isPrototype.js":function(e,t){var n=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||n)}},"./node_modules/lodash/_nativeKeysIn.js":function(e,t){e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},"./node_modules/lodash/_nodeUtil.js":function(e,t,n){(function(e){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n("./node_modules/lodash/_freeGlobal.js"),i="object"==r(t)&&t&&!t.nodeType&&t,s=i&&"object"==r(e)&&e&&!e.nodeType&&e,a=s&&s.exports===i&&o.process,u=function(){try{var e=s&&s.require&&s.require("util").types;return e||a&&a.binding&&a.binding("util")}catch(e){}}();e.exports=u}).call(this,n("./node_modules/webpack/buildin/module.js")(e))},"./node_modules/lodash/_objectToString.js":function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},"./node_modules/lodash/_overRest.js":function(e,t,n){var r=n("./node_modules/lodash/_apply.js"),o=Math.max;e.exports=function(e,t,n){return t=o(void 0===t?e.length-1:t,0),function(){for(var i=arguments,s=-1,a=o(i.length-t,0),u=Array(a);++s<a;)u[s]=i[t+s];s=-1;for(var c=Array(t+1);++s<t;)c[s]=i[s];return c[t]=n(u),r(e,this,c)}}},"./node_modules/lodash/_root.js":function(e,t,n){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n("./node_modules/lodash/_freeGlobal.js"),i="object"==("undefined"===typeof self?"undefined":r(self))&&self&&self.Object===Object&&self,s=o||i||Function("return this")();e.exports=s},"./node_modules/lodash/_setToString.js":function(e,t,n){var r=n("./node_modules/lodash/_baseSetToString.js"),o=n("./node_modules/lodash/_shortOut.js")(r);e.exports=o},"./node_modules/lodash/_shortOut.js":function(e,t){var n=800,r=16,o=Date.now;e.exports=function(e){var t=0,i=0;return function(){var s=o(),a=r-(s-i);if(i=s,a>0){if(++t>=n)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}},"./node_modules/lodash/_toSource.js":function(e,t){var n=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return n.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},"./node_modules/lodash/constant.js":function(e,t){e.exports=function(e){return function(){return e}}},"./node_modules/lodash/debounce.js":function(e,t,n){var r=n("./node_modules/lodash/isObject.js"),o=n("./node_modules/lodash/now.js"),i=n("./node_modules/lodash/toNumber.js"),s="Expected a function",a=Math.max,u=Math.min;e.exports=function(e,t,n){var c,d,l,f,h,p,m=0,y=!1,v=!1,g=!0;if("function"!=typeof e)throw new TypeError(s);function b(t){var n=c,r=d;return c=d=void 0,m=t,f=e.apply(r,n)}function _(e){var n=e-p;return void 0===p||n>=t||n<0||v&&e-m>=l}function w(){var e=o();if(_(e))return S(e);h=setTimeout(w,function(e){var n=t-(e-p);return v?u(n,l-(e-m)):n}(e))}function S(e){return h=void 0,g&&c?b(e):(c=d=void 0,f)}function E(){var e=o(),n=_(e);if(c=arguments,d=this,p=e,n){if(void 0===h)return function(e){return m=e,h=setTimeout(w,t),y?b(e):f}(p);if(v)return h=setTimeout(w,t),b(p)}return void 0===h&&(h=setTimeout(w,t)),f}return t=i(t)||0,r(n)&&(y=!!n.leading,l=(v="maxWait"in n)?a(i(n.maxWait)||0,t):l,g="trailing"in n?!!n.trailing:g),E.cancel=function(){void 0!==h&&clearTimeout(h),m=0,c=p=d=h=void 0},E.flush=function(){return void 0===h?f:S(o())},E}},"./node_modules/lodash/defaults.js":function(e,t,n){var r=n("./node_modules/lodash/_baseRest.js"),o=n("./node_modules/lodash/eq.js"),i=n("./node_modules/lodash/_isIterateeCall.js"),s=n("./node_modules/lodash/keysIn.js"),a=Object.prototype,u=a.hasOwnProperty,c=r(function(e,t){e=Object(e);var n=-1,r=t.length,c=r>2?t[2]:void 0;for(c&&i(t[0],t[1],c)&&(r=1);++n<r;)for(var d=t[n],l=s(d),f=-1,h=l.length;++f<h;){var p=l[f],m=e[p];(void 0===m||o(m,a[p])&&!u.call(e,p))&&(e[p]=d[p])}return e});e.exports=c},"./node_modules/lodash/eq.js":function(e,t){e.exports=function(e,t){return e===t||e!==e&&t!==t}},"./node_modules/lodash/identity.js":function(e,t){e.exports=function(e){return e}},"./node_modules/lodash/isArguments.js":function(e,t,n){var r=n("./node_modules/lodash/_baseIsArguments.js"),o=n("./node_modules/lodash/isObjectLike.js"),i=Object.prototype,s=i.hasOwnProperty,a=i.propertyIsEnumerable,u=r(function(){return arguments}())?r:function(e){return o(e)&&s.call(e,"callee")&&!a.call(e,"callee")};e.exports=u},"./node_modules/lodash/isArray.js":function(e,t){var n=Array.isArray;e.exports=n},"./node_modules/lodash/isArrayLike.js":function(e,t,n){var r=n("./node_modules/lodash/isFunction.js"),o=n("./node_modules/lodash/isLength.js");e.exports=function(e){return null!=e&&o(e.length)&&!r(e)}},"./node_modules/lodash/isBuffer.js":function(e,t,n){(function(e){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n("./node_modules/lodash/_root.js"),i=n("./node_modules/lodash/stubFalse.js"),s="object"==r(t)&&t&&!t.nodeType&&t,a=s&&"object"==r(e)&&e&&!e.nodeType&&e,u=a&&a.exports===s?o.Buffer:void 0,c=(u?u.isBuffer:void 0)||i;e.exports=c}).call(this,n("./node_modules/webpack/buildin/module.js")(e))},"./node_modules/lodash/isFunction.js":function(e,t,n){var r=n("./node_modules/lodash/_baseGetTag.js"),o=n("./node_modules/lodash/isObject.js"),i="[object AsyncFunction]",s="[object Function]",a="[object GeneratorFunction]",u="[object Proxy]";e.exports=function(e){if(!o(e))return!1;var t=r(e);return t==s||t==a||t==i||t==u}},"./node_modules/lodash/isLength.js":function(e,t){var n=9007199254740991;e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=n}},"./node_modules/lodash/isObject.js":function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=function(e){var t="undefined"===typeof e?"undefined":n(e);return null!=e&&("object"==t||"function"==t)}},"./node_modules/lodash/isObjectLike.js":function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=function(e){return null!=e&&"object"==("undefined"===typeof e?"undefined":n(e))}},"./node_modules/lodash/isSymbol.js":function(e,t,n){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n("./node_modules/lodash/_baseGetTag.js"),i=n("./node_modules/lodash/isObjectLike.js"),s="[object Symbol]";e.exports=function(e){return"symbol"==("undefined"===typeof e?"undefined":r(e))||i(e)&&o(e)==s}},"./node_modules/lodash/isTypedArray.js":function(e,t,n){var r=n("./node_modules/lodash/_baseIsTypedArray.js"),o=n("./node_modules/lodash/_baseUnary.js"),i=n("./node_modules/lodash/_nodeUtil.js"),s=i&&i.isTypedArray,a=s?o(s):r;e.exports=a},"./node_modules/lodash/keysIn.js":function(e,t,n){var r=n("./node_modules/lodash/_arrayLikeKeys.js"),o=n("./node_modules/lodash/_baseKeysIn.js"),i=n("./node_modules/lodash/isArrayLike.js");e.exports=function(e){return i(e)?r(e,!0):o(e)}},"./node_modules/lodash/noop.js":function(e,t){e.exports=function(){}},"./node_modules/lodash/now.js":function(e,t,n){var r=n("./node_modules/lodash/_root.js");e.exports=function(){return r.Date.now()}},"./node_modules/lodash/stubFalse.js":function(e,t){e.exports=function(){return!1}},"./node_modules/lodash/toNumber.js":function(e,t,n){var r=n("./node_modules/lodash/isObject.js"),o=n("./node_modules/lodash/isSymbol.js"),i=NaN,s=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,c=/^0o[0-7]+$/i,d=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(o(e))return i;if(r(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=r(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(s,"");var n=u.test(e);return n||c.test(e)?d(e.slice(2),n?2:8):a.test(e)?i:+e}},"./node_modules/ms/index.js":function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=1e3,o=60*r,i=60*o,s=24*i,a=7*s,u=365.25*s;function c(e,t,n,r){var o=t>=1.5*n;return Math.round(e/n)+" "+r+(o?"s":"")}e.exports=function(e,t){t=t||{};var d="undefined"===typeof e?"undefined":n(e);if("string"===d&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\-?\d?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*u;case"weeks":case"week":case"w":return n*a;case"days":case"day":case"d":return n*s;case"hours":case"hour":case"hrs":case"hr":case"h":return n*i;case"minutes":case"minute":case"mins":case"min":case"m":return n*o;case"seconds":case"second":case"secs":case"sec":case"s":return n*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===d&&!1===isNaN(e))return t.long?function(e){var t=Math.abs(e);if(t>=s)return c(e,t,s,"day");if(t>=i)return c(e,t,i,"hour");if(t>=o)return c(e,t,o,"minute");if(t>=r)return c(e,t,r,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=s)return Math.round(e/s)+"d";if(t>=i)return Math.round(e/i)+"h";if(t>=o)return Math.round(e/o)+"m";if(t>=r)return Math.round(e/r)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},"./node_modules/node-libs-browser/node_modules/process/browser.js":function(e,t){var n,r,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"===typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"===typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var u,c=[],d=!1,l=-1;function f(){d&&u&&(d=!1,u.length?c=u.concat(c):l=-1,c.length&&h())}function h(){if(!d){var e=a(f);d=!0;for(var t=c.length;t;){for(u=c,c=[];++l<t;)u&&u[l].run();l=-1,t=c.length}u=null,d=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new p(e,t)),1!==c.length||d||a(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},"./node_modules/paho-client/src/paho-mqtt.js":function(e,t,n){(function(e,r){var o,i,s,a="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};s=function(){return function(e){var t,n=e.localStorage||(t={},{setItem:function(e,n){t[e]=n},getItem:function(e){return t[e]},removeItem:function(e){delete t[e]}}),r={CONNECT:1,CONNACK:2,PUBLISH:3,PUBACK:4,PUBREC:5,PUBREL:6,PUBCOMP:7,SUBSCRIBE:8,SUBACK:9,UNSUBSCRIBE:10,UNSUBACK:11,PINGREQ:12,PINGRESP:13,DISCONNECT:14},o=function(e,t){for(var n in e)if(e.hasOwnProperty(n)){if(!t.hasOwnProperty(n)){var r="Unknown property, "+n+". Valid properties are:";for(var o in t)t.hasOwnProperty(o)&&(r=r+" "+o);throw new Error(r)}if(a(e[n])!==t[n])throw new Error(c(s.INVALID_TYPE,[a(e[n]),n]))}},i=function(e,t){return function(){return e.apply(t,arguments)}},s={OK:{code:0,text:"AMQJSC0000I OK."},CONNECT_TIMEOUT:{code:1,text:"AMQJSC0001E Connect timed out."},SUBSCRIBE_TIMEOUT:{code:2,text:"AMQJS0002E Subscribe timed out."},UNSUBSCRIBE_TIMEOUT:{code:3,text:"AMQJS0003E Unsubscribe timed out."},PING_TIMEOUT:{code:4,text:"AMQJS0004E Ping timed out."},INTERNAL_ERROR:{code:5,text:"AMQJS0005E Internal error. Error Message: {0}, Stack trace: {1}"},CONNACK_RETURNCODE:{code:6,text:"AMQJS0006E Bad Connack return code:{0} {1}."},SOCKET_ERROR:{code:7,text:"AMQJS0007E Socket error:{0}."},SOCKET_CLOSE:{code:8,text:"AMQJS0008I Socket closed."},MALFORMED_UTF:{code:9,text:"AMQJS0009E Malformed UTF data:{0} {1} {2}."},UNSUPPORTED:{code:10,text:"AMQJS0010E {0} is not supported by this browser."},INVALID_STATE:{code:11,text:"AMQJS0011E Invalid state {0}."},INVALID_TYPE:{code:12,text:"AMQJS0012E Invalid type {0} for {1}."},INVALID_ARGUMENT:{code:13,text:"AMQJS0013E Invalid argument {0} for {1}."},UNSUPPORTED_OPERATION:{code:14,text:"AMQJS0014E Unsupported operation."},INVALID_STORED_DATA:{code:15,text:"AMQJS0015E Invalid data in local storage key={0} value={1}."},INVALID_MQTT_MESSAGE_TYPE:{code:16,text:"AMQJS0016E Invalid MQTT message type {0}."},MALFORMED_UNICODE:{code:17,text:"AMQJS0017E Malformed Unicode string:{0} {1}."},BUFFER_FULL:{code:18,text:"AMQJS0018E Message buffer is full, maximum buffer size: {0}."}},u={0:"Connection Accepted",1:"Connection Refused: unacceptable protocol version",2:"Connection Refused: identifier rejected",3:"Connection Refused: server unavailable",4:"Connection Refused: bad user name or password",5:"Connection Refused: not authorized"},c=function(e,t){var n=e.text;if(t)for(var r,o,i=0;i<t.length;i++)if(r="{"+i+"}",(o=n.indexOf(r))>0){var s=n.substring(0,o),a=n.substring(o+r.length);n=s+t[i]+a}return n},d=[0,6,77,81,73,115,100,112,3],l=[0,4,77,81,84,84,4],f=function(e,t){for(var n in this.type=e,t)t.hasOwnProperty(n)&&(this[n]=t[n])};function h(e,t){var n,o=t,i=e[t],s=i>>4,a=i&=15;t+=1;var u=0,c=1;do{if(t==e.length)return[null,o];u+=(127&(n=e[t++]))*c,c*=128}while(0!==(128&n));var d=t+u;if(d>e.length)return[null,o];var l=new f(s);switch(s){case r.CONNACK:1&e[t++]&&(l.sessionPresent=!0),l.returnCode=e[t++];break;case r.PUBLISH:var h=a>>1&3,p=y(e,t),m=b(e,t+=2,p);t+=p,h>0&&(l.messageIdentifier=y(e,t),t+=2);var v=new E(e.subarray(t,d));1==(1&a)&&(v.retained=!0),8==(8&a)&&(v.duplicate=!0),v.qos=h,v.destinationName=m,l.payloadMessage=v;break;case r.PUBACK:case r.PUBREC:case r.PUBREL:case r.PUBCOMP:case r.UNSUBACK:l.messageIdentifier=y(e,t);break;case r.SUBACK:l.messageIdentifier=y(e,t),t+=2,l.returnCode=e.subarray(t,d)}return[l,d]}function p(e,t,n){return t[n++]=e>>8,t[n++]=e%256,n}function m(e,t,n,r){return g(e,n,r=p(t,n,r)),r+t}function y(e,t){return 256*e[t]+e[t+1]}function v(e){for(var t=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);r>2047?(55296<=r&&r<=56319&&(n++,t++),t+=3):r>127?t+=2:t++}return t}function g(e,t,n){for(var r=n,o=0;o<e.length;o++){var i=e.charCodeAt(o);if(55296<=i&&i<=56319){var a=e.charCodeAt(++o);if(isNaN(a))throw new Error(c(s.MALFORMED_UNICODE,[i,a]));i=a-56320+(i-55296<<10)+65536}i<=127?t[r++]=i:i<=2047?(t[r++]=i>>6&31|192,t[r++]=63&i|128):i<=65535?(t[r++]=i>>12&15|224,t[r++]=i>>6&63|128,t[r++]=63&i|128):(t[r++]=i>>18&7|240,t[r++]=i>>12&63|128,t[r++]=i>>6&63|128,t[r++]=63&i|128)}return t}function b(e,t,n){for(var r,o="",i=t;i<t+n;){var a=e[i++];if(a<128)r=a;else{var u=e[i++]-128;if(u<0)throw new Error(c(s.MALFORMED_UTF,[a.toString(16),u.toString(16),""]));if(a<224)r=64*(a-192)+u;else{var d=e[i++]-128;if(d<0)throw new Error(c(s.MALFORMED_UTF,[a.toString(16),u.toString(16),d.toString(16)]));if(a<240)r=4096*(a-224)+64*u+d;else{var l=e[i++]-128;if(l<0)throw new Error(c(s.MALFORMED_UTF,[a.toString(16),u.toString(16),d.toString(16),l.toString(16)]));if(!(a<248))throw new Error(c(s.MALFORMED_UTF,[a.toString(16),u.toString(16),d.toString(16),l.toString(16)]));r=262144*(a-240)+4096*u+64*d+l}}}r>65535&&(r-=65536,o+=String.fromCharCode(55296+(r>>10)),r=56320+(1023&r)),o+=String.fromCharCode(r)}return o}f.prototype.encode=function(){var e,t=(15&this.type)<<4,n=0,o=[],i=0;switch(void 0!==this.messageIdentifier&&(n+=2),this.type){case r.CONNECT:switch(this.mqttVersion){case 3:n+=d.length+3;break;case 4:n+=l.length+3}n+=v(this.clientId)+2,void 0!==this.willMessage&&(n+=v(this.willMessage.destinationName)+2,(e=this.willMessage.payloadBytes)instanceof Uint8Array||(e=new Uint8Array(a)),n+=e.byteLength+2),void 0!==this.userName&&(n+=v(this.userName)+2),void 0!==this.password&&(n+=v(this.password)+2);break;case r.SUBSCRIBE:t|=2;for(var s=0;s<this.topics.length;s++)o[s]=v(this.topics[s]),n+=o[s]+2;n+=this.requestedQos.length;break;case r.UNSUBSCRIBE:t|=2;for(s=0;s<this.topics.length;s++)o[s]=v(this.topics[s]),n+=o[s]+2;break;case r.PUBREL:t|=2;break;case r.PUBLISH:this.payloadMessage.duplicate&&(t|=8),t=t|=this.payloadMessage.qos<<1,this.payloadMessage.retained&&(t|=1),n+=(i=v(this.payloadMessage.destinationName))+2;var a=this.payloadMessage.payloadBytes;n+=a.byteLength,a instanceof ArrayBuffer?a=new Uint8Array(a):a instanceof Uint8Array||(a=new Uint8Array(a.buffer));break;case r.DISCONNECT:}var u=function(e){var t=new Array(1),n=0;do{var r=e%128;(e>>=7)>0&&(r|=128),t[n++]=r}while(e>0&&n<4);return t}(n),c=u.length+1,f=new ArrayBuffer(n+c),h=new Uint8Array(f);if(h[0]=t,h.set(u,1),this.type==r.PUBLISH)c=m(this.payloadMessage.destinationName,i,h,c);else if(this.type==r.CONNECT){switch(this.mqttVersion){case 3:h.set(d,c),c+=d.length;break;case 4:h.set(l,c),c+=l.length}var y=0;this.cleanSession&&(y=2),void 0!==this.willMessage&&(y|=4,y|=this.willMessage.qos<<3,this.willMessage.retained&&(y|=32)),void 0!==this.userName&&(y|=128),void 0!==this.password&&(y|=64),h[c++]=y,c=p(this.keepAliveInterval,h,c)}switch(void 0!==this.messageIdentifier&&(c=p(this.messageIdentifier,h,c)),this.type){case r.CONNECT:c=m(this.clientId,v(this.clientId),h,c),void 0!==this.willMessage&&(c=m(this.willMessage.destinationName,v(this.willMessage.destinationName),h,c),c=p(e.byteLength,h,c),h.set(e,c),c+=e.byteLength),void 0!==this.userName&&(c=m(this.userName,v(this.userName),h,c)),void 0!==this.password&&(c=m(this.password,v(this.password),h,c));break;case r.PUBLISH:h.set(a,c);break;case r.SUBSCRIBE:for(s=0;s<this.topics.length;s++)c=m(this.topics[s],o[s],h,c),h[c++]=this.requestedQos[s];break;case r.UNSUBSCRIBE:for(s=0;s<this.topics.length;s++)c=m(this.topics[s],o[s],h,c)}return f};var _=function(e,t){this._client=e,this._keepAliveInterval=1e3*t,this.isReset=!1;var n=new f(r.PINGREQ).encode(),o=function(e){return function(){return i.apply(e)}},i=function(){this.isReset?(this.isReset=!1,this._client._trace("Pinger.doPing","send PINGREQ"),this._client.socket.send(n),this.timeout=setTimeout(o(this),this._keepAliveInterval)):(this._client._trace("Pinger.doPing","Timed out"),this._client._disconnected(s.PING_TIMEOUT.code,c(s.PING_TIMEOUT)))};this.reset=function(){this.isReset=!0,clearTimeout(this.timeout),this._keepAliveInterval>0&&(this.timeout=setTimeout(o(this),this._keepAliveInterval))},this.cancel=function(){clearTimeout(this.timeout)}},w=function(e,t,n,r){t||(t=30);this.timeout=setTimeout(function(e,t,n){return function(){return e.apply(t,n)}}(n,e,r),1e3*t),this.cancel=function(){clearTimeout(this.timeout)}},S=function(t,r,o,i,a){if(!("WebSocket"in e&&null!==e.WebSocket))throw new Error(c(s.UNSUPPORTED,["WebSocket"]));if(!("ArrayBuffer"in e&&null!==e.ArrayBuffer))throw new Error(c(s.UNSUPPORTED,["ArrayBuffer"]));for(var u in this._trace("Paho.Client",t,r,o,i,a),this.host=r,this.port=o,this.path=i,this.uri=t,this.clientId=a,this._wsuri=null,this._localKey=r+":"+o+("/mqtt"!=i?":"+i:"")+":"+a+":",this._msg_queue=[],this._buffered_msg_queue=[],this._sentMessages={},this._receivedMessages={},this._notify_msg_sent={},this._message_identifier=1,this._sequence=0,n)0!==u.indexOf("Sent:"+this._localKey)&&0!==u.indexOf("Received:"+this._localKey)||this.restore(u)};S.prototype.host=null,S.prototype.port=null,S.prototype.path=null,S.prototype.uri=null,S.prototype.clientId=null,S.prototype.socket=null,S.prototype.connected=!1,S.prototype.maxMessageIdentifier=65536,S.prototype.connectOptions=null,S.prototype.hostIndex=null,S.prototype.onConnected=null,S.prototype.onConnectionLost=null,S.prototype.onMessageDelivered=null,S.prototype.onMessageArrived=null,S.prototype.traceFunction=null,S.prototype._msg_queue=null,S.prototype._buffered_msg_queue=null,S.prototype._connectTimeout=null,S.prototype.sendPinger=null,S.prototype.receivePinger=null,S.prototype._reconnectInterval=1,S.prototype._reconnecting=!1,S.prototype._reconnectTimeout=null,S.prototype.disconnectedPublishing=!1,S.prototype.disconnectedBufferSize=5e3,S.prototype.receiveBuffer=null,S.prototype._traceBuffer=null,S.prototype._MAX_TRACE_ENTRIES=100,S.prototype.connect=function(e){var t=this._traceMask(e,"password");if(this._trace("Client.connect",t,this.socket,this.connected),this.connected)throw new Error(c(s.INVALID_STATE,["already connected"]));if(this.socket)throw new Error(c(s.INVALID_STATE,["already connected"]));this._reconnecting&&(this._reconnectTimeout.cancel(),this._reconnectTimeout=null,this._reconnecting=!1),this.connectOptions=e,this._reconnectInterval=1,this._reconnecting=!1,e.uris?(this.hostIndex=0,this._doConnect(e.uris[0])):this._doConnect(this.uri)},S.prototype.subscribe=function(e,t){if(this._trace("Client.subscribe",e,t),!this.connected)throw new Error(c(s.INVALID_STATE,["not connected"]));var n=new f(r.SUBSCRIBE);n.topics=e.constructor===Array?e:[e],void 0===t.qos&&(t.qos=0),n.requestedQos=[];for(var o=0;o<n.topics.length;o++)n.requestedQos[o]=t.qos;t.onSuccess&&(n.onSuccess=function(e){t.onSuccess({invocationContext:t.invocationContext,grantedQos:e})}),t.onFailure&&(n.onFailure=function(e){t.onFailure({invocationContext:t.invocationContext,errorCode:e,errorMessage:c(e)})}),t.timeout&&(n.timeOut=new w(this,t.timeout,t.onFailure,[{invocationContext:t.invocationContext,errorCode:s.SUBSCRIBE_TIMEOUT.code,errorMessage:c(s.SUBSCRIBE_TIMEOUT)}])),this._requires_ack(n),this._schedule_message(n)},S.prototype.unsubscribe=function(e,t){if(this._trace("Client.unsubscribe",e,t),!this.connected)throw new Error(c(s.INVALID_STATE,["not connected"]));var n=new f(r.UNSUBSCRIBE);n.topics=e.constructor===Array?e:[e],t.onSuccess&&(n.callback=function(){t.onSuccess({invocationContext:t.invocationContext})}),t.timeout&&(n.timeOut=new w(this,t.timeout,t.onFailure,[{invocationContext:t.invocationContext,errorCode:s.UNSUBSCRIBE_TIMEOUT.code,errorMessage:c(s.UNSUBSCRIBE_TIMEOUT)}])),this._requires_ack(n),this._schedule_message(n)},S.prototype.send=function(e){this._trace("Client.send",e);var t=new f(r.PUBLISH);if(t.payloadMessage=e,this.connected)e.qos>0?this._requires_ack(t):this.onMessageDelivered&&(this._notify_msg_sent[t]=this.onMessageDelivered(t.payloadMessage)),this._schedule_message(t);else{if(!this._reconnecting||!this.disconnectedPublishing)throw new Error(c(s.INVALID_STATE,["not connected"]));if(Object.keys(this._sentMessages).length+this._buffered_msg_queue.length>this.disconnectedBufferSize)throw new Error(c(s.BUFFER_FULL,[this.disconnectedBufferSize]));e.qos>0?this._requires_ack(t):(t.sequence=++this._sequence,this._buffered_msg_queue.unshift(t))}},S.prototype.disconnect=function(){if(this._trace("Client.disconnect"),this._reconnecting&&(this._reconnectTimeout.cancel(),this._reconnectTimeout=null,this._reconnecting=!1),!this.socket)throw new Error(c(s.INVALID_STATE,["not connecting or connected"]));var e=new f(r.DISCONNECT);this._notify_msg_sent[e]=i(this._disconnected,this),this._schedule_message(e)},S.prototype.getTraceLog=function(){if(null!==this._traceBuffer){for(var e in this._trace("Client.getTraceLog",new Date),this._trace("Client.getTraceLog in flight messages",this._sentMessages.length),this._sentMessages)this._trace("_sentMessages ",e,this._sentMessages[e]);for(var e in this._receivedMessages)this._trace("_receivedMessages ",e,this._receivedMessages[e]);return this._traceBuffer}},S.prototype.startTrace=function(){null===this._traceBuffer&&(this._traceBuffer=[]),this._trace("Client.startTrace",new Date,"@VERSION@-@BUILDLEVEL@")},S.prototype.stopTrace=function(){delete this._traceBuffer},S.prototype._doConnect=function(e){if(this.connectOptions.useSSL){var t=e.split(":");t[0]="wss",e=t.join(":")}this._wsuri=e,this.connected=!1,this.connectOptions.mqttVersion<4?this.socket=new WebSocket(e,["mqttv3.1"]):this.socket=new WebSocket(e,["mqtt"]),this.socket.binaryType="arraybuffer",this.socket.onopen=i(this._on_socket_open,this),this.socket.onmessage=i(this._on_socket_message,this),this.socket.onerror=i(this._on_socket_error,this),this.socket.onclose=i(this._on_socket_close,this),this.sendPinger=new _(this,this.connectOptions.keepAliveInterval),this.receivePinger=new _(this,this.connectOptions.keepAliveInterval),this._connectTimeout&&(this._connectTimeout.cancel(),this._connectTimeout=null),this._connectTimeout=new w(this,this.connectOptions.timeout,this._disconnected,[s.CONNECT_TIMEOUT.code,c(s.CONNECT_TIMEOUT)])},S.prototype._schedule_message=function(e){this._msg_queue.unshift(e),this.connected&&this._process_queue()},S.prototype.store=function(e,t){var o={type:t.type,messageIdentifier:t.messageIdentifier,version:1};switch(t.type){case r.PUBLISH:t.pubRecReceived&&(o.pubRecReceived=!0),o.payloadMessage={};for(var i="",a=t.payloadMessage.payloadBytes,u=0;u<a.length;u++)a[u]<=15?i=i+"0"+a[u].toString(16):i+=a[u].toString(16);o.payloadMessage.payloadHex=i,o.payloadMessage.qos=t.payloadMessage.qos,o.payloadMessage.destinationName=t.payloadMessage.destinationName,t.payloadMessage.duplicate&&(o.payloadMessage.duplicate=!0),t.payloadMessage.retained&&(o.payloadMessage.retained=!0),0===e.indexOf("Sent:")&&(void 0===t.sequence&&(t.sequence=++this._sequence),o.sequence=t.sequence);break;default:throw Error(c(s.INVALID_STORED_DATA,[e+this._localKey+t.messageIdentifier,o]))}n.setItem(e+this._localKey+t.messageIdentifier,JSON.stringify(o))},S.prototype.restore=function(e){var t=n.getItem(e),o=JSON.parse(t),i=new f(o.type,o);switch(o.type){case r.PUBLISH:for(var a=o.payloadMessage.payloadHex,u=new ArrayBuffer(a.length/2),d=new Uint8Array(u),l=0;a.length>=2;){var h=parseInt(a.substring(0,2),16);a=a.substring(2,a.length),d[l++]=h}var p=new E(d);p.qos=o.payloadMessage.qos,p.destinationName=o.payloadMessage.destinationName,o.payloadMessage.duplicate&&(p.duplicate=!0),o.payloadMessage.retained&&(p.retained=!0),i.payloadMessage=p;break;default:throw Error(c(s.INVALID_STORED_DATA,[e,t]))}0===e.indexOf("Sent:"+this._localKey)?(i.payloadMessage.duplicate=!0,this._sentMessages[i.messageIdentifier]=i):0===e.indexOf("Received:"+this._localKey)&&(this._receivedMessages[i.messageIdentifier]=i)},S.prototype._process_queue=function(){for(var e=null;e=this._msg_queue.pop();)this._socket_send(e),this._notify_msg_sent[e]&&(this._notify_msg_sent[e](),delete this._notify_msg_sent[e])},S.prototype._requires_ack=function(e){var t=Object.keys(this._sentMessages).length;if(t>this.maxMessageIdentifier)throw Error("Too many messages:"+t);for(;void 0!==this._sentMessages[this._message_identifier];)this._message_identifier++;e.messageIdentifier=this._message_identifier,this._sentMessages[e.messageIdentifier]=e,e.type===r.PUBLISH&&this.store("Sent:",e),this._message_identifier===this.maxMessageIdentifier&&(this._message_identifier=1)},S.prototype._on_socket_open=function(){var e=new f(r.CONNECT,this.connectOptions);e.clientId=this.clientId,this._socket_send(e)},S.prototype._on_socket_message=function(e){this._trace("Client._on_socket_message",e.data);for(var t=this._deframeMessages(e.data),n=0;n<t.length;n+=1)this._handleMessage(t[n])},S.prototype._deframeMessages=function(e){var t=new Uint8Array(e),n=[];if(this.receiveBuffer){var r=new Uint8Array(this.receiveBuffer.length+t.length);r.set(this.receiveBuffer),r.set(t,this.receiveBuffer.length),t=r,delete this.receiveBuffer}try{for(var o=0;o<t.length;){var i=h(t,o),a=i[0];if(o=i[1],null===a)break;n.push(a)}o<t.length&&(this.receiveBuffer=t.subarray(o))}catch(e){var u="undefined"==e.hasOwnProperty("stack")?e.stack.toString():"No Error Stack Available";return void this._disconnected(s.INTERNAL_ERROR.code,c(s.INTERNAL_ERROR,[e.message,u]))}return n},S.prototype._handleMessage=function(e){this._trace("Client._handleMessage",e);try{switch(e.type){case r.CONNACK:if(this._connectTimeout.cancel(),this._reconnectTimeout&&this._reconnectTimeout.cancel(),this.connectOptions.cleanSession){for(var t in this._sentMessages){var o=this._sentMessages[t];n.removeItem("Sent:"+this._localKey+o.messageIdentifier)}for(var t in this._sentMessages={},this._receivedMessages){var i=this._receivedMessages[t];n.removeItem("Received:"+this._localKey+i.messageIdentifier)}this._receivedMessages={}}if(0!==e.returnCode){this._disconnected(s.CONNACK_RETURNCODE.code,c(s.CONNACK_RETURNCODE,[e.returnCode,u[e.returnCode]]));break}this.connected=!0,this.connectOptions.uris&&(this.hostIndex=this.connectOptions.uris.length);var a=[];for(var d in this._sentMessages)this._sentMessages.hasOwnProperty(d)&&a.push(this._sentMessages[d]);if(this._buffered_msg_queue.length>0)for(var l=null;l=this._buffered_msg_queue.pop();)a.push(l),this.onMessageDelivered&&(this._notify_msg_sent[l]=this.onMessageDelivered(l.payloadMessage));for(var h=0,p=(a=a.sort(function(e,t){return e.sequence-t.sequence})).length;h<p;h++){if((o=a[h]).type==r.PUBLISH&&o.pubRecReceived){var m=new f(r.PUBREL,{messageIdentifier:o.messageIdentifier});this._schedule_message(m)}else this._schedule_message(o)}this.connectOptions.onSuccess&&this.connectOptions.onSuccess({invocationContext:this.connectOptions.invocationContext});var y=!1;this._reconnecting&&(y=!0,this._reconnectInterval=1,this._reconnecting=!1),this._connected(y,this._wsuri),this._process_queue();break;case r.PUBLISH:this._receivePublish(e);break;case r.PUBACK:(o=this._sentMessages[e.messageIdentifier])&&(delete this._sentMessages[e.messageIdentifier],n.removeItem("Sent:"+this._localKey+e.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(o.payloadMessage));break;case r.PUBREC:if(o=this._sentMessages[e.messageIdentifier]){o.pubRecReceived=!0;m=new f(r.PUBREL,{messageIdentifier:e.messageIdentifier});this.store("Sent:",o),this._schedule_message(m)}break;case r.PUBREL:i=this._receivedMessages[e.messageIdentifier];n.removeItem("Received:"+this._localKey+e.messageIdentifier),i&&(this._receiveMessage(i),delete this._receivedMessages[e.messageIdentifier]);var v=new f(r.PUBCOMP,{messageIdentifier:e.messageIdentifier});this._schedule_message(v);break;case r.PUBCOMP:o=this._sentMessages[e.messageIdentifier];delete this._sentMessages[e.messageIdentifier],n.removeItem("Sent:"+this._localKey+e.messageIdentifier),this.onMessageDelivered&&this.onMessageDelivered(o.payloadMessage);break;case r.SUBACK:(o=this._sentMessages[e.messageIdentifier])&&(o.timeOut&&o.timeOut.cancel(),128===e.returnCode[0]?o.onFailure&&o.onFailure(e.returnCode):o.onSuccess&&o.onSuccess(e.returnCode),delete this._sentMessages[e.messageIdentifier]);break;case r.UNSUBACK:(o=this._sentMessages[e.messageIdentifier])&&(o.timeOut&&o.timeOut.cancel(),o.callback&&o.callback(),delete this._sentMessages[e.messageIdentifier]);break;case r.PINGRESP:this.sendPinger.reset();break;case r.DISCONNECT:this._disconnected(s.INVALID_MQTT_MESSAGE_TYPE.code,c(s.INVALID_MQTT_MESSAGE_TYPE,[e.type]));break;default:this._disconnected(s.INVALID_MQTT_MESSAGE_TYPE.code,c(s.INVALID_MQTT_MESSAGE_TYPE,[e.type]))}}catch(e){var g="undefined"==e.hasOwnProperty("stack")?e.stack.toString():"No Error Stack Available";return void this._disconnected(s.INTERNAL_ERROR.code,c(s.INTERNAL_ERROR,[e.message,g]))}},S.prototype._on_socket_error=function(e){this._reconnecting||this._disconnected(s.SOCKET_ERROR.code,c(s.SOCKET_ERROR,[e.data]))},S.prototype._on_socket_close=function(){this._reconnecting||this._disconnected(s.SOCKET_CLOSE.code,c(s.SOCKET_CLOSE))},S.prototype._socket_send=function(e){if(1==e.type){var t=this._traceMask(e,"password");this._trace("Client._socket_send",t)}else this._trace("Client._socket_send",e);this.socket.send(e.encode()),this.sendPinger.reset()},S.prototype._receivePublish=function(e){switch(e.payloadMessage.qos){case"undefined":case 0:this._receiveMessage(e);break;case 1:var t=new f(r.PUBACK,{messageIdentifier:e.messageIdentifier});this._schedule_message(t),this._receiveMessage(e);break;case 2:this._receivedMessages[e.messageIdentifier]=e,this.store("Received:",e);var n=new f(r.PUBREC,{messageIdentifier:e.messageIdentifier});this._schedule_message(n);break;default:throw Error("Invaild qos="+e.payloadMessage.qos)}},S.prototype._receiveMessage=function(e){this.onMessageArrived&&this.onMessageArrived(e.payloadMessage)},S.prototype._connected=function(e,t){this.onConnected&&this.onConnected(e,t)},S.prototype._reconnect=function(){this._trace("Client._reconnect"),this.connected||(this._reconnecting=!0,this.sendPinger.cancel(),this.receivePinger.cancel(),this._reconnectInterval<128&&(this._reconnectInterval=2*this._reconnectInterval),this.connectOptions.uris?(this.hostIndex=0,this._doConnect(this.connectOptions.uris[0])):this._doConnect(this.uri))},S.prototype._disconnected=function(e,t){if(this._trace("Client._disconnected",e,t),void 0!==e&&this._reconnecting)this._reconnectTimeout=new w(this,this._reconnectInterval,this._reconnect);else if(this.sendPinger.cancel(),this.receivePinger.cancel(),this._connectTimeout&&(this._connectTimeout.cancel(),this._connectTimeout=null),this._msg_queue=[],this._buffered_msg_queue=[],this._notify_msg_sent={},this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,1===this.socket.readyState&&this.socket.close(),delete this.socket),this.connectOptions.uris&&this.hostIndex<this.connectOptions.uris.length-1)this.hostIndex++,this._doConnect(this.connectOptions.uris[this.hostIndex]);else if(void 0===e&&(e=s.OK.code,t=c(s.OK)),this.connected){if(this.connected=!1,this.onConnectionLost&&this.onConnectionLost({errorCode:e,errorMessage:t,reconnect:this.connectOptions.reconnect,uri:this._wsuri}),e!==s.OK.code&&this.connectOptions.reconnect)return this._reconnectInterval=1,void this._reconnect()}else 4===this.connectOptions.mqttVersion&&!1===this.connectOptions.mqttVersionExplicit?(this._trace("Failed to connect V4, dropping back to V3"),this.connectOptions.mqttVersion=3,this.connectOptions.uris?(this.hostIndex=0,this._doConnect(this.connectOptions.uris[0])):this._doConnect(this.uri)):this.connectOptions.onFailure&&this.connectOptions.onFailure({invocationContext:this.connectOptions.invocationContext,errorCode:e,errorMessage:t})},S.prototype._trace=function(){if(this.traceFunction){var e=Array.prototype.slice.call(arguments);for(var t in e)"undefined"!==typeof e[t]&&e.splice(t,1,JSON.stringify(e[t]));var n=e.join("");this.traceFunction({severity:"Debug",message:n})}if(null!==this._traceBuffer){t=0;for(var r=arguments.length;t<r;t++)this._traceBuffer.length==this._MAX_TRACE_ENTRIES&&this._traceBuffer.shift(),0===t?this._traceBuffer.push(arguments[t]):"undefined"===typeof arguments[t]?this._traceBuffer.push(arguments[t]):this._traceBuffer.push("  "+JSON.stringify(arguments[t]))}},S.prototype._traceMask=function(e,t){var n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]=r==t?"******":e[r]);return n};var E=function(e){var t,n;if(!("string"===typeof e||e instanceof ArrayBuffer||ArrayBuffer.isView(e)&&!(e instanceof DataView)))throw c(s.INVALID_ARGUMENT,[e,"newPayload"]);t=e;var r=0,o=!1,i=!1;Object.defineProperties(this,{payloadString:{enumerable:!0,get:function(){return"string"===typeof t?t:b(t,0,t.length)}},payloadBytes:{enumerable:!0,get:function(){if("string"===typeof t){var e=new ArrayBuffer(v(t)),n=new Uint8Array(e);return g(t,n,0),n}return t}},destinationName:{enumerable:!0,get:function(){return n},set:function(e){if("string"!==typeof e)throw new Error(c(s.INVALID_ARGUMENT,[e,"newDestinationName"]));n=e}},qos:{enumerable:!0,get:function(){return r},set:function(e){if(0!==e&&1!==e&&2!==e)throw new Error("Invalid argument:"+e);r=e}},retained:{enumerable:!0,get:function(){return o},set:function(e){if("boolean"!==typeof e)throw new Error(c(s.INVALID_ARGUMENT,[e,"newRetained"]));o=e}},topic:{enumerable:!0,get:function(){return n},set:function(e){n=e}},duplicate:{enumerable:!0,get:function(){return i},set:function(e){i=e}}})};return{Client:function(e,t,n,r){var i;if("string"!==typeof e)throw new Error(c(s.INVALID_TYPE,["undefined"===typeof e?"undefined":a(e),"host"]));if(2==arguments.length){r=t;var u=(i=e).match(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/);if(!u)throw new Error(c(s.INVALID_ARGUMENT,[e,"host"]));e=u[4]||u[2],t=parseInt(u[7]),n=u[8]}else{if(3==arguments.length&&(r=n,n="/mqtt"),"number"!==typeof t||t<0)throw new Error(c(s.INVALID_TYPE,["undefined"===typeof t?"undefined":a(t),"port"]));if("string"!==typeof n)throw new Error(c(s.INVALID_TYPE,["undefined"===typeof n?"undefined":a(n),"path"]));var d=-1!==e.indexOf(":")&&"["!==e.slice(0,1)&&"]"!==e.slice(-1);i="ws://"+(d?"["+e+"]":e)+":"+t+n}for(var l=0,f=0;f<r.length;f++){var h=r.charCodeAt(f);55296<=h&&h<=56319&&f++,l++}if("string"!==typeof r||l>65535)throw new Error(c(s.INVALID_ARGUMENT,[r,"clientId"]));var p=new S(i,e,t,n,r);Object.defineProperties(this,{host:{get:function(){return e},set:function(){throw new Error(c(s.UNSUPPORTED_OPERATION))}},port:{get:function(){return t},set:function(){throw new Error(c(s.UNSUPPORTED_OPERATION))}},path:{get:function(){return n},set:function(){throw new Error(c(s.UNSUPPORTED_OPERATION))}},uri:{get:function(){return i},set:function(){throw new Error(c(s.UNSUPPORTED_OPERATION))}},clientId:{get:function(){return p.clientId},set:function(){throw new Error(c(s.UNSUPPORTED_OPERATION))}},onConnected:{get:function(){return p.onConnected},set:function(e){if("function"!==typeof e)throw new Error(c(s.INVALID_TYPE,["undefined"===typeof e?"undefined":a(e),"onConnected"]));p.onConnected=e}},disconnectedPublishing:{get:function(){return p.disconnectedPublishing},set:function(e){p.disconnectedPublishing=e}},disconnectedBufferSize:{get:function(){return p.disconnectedBufferSize},set:function(e){p.disconnectedBufferSize=e}},onConnectionLost:{get:function(){return p.onConnectionLost},set:function(e){if("function"!==typeof e)throw new Error(c(s.INVALID_TYPE,["undefined"===typeof e?"undefined":a(e),"onConnectionLost"]));p.onConnectionLost=e}},onMessageDelivered:{get:function(){return p.onMessageDelivered},set:function(e){if("function"!==typeof e)throw new Error(c(s.INVALID_TYPE,["undefined"===typeof e?"undefined":a(e),"onMessageDelivered"]));p.onMessageDelivered=e}},onMessageArrived:{get:function(){return p.onMessageArrived},set:function(e){if("function"!==typeof e)throw new Error(c(s.INVALID_TYPE,["undefined"===typeof e?"undefined":a(e),"onMessageArrived"]));p.onMessageArrived=e}},trace:{get:function(){return p.traceFunction},set:function(e){if("function"!==typeof e)throw new Error(c(s.INVALID_TYPE,["undefined"===typeof e?"undefined":a(e),"onTrace"]));p.traceFunction=e}}}),this.connect=function(e){if(o(e=e||{},{timeout:"number",userName:"string",password:"string",willMessage:"object",keepAliveInterval:"number",cleanSession:"boolean",useSSL:"boolean",invocationContext:"object",onSuccess:"function",onFailure:"function",hosts:"object",ports:"object",reconnect:"boolean",mqttVersion:"number",mqttVersionExplicit:"boolean",uris:"object"}),void 0===e.keepAliveInterval&&(e.keepAliveInterval=60),e.mqttVersion>4||e.mqttVersion<3)throw new Error(c(s.INVALID_ARGUMENT,[e.mqttVersion,"connectOptions.mqttVersion"]));if(void 0===e.mqttVersion?(e.mqttVersionExplicit=!1,e.mqttVersion=4):e.mqttVersionExplicit=!0,void 0!==e.password&&void 0===e.userName)throw new Error(c(s.INVALID_ARGUMENT,[e.password,"connectOptions.password"]));if(e.willMessage){if(!(e.willMessage instanceof E))throw new Error(c(s.INVALID_TYPE,[e.willMessage,"connectOptions.willMessage"]));if(e.willMessage.stringPayload=null,"undefined"===typeof e.willMessage.destinationName)throw new Error(c(s.INVALID_TYPE,[a(e.willMessage.destinationName),"connectOptions.willMessage.destinationName"]))}if("undefined"===typeof e.cleanSession&&(e.cleanSession=!0),e.hosts){if(!(e.hosts instanceof Array))throw new Error(c(s.INVALID_ARGUMENT,[e.hosts,"connectOptions.hosts"]));if(e.hosts.length<1)throw new Error(c(s.INVALID_ARGUMENT,[e.hosts,"connectOptions.hosts"]));for(var t=!1,r=0;r<e.hosts.length;r++){if("string"!==typeof e.hosts[r])throw new Error(c(s.INVALID_TYPE,[a(e.hosts[r]),"connectOptions.hosts["+r+"]"]));if(/^(wss?):\/\/((\[(.+)\])|([^\/]+?))(:(\d+))?(\/.*)$/.test(e.hosts[r])){if(0===r)t=!0;else if(!t)throw new Error(c(s.INVALID_ARGUMENT,[e.hosts[r],"connectOptions.hosts["+r+"]"]))}else if(t)throw new Error(c(s.INVALID_ARGUMENT,[e.hosts[r],"connectOptions.hosts["+r+"]"]))}if(t)e.uris=e.hosts;else{if(!e.ports)throw new Error(c(s.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));if(!(e.ports instanceof Array))throw new Error(c(s.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));if(e.hosts.length!==e.ports.length)throw new Error(c(s.INVALID_ARGUMENT,[e.ports,"connectOptions.ports"]));for(e.uris=[],r=0;r<e.hosts.length;r++){if("number"!==typeof e.ports[r]||e.ports[r]<0)throw new Error(c(s.INVALID_TYPE,[a(e.ports[r]),"connectOptions.ports["+r+"]"]));var u=e.hosts[r],d=e.ports[r],l=-1!==u.indexOf(":");i="ws://"+(l?"["+u+"]":u)+":"+d+n,e.uris.push(i)}}}p.connect(e)},this.subscribe=function(e,t){if("string"!==typeof e&&e.constructor!==Array)throw new Error("Invalid argument:"+e);if(o(t=t||{},{qos:"number",invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),t.timeout&&!t.onFailure)throw new Error("subscribeOptions.timeout specified with no onFailure callback.");if("undefined"!==typeof t.qos&&0!==t.qos&&1!==t.qos&&2!==t.qos)throw new Error(c(s.INVALID_ARGUMENT,[t.qos,"subscribeOptions.qos"]));p.subscribe(e,t)},this.unsubscribe=function(e,t){if("string"!==typeof e&&e.constructor!==Array)throw new Error("Invalid argument:"+e);if(o(t=t||{},{invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"}),t.timeout&&!t.onFailure)throw new Error("unsubscribeOptions.timeout specified with no onFailure callback.");p.unsubscribe(e,t)},this.send=function(e,t,n,r){var o;if(0===arguments.length)throw new Error("Invalid argument.length");if(1==arguments.length){if(!(e instanceof E)&&"string"!==typeof e)throw new Error("Invalid argument:"+("undefined"===typeof e?"undefined":a(e)));if("undefined"===typeof(o=e).destinationName)throw new Error(c(s.INVALID_ARGUMENT,[o.destinationName,"Message.destinationName"]));p.send(o)}else(o=new E(t)).destinationName=e,arguments.length>=3&&(o.qos=n),arguments.length>=4&&(o.retained=r),p.send(o)},this.publish=function(e,t,n,r){var o;if(0===arguments.length)throw new Error("Invalid argument.length");if(1==arguments.length){if(!(e instanceof E)&&"string"!==typeof e)throw new Error("Invalid argument:"+("undefined"===typeof e?"undefined":a(e)));if("undefined"===typeof(o=e).destinationName)throw new Error(c(s.INVALID_ARGUMENT,[o.destinationName,"Message.destinationName"]));p.send(o)}else(o=new E(t)).destinationName=e,arguments.length>=3&&(o.qos=n),arguments.length>=4&&(o.retained=r),p.send(o)},this.disconnect=function(){p.disconnect()},this.getTraceLog=function(){return p.getTraceLog()},this.startTrace=function(){p.startTrace()},this.stopTrace=function(){p.stopTrace()},this.isConnected=function(){return p.connected}},Message:E}}("undefined"!==typeof e?e:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},"object"===a(t)&&"object"===a(r)?r.exports=s():void 0===(i="function"===typeof(o=s)?o.call(t,n,t,r):o)||(r.exports=i)}).call(this,n("./node_modules/webpack/buildin/global.js"),n("./node_modules/webpack/buildin/module.js")(e))},"./node_modules/srcdoc-polyfill/srcdoc-polyfill.js":function(e,t,n){var r,o,i;"function"===typeof Symbol&&Symbol.iterator;o=this,i=window.srcDoc,void 0===(r=function(e){!function(e,t){var n,r,o,i=!!("srcdoc"in document.createElement("iframe")),s="Polyfill may not function in the presence of the `sandbox` attribute. Consider using the `force` option.",a=/\ballow-same-origin\b/,u=function(e,t){var n=e.getAttribute("sandbox");"string"!==typeof n||a.test(n)||(t&&t.force?e.removeAttribute("sandbox"):t&&!1===t.force||(o(s),e.setAttribute("data-srcdoc-polyfill",s)))},c={compliant:function(e,t,n){t&&(u(e,n),e.setAttribute("srcdoc",t))},legacy:function(e,t,n){var r;e&&e.getAttribute&&(t?e.setAttribute("srcdoc",t):t=e.getAttribute("srcdoc"),t&&(u(e,n),r="javascript: window.frameElement.getAttribute('srcdoc');",e.contentWindow&&(e.contentWindow.location=r),e.setAttribute("src",r)))}},d=e;if(o=window.console&&window.console.error?function(e){window.console.error("[srcdoc-polyfill] "+e)}:function(){},d.set=c.compliant,d.noConflict=function(){return window.srcDoc=t,d},!i)for(d.set=c.legacy,r=document.getElementsByTagName("iframe"),n=r.length;n--;)d.set(r[n])}(e,i),o.srcDoc=e}.apply(t,[t]))||(e.exports=r)},"./node_modules/uuid/lib/bytesToUuid.js":function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,o=n;return[o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]]].join("")}},"./node_modules/uuid/lib/rng-browser.js":function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var o=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0===(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},"./node_modules/uuid/v4.js":function(e,t,n){var r=n("./node_modules/uuid/lib/rng-browser.js"),o=n("./node_modules/uuid/lib/bytesToUuid.js");e.exports=function(e,t,n){var i=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||r)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[i+a]=s[a];return t||o(s)}},"./node_modules/webpack/buildin/global.js":function(e,t){var n,r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"===("undefined"===typeof window?"undefined":r(window))&&(n=window)}e.exports=n},"./node_modules/webpack/buildin/module.js":function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},"./package.json":function(e){e.exports={name:"clsp-videojs-plugin",version:"0.14.0-19",description:"Uses clsp (iot) as a video distribution system, video is is received via the clsp client then rendered using the media source extensions. ",main:"dist/clsp-videojs-plugin.js","generator-videojs-plugin":{version:"5.0.0"},scripts:{build:"./scripts/build.sh",serve:"./scripts/serve.sh",lint:"eslint ./ --cache --quiet --ext .js","lint-fix":"eslint ./ --cache --quiet --ext .js --fix",version:"./scripts/version.sh",postversion:"git push && git push --tags"},keywords:["videojs","videojs-plugin"],author:"https://www.skylinenet.net",license:"Apache-2.0",dependencies:{debug:"^3.1.0",lodash:"^4.17.10","paho-client":"git+https://github.com/eclipse/paho.mqtt.javascript.git#v1.1.0"},devDependencies:{"babel-core":"^6.26.3","babel-eslint":"^8.2.5","babel-loader":"^7.1.5","babel-plugin-transform-class-properties":"^6.24.1","babel-plugin-transform-object-rest-spread":"^6.26.0","babel-polyfill":"^6.26.0","babel-preset-env":"^1.7.0","css-loader":"^0.28.11",eslint:"^5.0.1","extract-text-webpack-plugin":"^4.0.0-beta.0",jquery:"^3.3.1",moment:"^2.22.2","node-sass":"^4.9.1","pre-commit":"^1.2.2","sass-loader":"^7.0.3","srcdoc-polyfill":"^1.0.0",standard:"^11.0.1","style-loader":"^0.21.0","uglifyjs-webpack-plugin":"^1.2.7","url-loader":"^1.0.1","video.js":"^7.2.2","videojs-errors":"^4.1.3",webpack:"^4.15.1","webpack-serve":"^2.0.2","write-file-webpack-plugin":"^4.3.2"}}},"./src/js/clsp-videojs-plugin.js":function(e,t,n){"use strict";n.r(t);n("./src/styles/clsp-videojs-plugin.scss");var r=n("./src/js/plugin/ClspPlugin.js"),o=Object(r.default)();o.register(),t.default=o},"./src/js/iov/Conduit.js":function(e,t,n){"use strict";n.r(t);var r=n("./src/js/utils/ListenerBaseClass.js"),o=n("./dist/Router.js"),i=n.n(o),s=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(r):void 0},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var u=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n));return r.iov=e,r.clientId=e.id,r.handlers={},r.iframe=r.generateIframe(),r.attachIframe(),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r["default"]),a(t,null,[{key:"factory",value:function(e){return new t(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}}]),a(t,[{key:"onFirstMetricListenerRegistered",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onFirstMetricListenerRegistered",this).call(this),this.metric("iovConduit.instances",1),this.metric("iovConduit.clientId",this.clientId)}},{key:"generateIframe",value:function(){this.debug("generating iframe...");var e=document.createElement("iframe");return e.setAttribute("style","display:none;"),e.setAttribute("id",this.clientId),e.width=0,e.height=0,e.srcdoc='\n      <html>\n        <head>\n          <script type="text/javascript">\n            window.MqttClientId = "'+this.clientId+'";\n            window.iframeCode = '+i.a.toString()+'();\n          <\/script>\n        </head>\n        <body\n          onload="window.iframeCode.clspRouter();"\n          onunload="window.iframeCode.onunload();"\n        >\n          <div id="message"></div>\n        </body>\n      </html>\n    ',e}},{key:"attachIframe",value:function(){var e=this;if(this.debug("attaching iframe..."),this.iov.config.videoElementParent)this.iov.config.videoElementParent.appendChild(this.iframe);else{if(this.iov.videoElement.parentNode)return this.iov.videoElement.parentNode.appendChild(this.iframe),void(this.iov.config.videoElementParent=this.iov.videoElement.parentNode);var t=setInterval(function(){if(null!==e.iov.videoElement.parentNode){try{e.iov.videoElement.parentNode.appendChild(e.iframe),e.iov.config.videoElementParent=e.iov.videoElement.parentNode}catch(e){console.error(e)}clearInterval(t)}},1e3)}}},{key:"command",value:function(e){var t=this;if(this.debug("posting message from iframe..."),this.iframe.contentWindow)this.iframe.contentWindow.postMessage(e,"*");else var n=setInterval(function(){if(null!==t.iframe.contentWindow){try{t.iframe.contentWindow.postMessage(e,"*")}catch(e){console.error(e)}clearInterval(n)}},1e3)}},{key:"getTopicHandler",value:function(e){this.debug("getting topic handler for "+e+"...");var t=this.handlers[e];if(!t)throw new Error("No handler for "+e);return t}},{key:"subscribe",value:function(e,t){this.debug("subscribing to "+e+"..."),this.handlers[e]=t,this.command({method:"subscribe",topic:e})}},{key:"unsubscribe",value:function(e){this.debug("unsubscribing from "+e+"..."),e in this.handlers&&delete this.handlers[e],this.command({method:"unsubscribe",topic:e})}},{key:"publish",value:function(e,t){this.debug("publishing to "+e+"..."),this.command({method:"publish",topic:e,data:t})}},{key:"start",value:function(e){var t=this;this.debug("starting...");var n=this.clientId+"'/response/'"+parseInt(1e6*Math.random()),r=this.clientId+"/init-segment/"+parseInt(1e6*Math.random());this.subscribe(n,function(o){t.debug("received response for "+n+"...");var i,s,a=JSON.parse(o.payloadString);t.metric("iovConduit.guid",a.guid),t.metric("iovConduit.mimeCodec",a.mimeCodec),t.debug("onIovPlayTransaction"),t.guid=a.guid,t.subscribe(r,(i=regeneratorRuntime.mark(function n(o){var i=o.payloadBytes;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:t.debug("received response for "+r+"..."),t.unsubscribe(r),e(a.mimeCodec,i);case 3:case"end":return n.stop()}},n,t)}),s=function(){var e=i.apply(this,arguments);return new Promise(function(t,n){return function r(o,i){try{var s=e[o](i),a=s.value}catch(e){return void n(e)}if(!s.done)return Promise.resolve(a).then(function(e){r("next",e)},function(e){r("throw",e)});t(a)}("next")})},function(e){return s.apply(this,arguments)})),t.publish("iov/video/"+t.guid+"/play",{initSegmentTopic:r,clientId:t.clientId}),t.unsubscribe(n)}),this.publish("iov/video/"+window.btoa(this.iov.config.streamName)+"/request",{clientId:this.clientId,resp_topic:n})}},{key:"stream",value:function(e){if(this.debug("streaming..."),!this.guid)throw new Error("The Conduit must be started before it can stream.");this.subscribe("iov/video/"+this.guid+"/live",function(t){e(t.payloadBytes)})}},{key:"onResync",value:function(e){var t=this;this.debug("registering listener for resync event..."),this.subscribe("iov/video/"+this.guid+"/resync",function(){t.debug("resyncing..."),e()})}},{key:"stop",value:function(){this.debug("stopping..."),this.guid&&(this.unsubscribe("iov/video/"+this.guid+"/live"),this.unsubscribe("iov/video/"+this.guid+"/resync"),this.publish("iov/video/"+this.guid+"/stop",{clientId:this.clientId}))}},{key:"clearHandlers",value:function(){var e=Object.keys(this.handlers),t=e.length;this.debug("clearing "+t+" handlers...");for(var n=0;n<t;n++){var r=e[n];this.unsubscribe(r)}this.handlers={}}},{key:"destroy",value:function(){var e=this;if(!this.destroyed){this.destroyed=!0,this.debug("destroying..."),this.clearHandlers(),this.iov=null,this.clientId=null,this.handlers=null;try{this.command({method:"destroy",topic:"iov/video/grand_cam_037/resync"})}catch(e){console.error(e),console.warn('Failed when issuing "destroy" command to iframe.')}setTimeout(function(){e.iframe.parentNode.removeChild(e.iframe),e.iframe.srcdoc="",e.iframe=null,s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",e).call(e)},this.options.iframeTimeout)}}}]),t}();u.DEFAULT_OPTIONS={iframeTimeout:9e3},u.METRIC_TYPES=["iovConduit.instances","iovConduit.clientId","iovConduit.guid","iovConduit.mimeCodec"],t.default=u},"./src/js/iov/IOV.js":function(e,t,n){"use strict";n.r(t);n("./node_modules/srcdoc-polyfill/srcdoc-polyfill.js");var r=n("./src/js/utils/ListenerBaseClass.js"),o=n("./src/js/iov/Player.js"),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(r):void 0},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var u=function(e){function t(e,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,o));return i.onMseError=function(){i.player.restart()},i.onChangeSource=function(e,t){return i.destroyed?(console.warn("tried to change source on a dead iov",i.id),void i.videoJsPlayer.off("changesrc",i.onChangeSource)):i.changeSource(t)},i.onReadyCalledMultipleTimes=!1,i.videoId=n.id()+"_html5_api",i.videoJsElement=document.getElementById(i.videoId),i.videoJsPlayer=n,i.videoElement=i.videoJsPlayer.el(),i.firstFrameShown=!1,i.config={clientId:i.id,wsbroker:r.wsbroker,wsport:r.wsport,useSSL:r.useSSL,streamName:r.streamName,videoElementParent:r.videoElementParent||null},i.mqttConduitCollection=e,i}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r["default"]),a(t,null,[{key:"generateConfigFromUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("No source was given to be parsed!");var n=document.createElement("a"),r=void 0,o=void 0;if("clsps"===e.substring(0,5).toLowerCase())r=!0,n.href=e.replace("clsps","https"),o=t.defaultSslPort||443;else{if("clsp"!==e.substring(0,4).toLowerCase())throw new Error("The given source is not a clsp url, and therefore cannot be parsed.");r=!1,n.href=e.replace("clsp","http"),o=t.defaultNonSslPort||9001}var i=n.pathname.split("/"),s=i[i.length-1],a=n.hostname,u=n.port;return 0===u.length&&(u=o),"@"===a&&(a=window.location.hostname),{wsbroker:a,wsport:parseInt(u),streamName:s,useSSL:r}}},{key:"factory",value:function(e,n){return new t(e,n,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},arguments.length>3&&void 0!==arguments[3]?arguments[3]:{})}},{key:"fromUrl",value:function(e,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return t.factory(n,r,i({},o,t.generateConfigFromUrl(e,s)),s)}}]),a(t,[{key:"onFirstMetricListenerRegistered",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onFirstMetricListenerRegistered",this).call(this),this.metric("iov.instances",1),this.metric("iov.clientId",this.id)}},{key:"initialize",value:function(){var e=this;if(this.debug("initializing..."),this.conduit=this.mqttConduitCollection.addFromIov(this,{enableMetrics:this.options.enableMetrics}),this.conduit.on("metric",function(t){var n=t.type,r=t.value;e.metric(n,r,!0)}),this.player=o.default.factory(this,{enableMetrics:this.options.enableMetrics}),this.player.on("metric",function(t){var n=t.type,r=t.value;e.metric(n,r,!0)}),this.player.on("maxMediaSourceRetriesExceeded",function(){e.trigger("criticalError")}),this.player.on("videoReceived",function(){e.videoJsPlayer.trigger("timeupdate")}),this.player.on("videoInfoReceived",function(){e.videoJsPlayer.trigger("timeupdate")}),this.videoJsPlayer.on("changesrc",this.onChangeSource),this.videoElement.addEventListener("mse-error-event",this.onMseError,!1),this.shouldPlayNext=!0,this.options.changeSourceWait)var t=setTimeout(function(){e.destroyed||(e.shouldPlayNext=!1,t&&clearTimeout(t),e.firstFrameShown||(e.videoJsPlayer.trigger("readyForNextSource",!0),e.player.trigger("readyForNextSource",!0)))},this.options.changeSourceMaxWait);return this.player.on("firstFrameShown",function(){e.shouldPlayNext&&(e.firstFrameShown=!0,e.videoJsPlayer.loadingSpinner.hide(),setTimeout(function(){document.hidden||(e.videoJsPlayer.trigger("readyForNextSource"),e.player.trigger("readyForNextSource"))},e.options.changeSourceReadyDelay))}),this.options.changeSourceImmediately&&(this.options.changeSourceImmediately=!1,this.videoJsPlayer.trigger("changeSourceImmediately")),this}},{key:"clone",value:function(e,n){this.debug("cloning...");var r=i({},e,{videoElementParent:this.config.videoElementParent}),o=t.factory(this.mqttConduitCollection,this.videoJsPlayer,r,n);return o}},{key:"changeSource",value:function(e){var n=this,r=e.src;e.type;if(this.debug('changeSource on player "'+this.id+'""'),!r)throw new Error("Unable to change source because there is no src!");var o=this.clone(t.generateConfigFromUrl(r,this.options),this.options);o.initialize(),o.player.videoElement.style.display="none",o.onVisibilityChange=function(){if(document.hidden){document.removeEventListener("visibilitychange",o.onVisibilityChange),n.onVisibilityChange=null;try{n.destroy(),o.destroy()}catch(e){console.error(e)}}},document.addEventListener("visibilitychange",o.onVisibilityChange),o.player.on("readyForNextSource",function(e){o.destroyed||e&&(o.videoJsPlayer.error({code:0,type:"MEDIA_SOURCE_LOAD_FAILED",headline:"MEDIA_SOURCE_LOAD_FAILED",message:"Unable to retrieve source: "+r}),n.player.destroy(),o.destroy())}),o.player.on("firstFrameShown",function(){o.shouldPlayNext&&(setTimeout(function(){o.player.videoElement.style.display="initial"},o.options.changeSourceReadyDelay/2),setTimeout(function(){o.destroyed||(n.player&&n.player.videoElement&&n.player.videoElement.classList.add("hide"),o.videoJsPlayer.tech(!0).mqtt.updateIOV(o),o.videoJsPlayer.error(null),o.videoJsPlayer.errorDisplay.close())},o.options.changeSourceReadyDelay))})}},{key:"onReady",value:function(e){if(this.debug("onReady"),null!==this.videoElement.parentNode&&(this.config.videoElementParentId=this.videoElement.parentNode.id),this.onReadyCalledMultipleTimes)return console.error("tried to use this player more than once..."),void this.trigger("onReadyCalledMultipleTimes");this.onReadyCalledMultipleTimes=!0,this.player.destroyed||this.player.play(this.videoElement.firstChild.id,this.config.streamName)}},{key:"onFail",value:function(e){this.debug("onFail"),this.debug("network error",e.data.reason),this.videoJsPlayer.trigger("network-error",e.data.reason)}},{key:"onData",value:function(e){this.silly("onData");var t=e.data,n=t.destinationName;try{this.conduit.getTopicHandler(n)(t)}catch(e){this.trigger("handlerError",e)}}},{key:"onMessage",value:function(e){if(!this.destroyed){var t=e.data.event;switch(this.silly("onMessage",t),t){case"ready":this.onReady(e);break;case"fail":this.onFail(e);break;case"data":this.onData(e);break;default:console.error("No match for event: "+t)}}}},{key:"destroy",value:function(){this.destroyed||(this.destroyed=!0,this.debug("destroying..."),this.onVisibilityChange&&!document.hidden&&(document.removeEventListener("visibilitychange",this.onVisibilityChange),this.onVisibilityChange=null),this.player.destroy(),this.player=null,this.mqttConduitCollection.remove(this.id),this.conduit.destroy(),this.conduit=null,this.videoElement.removeEventListener("mse-error-event",this.onMseError),this.videoJsPlayer.off("changesrc",this.onChangeSource),this.videoJsPlayer=null,s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this))}}]),t}();u.DEFAULT_OPTIONS={changeSourceImmediately:!1,changeSourceWait:!0,changeSourceMaxWait:15e3,changeSourceReadyDelay:1500,statsInterval:3e4,defaultNonSslPort:9001,defaultSslPort:443},u.EVENT_NAMES=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(r.default.EVENT_NAMES),["onReadyCalledMultipleTimes","handlerError","criticalError"]),u.METRIC_TYPES=["iov.instances","iov.clientId"],t.default=u},"./src/js/iov/Player.js":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/lodash/debounce.js"),o=n.n(r),i=n("./src/js/utils/ListenerBaseClass.js"),s=n("./src/js/mse/MediaSourceWrapper.js"),a=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(r):void 0},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var c=function(e){function t(e,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n));return i.onMaxMediaSourceRetriesExceeded=function(){i.retryCount=0},i.reinitializeMseWrapper=o()(function(){if(!i.destroyed){if(i.retryCount>=i.options.maxMediaSourceRetries)return i.trigger("maxMediaSourceRetriesExceeded"),void window.dispatchEvent(new window.Event("maxMediaSourceRetriesExceeded"));var e;if(i.retryCount++,i.resetRetryCount&&clearTimeout(i.resetRetryCount),i.resetRetryCount=setTimeout(function(){i.retryCount=0},i.options.maxMediaSourceRetryInterval),i.mediaSourceWrapper&&i.mediaSourceWrapper.destroy(),i.mimeCodec)i.mediaSourceWrapperGenericErrorRestartCount=0,i.mediaSourceWrapper=s.default.factory(i.videoElement,{enableMetrics:i.options.enableMetrics}),i.mediaSourceWrapper.moov=i.moov,i.mediaSourceWrapper.registerMimeCodec(i.mimeCodec),i.mediaSourceWrapper.on("metric",function(e){var t=e.type,n=e.value;i.metric(t,n,!0)}),i.mediaSourceWrapper.on("sourceOpen",(e=regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i.debug("on mediaSource sourceopen"),e.next=3,i.mediaSourceWrapper.initializeSourceBuffer({enableMetrics:i.options.enableMetrics});case 3:i.mediaSourceWrapper.sourceBuffer.on("metric",function(e){var t=e.type,n=e.value;i.metric(t,n,!0)}),i.mediaSourceWrapper.sourceBuffer.on("appendFinish",function(e){if(i.silly("On Append Finish..."),i.firstFrameShown||(i.firstFrameShown=!0,i.trigger("firstFrameShown")),i.drift=e.bufferTimeEnd-i.videoElement.currentTime,i.metric("iovPlayer.mediaSource.sourceBuffer.bufferTimeEnd",e.bufferTimeEnd),i.metric("iovPlayer.video.currentTime",i.videoElement.currentTime),i.metric("iovPlayer.video.drift",i.drift),i.drift>i.segmentIntervalAverage/1e3+i.options.driftCorrectionConstant&&(i.metric("iovPlayer.video.driftCorrection",1),i.videoElement.currentTime=e.bufferTimeEnd),!0===i.videoElement.paused){i.debug("Video is paused!");try{var t=i.videoElement.play();"undefined"!==typeof t&&t.catch(function(e){i._onError("videojs.play.promise","Error while trying to play videojs player",e)})}catch(e){i._onError("videojs.play.notPromise","Error while trying to play videojs player",e)}}}),i.mediaSourceWrapper.sourceBuffer.on("appendError",function(e){i._onError("sourceBuffer.append","Error while appending to sourceBuffer",e),i.restart()}),i.mediaSourceWrapper.sourceBuffer.on("removeFinish",function(e){i.debug("onRemoveFinish")}),i.mediaSourceWrapper.sourceBuffer.on("removeError",function(e){"DOMException"!==e.constructor.name&&i._onError("sourceBuffer.remove","Error while removing segments from sourceBuffer",e)}),i.mediaSourceWrapper.sourceBuffer.on("streamFrozen",function(){i.debug("stream appears to be frozen - reinitializing..."),i.restart()}),i.mediaSourceWrapper.sourceBuffer.on("error",function(e){i.mediaSourceWrapperGenericErrorRestartCount++,i.mediaSourceWrapperGenericErrorRestartCount<=i.options.maxMediaSourceWrapperGenericErrorRestartCount&&(i.metric("iovPlayer.mediaSource.sourceBuffer.genericErrorRestartCount",i.mediaSourceWrapperGenericErrorRestartCount),i.restart()),i._onError("mediaSource.sourceBuffer.generic","mediaSource sourceBuffer error",e)}),i.trigger("videoInfoReceived");case 11:case"end":return e.stop()}},e,r)}),function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(o,i){try{var s=t[o](i),a=s.value}catch(e){return void n(e)}if(!s.done)return Promise.resolve(a).then(function(e){r("next",e)},function(e){r("throw",e)});e(a)}("next")})})),i.mediaSourceWrapper.on("sourceEnded",function(){i.debug("on mediaSource sourceended"),i.stop()}),i.mediaSourceWrapper.on("sourceOpenFailure",function(){i.debug("media source failed to become ready"),i.restart()}),i.mediaSourceWrapper.on("error",function(e){i._onError("mediaSource.generic","mediaSource error",e)}),i.mediaSourceWrapper.initializeMediaSource().then(function(){if(!i.mediaSourceWrapper.mediaSource||!i.videoElement)throw new Error("The video element or mediaSource is not ready!");i.mediaSourceWrapper.reinitializeVideoElementSrc()});else console.warn("mime codec not available yet...")}},i.options.mediaSourceRetryInterval,{leading:!0}),i.restart=o()(function(){i.destroyed||(i.debug("restart"),i.stop(),i.play())},i.options.restartDelay,{leading:!0}),i.iov=e,i.videoId="clsp-video-"+i.iov.id,i.initializeVideoElement(),i.firstFrameShown=!1,i.latestSegmentReceived=null,i.segmentIntervalAverage=null,i.segmentInterval=null,i.segmentIntervals=[],i.moofWaitReset=null,i.retryCount=0,i.resetRetryCount=null,i.options.maxMoofWait&&(i.moofWaitReset=o()(function(){i.destroyed||(i.metric("iovPlayer.moofWaitExceeded",1),i.restart())},i.options.maxMoofWait)),i.mediaSourceWrapper=null,i.moov=null,i.mimeCodec=null,window.addEventListener("maxMediaSourceRetriesExceeded",i.onMaxMediaSourceRetriesExceeded),i}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i["default"]),u(t,null,[{key:"factory",value:function(e){return new t(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}}]),u(t,[{key:"onFirstMetricListenerRegistered",value:function(){a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onFirstMetricListenerRegistered",this).call(this),this.metric("iovPlayer.instances",1),this.metric("iovPlayer.clientId",this.iov.id)}},{key:"_onError",value:function(e,t,n){console.error(e,t),console.error(n)}},{key:"initializeVideoElement",value:function(){var e=this,t=this.iov.videoElement.firstChild.id,n=document.getElementById(t);if(!n)throw new Error('Unable to find an element in the DOM with id "'+t+'".');var r=n.parentNode;this.videoElement=this.iov.videoJsElement.cloneNode(),this.videoElement.setAttribute("id",this.videoId),this.videoElement.classList.add("clsp-video"),this.on("firstFrameShown",function(){if(r)try{var o=r.getElementsByTagName("video");r.insertBefore(e.videoElement,n);for(var i=0;i<o.length;i++){var s=o[i],a=s.getAttribute("id");a!==e.videoId&&a!==e.iov.videoId&&a!==t&&(r.removeChild(s),s.remove())}o=null}catch(e){console.error(e)}})}},{key:"play",value:function(e){var t=this;this.debug("play"),this.destroyed||this.iov.conduit.start(function(e,n){t.destroyed||(t.mimeCodec=e,t.moov=n,t.iov.conduit.stream(function(e){if(!t.destroyed&&(t.trigger("videoReceived"),t.calculateSegmentIntervalMetrics(),!document.hidden)){t.options.maxMoofWait&&t.moofWaitReset();try{if(!t.mediaSourceWrapper||!t.mediaSourceWrapper.sourceBuffer)return void t.restart();t.mediaSourceWrapper.sourceBuffer.append(e)}catch(e){console.error(e)}}}),t.iov.conduit.onResync(function(){t.destroyed||(t.debug("sync event received"),t.reinitializeMseWrapper())}),t.reinitializeMseWrapper())})}},{key:"stop",value:function(){this.debug("stop"),this.moov=null,this.mimeCodec=null;try{this.iov.conduit.stop()}catch(e){console.error(e)}}},{key:"calculateSegmentIntervalMetrics",value:function(){var e=this.latestSegmentReceived;if(this.latestSegmentReceived=Date.now(),e&&(this.segmentInterval=this.latestSegmentReceived-e,this.segmentInterval)){this.segmentIntervals.length>=this.options.segmentIntervalSampleSize&&this.segmentIntervals.shift(),this.segmentIntervals.push(this.segmentInterval);for(var t=0,n=0;n<this.segmentIntervals.length;n++)t+=this.segmentIntervals[n];this.segmentIntervalAverage=t/this.segmentIntervals.length,this.metric("iovPlayer.video.segmentInterval",this.segmentInterval),this.metric("iovPlayer.video.segmentIntervalAverage",this.segmentIntervalAverage)}}},{key:"destroy",value:function(){this.destroyed||(this.destroyed=!0,this.debug("destroying"),this.stop(),window.removeEventListener("maxMediaSourceRetriesExceeded",this.onMaxMediaSourceRetriesExceeded),this.iov=null,this.firstFrameShown=null,this.resetRetryCount&&clearTimeout(this.resetRetryCount),this.resetRetryCount=null,this.retryCount=null,this.latestSegmentReceived=null,this.segmentIntervalAverage=null,this.segmentInterval=null,this.segmentIntervals=null,this.mediaSourceWrapper&&this.mediaSourceWrapper.destroy(),this.mediaSourceWrapper=null,this.mediaSourceWrapperGenericErrorRestartCount=null,this.videoElement.src="",this.videoElement=null,this.moofWaitReset&&(this.moofWaitReset.cancel(),this.moofWaitReset=null),a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this))}}]),t}();c.DEFAULT_OPTIONS={maxMoofWait:3e4,segmentIntervalSampleSize:5,driftCorrectionConstant:2,maxMediaSourceWrapperGenericErrorRestartCount:50,maxMediaSourceRetries:15,maxMediaSourceRetryInterval:15e3,mediaSourceRetryInterval:500,restartDelay:500},c.EVENT_NAMES=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(i.default.EVENT_NAMES),["firstFrameShown","videoReceived","videoInfoReceived","maxMediaSourceRetriesExceeded","noMimeCodec","readyForNextSource"]),c.METRIC_TYPES=["iovPlayer.instances","iovPlayer.clientId","iovPlayer.moofWaitExceeded","iovPlayer.video.currentTime","iovPlayer.video.drift","iovPlayer.video.driftCorrection","iovPlayer.video.segmentInterval","iovPlayer.video.segmentIntervalAverage","iovPlayer.mediaSource.sourceBuffer.bufferTimeEnd","iovPlayer.mediaSource.sourceBuffer.genericErrorRestartCount"],t.default=c},"./src/js/mse/MediaSourceWrapper.js":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/lodash/defaults.js"),o=n.n(r),i=n("./node_modules/lodash/noop.js"),s=n.n(i),a=n("./src/js/utils/ListenerBaseClass.js"),u=n("./src/js/mse/SourceBufferWrapper.js"),c=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(r):void 0},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function l(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(o,i){try{var s=t[o](i),a=s.value}catch(e){return void n(e)}if(!s.done)return Promise.resolve(a).then(function(e){r("next",e)},function(e){r("throw",e)});e(a)}("next")})}}var f=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),!e)throw new Error("videoElement is required to construct an MediaSourceWrapper.");var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n));return r.videoElement=e,r.mediaSource=null,r.sourceBuffer=null,r.objectURL=null,r.readyRetries=0,r.eventListeners={sourceopen:function(){if(r.isReady())r._onSourceOpen();else var e=setInterval(function(){return r.destroyed?(console.warn("Media source was destroyed before it was ready."),void clearInterval(e)):r.readyRetries>=r.options.readyRetryMax?(console.warn("Media source failed to become ready."),clearInterval(e),void r.trigger("sourceOpenFailure")):void(r.isReady()?(r._onSourceOpen(),clearInterval(e)):r.readyRetries++)},r.options.readyRetryInterval)},sourceended:function(){r.trigger("sourceEnded")},error:function(e){r.trigger("error",e)}},r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a["default"]),d(t,null,[{key:"isMimeCodecSupported",value:function(e){return window.MediaSource&&window.MediaSource.isTypeSupported(e)}},{key:"factory",value:function(e){return new t(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}}]),d(t,[{key:"onFirstMetricListenerRegistered",value:function(){c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onFirstMetricListenerRegistered",this).call(this),this.metric("mediaSource.instances",1)}},{key:"_onSourceOpen",value:function(){this.mediaSource.duration=this.options.duration,this.trigger("sourceOpen"),this.moov&&this.sourceBuffer.appendMoov(this.moov)}},{key:"initializeMediaSource",value:function(){var e=l(regeneratorRuntime.mark(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.debug("Initializing mediaSource..."),t=o()({},t,{onSourceOpen:s.a,onSourceEnded:s.a,onError:s.a}),this.metric("mediaSource.created",1),e.next=5,this.destroyMediaSource();case 5:this.mediaSource=new window.MediaSource,this.mediaSource.addEventListener("sourceopen",this.eventListeners.sourceopen),this.mediaSource.addEventListener("sourceended",this.eventListeners.sourceended),this.mediaSource.addEventListener("error",this.eventListeners.error);case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"registerMimeCodec",value:function(e){if(!t.isMimeCodecSupported(e))throw new Error('Mime codec of "'+e+'" is not supported.');this.mimeCodec=e}},{key:"getVideoElementSrc",value:function(){this.debug("getVideoElementSrc..."),this.mediaSource&&(this.objectURL||(this.metric("mediaSource.objectURL.created",1),this.objectURL=window.URL.createObjectURL(this.mediaSource)),this.videoElement.src=this.objectURL)}},{key:"destroyVideoElementSrc",value:function(){if(this.debug("destroyVideoElementSrc..."),this.mediaSource&&this.objectURL){this.metric("mediaSource.objectURL.revoked",1),this.objectURL=null;try{this.sourceBuffer&&this.sourceBuffer.abort()}catch(e){}return window.URL.revokeObjectURL(this.videoElement.src)}}},{key:"reinitializeVideoElementSrc",value:function(){return this.metric("mediaSource.reinitialized",1),this.destroyVideoElementSrc(),this.getVideoElementSrc()}},{key:"isReady",value:function(){return this.mediaSource&&"open"===this.mediaSource.readyState}},{key:"initializeSourceBuffer",value:function(){var e=l(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mimeCodec){e.next=2;break}throw new Error("You must register a valid mime codec first.");case 2:if(this.isReady()){e.next=4;break}throw new Error("Cannot create the sourceBuffer if the mediaSource is not ready.");case 4:if(!this.sourceBuffer){e.next=7;break}return e.next=7,this.sourceBuffer.destroy();case 7:this.sourceBuffer=u.default.factory(this,t);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"destroyMediaSource",value:function(){var e=l(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mediaSource&&!this.destroyed){e.next=2;break}return e.abrupt("return");case 2:if(this.debug("Destroying mediaSource..."),this.mediaSource.removeEventListener("sourceopen",this.eventListeners.sourceopen),this.mediaSource.removeEventListener("sourceended",this.eventListeners.sourceended),this.mediaSource.removeEventListener("error",this.eventListeners.error),this.isReady()&&this.sourceBuffer.isReady())try{this.mediaSource.endOfStream()}catch(e){this.debug(e),this.metric("mediaSource.endOfStream.error",1)}return this.sourceBuffer&&this.mediaSource.removeSourceBuffer(this.sourceBuffer.sourceBuffer),this.destroyVideoElementSrc(),e.next=11,this.sourceBuffer.destroy();case 11:this.metric("mediaSource.destroyed",1),this.sourceBuffer=null,this.mediaSource=null;case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){var e=this;if(!this.destroyed&&!this.destroying)return this.debug("destroySourceBuffer..."),this.destroying=!0,this.moov=null,this.destroyMediaSource().then(function(){e.destroyed=!0,e.videoElement=null,e.eventListeners=null,c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",e).call(e)})}}]),t}();f.DEFAULT_OPTIONS={duration:10,readyRetryInterval:500,readyRetryMax:100},f.EVENT_NAMES=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(a.default.EVENT_NAMES),["sourceOpen","sourceEnded","error","sourceOpenFailure"]),f.METRIC_TYPES=["mediaSource.instances","mediaSource.created","mediaSource.destroyed","mediaSource.reinitialized","mediaSource.objectURL.created","mediaSource.objectURL.revoked","mediaSource.endOfStream.error"],t.default=f},"./src/js/mse/SourceBufferWrapper.js":function(e,t,n){"use strict";n.r(t);var r=n("./src/js/utils/ListenerBaseClass.js"),o=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(r):void 0},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var s=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n));return r.options.bufferTruncateValue||(r.options.bufferTruncateValue=parseInt(r.options.bufferSizeLimit/r.options.bufferTruncateFactor)),r.mediaSource=e,r.sourceBuffer=r.mediaSource.mediaSource.addSourceBuffer(r.mediaSource.mimeCodec),r.sourceBuffer.mode="sequence",r.segmentQueue=[],r.sequenceNumber=0,r.timeBuffered=null,r.previousTimeEnd=null,r.eventListeners={onUpdateEnd:function(){r.onUpdateEnd()},onAppendStart:function(e){r.trigger("appendStart",e)},onAppendFinish:function(e){r.trigger("appendFinish",e)},onAppendError:function(e){r.trigger("appendError",e)},onRemoveFinish:function(e){r.trigger("removeFinish",e)},onRemoveError:function(e){r.trigger("removeError",e)},onStreamFrozen:function(){r.trigger("streamFrozen")},onError:function(e){r.trigger("error",e)}},r.sourceBuffer.addEventListener("updateend",r.eventListeners.onUpdateEnd),r.sourceBuffer.addEventListener("error",r.eventListeners.onError),r}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r["default"]),i(t,null,[{key:"factory",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("A mediaSource object is required to create a sourceBuffer.");return new t(e,n)}}]),i(t,[{key:"onFirstMetricListenerRegistered",value:function(){o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onFirstMetricListenerRegistered",this).call(this),this.metric("sourceBuffer.created",1)}},{key:"isReady",value:function(){return this.sourceBuffer&&!1===this.sourceBuffer.updating}},{key:"queueSegment",value:function(e){this.debug("Queueing segment.  The queue now has "+this.segmentQueue.length+" segments."),this.metric("sourceBuffer.queue.added",1),this.segmentQueue.push({timestamp:Date.now(),moof:e})}},{key:"abort",value:function(){this.debug("Aborting current sourceBuffer operation");try{this.metric("sourceBuffer.abort",1),this.sourceBuffer.abort()}catch(e){this.metric("sourceBuffer.abort.error",1),this.eventListeners.onAbortError&&this.eventListeners.onAbortError(e)}}},{key:"processNextInQueue",value:function(){return this.silly("processNextInQueue"),"hidden"===document.visibilityState?(this.debug("Tab not in focus - dropping frame..."),this.metric("sourceBuffer.frameDrop.hiddenTab",1),void this.metric("sourceBuffer.queue.cannotProcessNext",1)):this.mediaSource&&this.mediaSource.isReady()?this.isReady()?void(this.segmentQueue.length>0&&(this.metric("sourceBuffer.queue.shift",1),this.metric("sourceBuffer.queue.canProcessNext",1),this._append(this.segmentQueue.shift()))):(this.debug("The sourceBuffer is busy"),this.metric("sourceBuffer.queue.sourceBufferNotReady",1),void this.metric("sourceBuffer.queue.cannotProcessNext",1)):(this.debug("The mediaSource is not ready"),this.metric("sourceBuffer.queue.mediaSourceNotReady",1),void this.metric("sourceBuffer.queue.cannotProcessNext",1))}},{key:"formatMoof",value:function(e){return e[20]=(4278190080&this.sequenceNumber)>>24,e[21]=(16711680&this.sequenceNumber)>>16,e[22]=(65280&this.sequenceNumber)>>8,e[23]=255&this.sequenceNumber,e}},{key:"appendMoov",value:function(e){this.debug("appendMoov"),this.metric("sourceBuffer.lastMoovSize",e.length),this.eventListeners.onAppendStart&&(this.debug("appending moov..."),this.queueSegment(e),this.processNextInQueue())}},{key:"append",value:function(e){this.silly("Append"),this.metric("sourceBuffer.lastMoofSize",e.length),this.eventListeners.onAppendStart&&(this.eventListeners.onAppendStart(e),this.metric("sourceBuffer.queue.append",1),this.queueSegment(this.formatMoof(e)),this.sequenceNumber++,this.processNextInQueue())}},{key:"_append",value:function(e){var t=e.timestamp,n=e.moof;this.silly("Appending to the sourceBuffer...");try{var r=Date.now()-t;if(r>this.options.driftThreshold)return this.debug("Estimated drift of "+r+" is above the "+this.options.driftThreshold+" threshold.  Flushing queue..."),this.metric("queue.removed",this.segmentQueue.length+1),void(this.segmentQueue=[]);this.debug("Appending to the buffer with an estimated drift of "+r),this.metric("sourceBuffer.append",1),this.sourceBuffer.appendBuffer(n)}catch(e){this.metric("sourceBuffer.append.error",1),this.eventListeners.onAppendError(e,n)}}},{key:"getBufferTimes",value:function(){var e=this.timeBuffered,t=this.sourceBuffer.buffered.start(0),n=this.sourceBuffer.buffered.end(0);return{previousBufferSize:e,currentBufferSize:n-t,bufferTimeStart:t,bufferTimeEnd:n}}},{key:"trimBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.metric("sourceBuffer.lastKnownBufferSize",this.timeBuffered);try{e||(e=this.getBufferTimes()),(t||this.timeBuffered>this.options.bufferSizeLimit&&this.isReady())&&(this.debug("Removing old stuff from sourceBuffer..."),this.metric("sourceBuffer.trim",this.options.bufferTruncateValue),this.sourceBuffer.remove(e.bufferTimeStart,e.bufferTimeStart+this.options.bufferTruncateValue))}catch(e){this.metric("sourceBuffer.trim.error",1),this.eventListeners.onRemoveError(e)}}},{key:"onRemoveFinish",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getBufferTimes();this.debug("On remove finish..."),this.metric("sourceBuffer.updateEnd.removeEvent",1),this.eventListeners.onRemoveFinish(e)}},{key:"onAppendFinish",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getBufferTimes();if(this.silly("On append finish..."),this.metric("sourceBuffer.updateEnd.appendEvent",1),this.previousTimeEnd&&e.bufferTimeEnd<=this.previousTimeEnd)return this.metric("sourceBuffer.updateEnd.bufferFrozen",1),void this.eventListeners.onStreamFrozen();e.previousBufferSize&&e.currentBufferSize-e.previousBufferSize<this.options.minimumBufferIncrementSize&&this.metric("sourceBuffer.insufficientBufferAppends",1),this.previousTimeEnd=e.bufferTimeEnd,this.eventListeners.onAppendFinish(e),this.trimBuffer(e)}},{key:"onUpdateEnd",value:function(){this.silly("onUpdateEnd"),this.metric("sourceBuffer.updateEnd",1);try{if(this.sourceBuffer.buffered.length<=0)return this.metric("sourceBuffer.updateEnd.bufferLength.empty",1),void this.debug("After updating, the sourceBuffer has no length!")}catch(e){return this.metric("sourceBuffer.updateEnd.bufferLength.error",1),void this.debug("The mediaSource was removed while an update operation was occurring.")}var e=this.getBufferTimes();this.timeBuffered=e.currentBufferSize,null!==e.previousBufferSize&&e.previousBufferSize>this.timeBuffered?this.onRemoveFinish(e):this.onAppendFinish(e),this.processNextInQueue()}},{key:"destroy",value:function(){var e=this;return new Promise(function(n,r){if(e.destroyed||e.destroying)return n();e.debug("destroying..."),e.destroying=!0,e.abort(),e.sourceBuffer.removeEventListener("updateend",e.eventListeners.onUpdateEnd),e.sourceBuffer.removeEventListener("error",e.eventListeners.onError);var i=e,s=function e(){i&&i.destroyed||(i.sourceBuffer.removeEventListener("error",e),i.sourceBuffer=null,i.destroyed=!0,n())};e.sourceBuffer.addEventListener("updateend",s),e.trimBuffer(void 0,!0),e.timeBuffered=null,e.previousTimeEnd=null,e.segmentQueue=null,e.eventListeners=null,e.mediaSource=null,o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",e).call(e).then(s)})}}]),t}();s.DEFAULT_OPTIONS={bufferSizeLimit:90+Math.floor(200*Math.random()),bufferTruncateFactor:2,bufferTruncateValue:null,driftThreshold:2e3,minimumBufferIncrementSize:.5},s.EVENT_NAMES=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(r.default.EVENT_NAMES),["appendStart","appendFinish","removeFinish","appendError","removeError","streamFrozen","error"]),s.METRIC_TYPES=["sourceBuffer.instances","sourceBuffer.created","sourceBuffer.destroyed","sourceBuffer.queue.added","sourceBuffer.queue.removed","sourceBuffer.append","sourceBuffer.append.error","sourceBuffer.frameDrop.hiddenTab","sourceBuffer.queue.mediaSourceNotReady","sourceBuffer.queue.sourceBufferNotReady","sourceBuffer.queue.shift","sourceBuffer.queue.append","sourceBuffer.lastKnownBufferSize","sourceBuffer.insufficientBufferAppends","sourceBuffer.trim","sourceBuffer.trim.error","sourceBuffer.updateEnd","sourceBuffer.updateEnd.bufferLength.empty","sourceBuffer.updateEnd.bufferLength.error","sourceBuffer.updateEnd.removeEvent","sourceBuffer.updateEnd.appendEvent","sourceBuffer.updateEnd.bufferFrozen","sourceBuffer.abort","sourceBuffer.abort.error","sourceBuffer.lastMoofSize"],t.default=s},"./src/js/plugin/ClspPlugin.js":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/debug/src/browser.js"),o=n.n(r),i=n("./node_modules/paho-client/src/paho-mqtt.js"),s=n.n(i),a=n("video.js"),u=n.n(a),c=n("./src/js/utils/utils.js"),d=n("./src/js/plugin/MqttSourceHandler.js"),l=n("./src/js/plugin/MqttConduitCollection.js"),f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},h=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var m=u.a.getPlugin("plugin");t.default=function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=e=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));i.onMqttHandlerMetric=function(e,t){var n=t.metric;i.metric(n)},i.onMqttHandlerError=function(){i.player.tech(!0).mqtt.destroy(),i.player.error({code:0,type:"INSUFFICIENT_RESOURCES",headline:"Insufficient Resources",message:"The current hardware cannot support the current number of playing streams."})},i.debug=o()("skyline:clsp:plugin:ClspPlugin"),i.debug("constructing...");var s,a=e.options();return i.options=u.a.mergeOptions(f({},i.constructor.getDefaultOptions(),n,a.clsp||{}),r),i._playerOptions=a,i.currentSourceIndex=0,e.addClass("vjs-clsp"),i.options.customClass&&e.addClass(i.options.customClass),e.errors&&e.errors({timeout:12e4,errors:{PLAYER_ERR_NOT_COMPAT:{type:"PLAYER_ERR_NOT_COMPAT",headline:"This browser is unsupported.",message:"Chrome 52+ is required."}}}),c.default.supported()?(i.autoplayEnabled=a.autoplay||"true"===e.getAttribute("autoplay"),e._errorRetriesCount=0,e._currentTime=0,e.currentTime=function(){return e._currentTime++},e.on("ready",function(){i.autoplayEnabled&&setTimeout(function(){e.play()})}),e.on("changeSourceImmediately",function(){document.hidden||!a.sources||a.sources.length<=1||i.options.tourDuration&&(i.currentSourceIndex=i.currentSourceIndex>=i._playerOptions.sources.length-1?0:i.currentSourceIndex+1,i.player.trigger("changesrc",i._playerOptions.sources[i.currentSourceIndex]))}),e.on("readyForNextSource",function(){setTimeout(function(){e.trigger("changeSourceImmediately")},i.options.tourDuration)}),e.on("error",function(t){switch(e.error().code){case 0:case 4:case 5:case"PLAYER_ERR_IOV":break;default:if(0===i.options.maxRetriesOnError)break;if(i.options.maxRetriesOnError<0||e._errorRetriesCount<=i.options.maxRetriesOnError){e._errorRetriesCount++,i.metric({type:"videojs.errorRetriesCount",value:e._errorRetriesCount}),e.error(null),e.errorDisplay.close();var n=e.tech(!0).mqtt.iov;n&&!n.destroyed&&n.player?n.player.restart():i.initializeIOV(e)}}}),e.on("firstplay",function(t){i.debug("on player firstplay"),i.initializeIOV(e)}),e.on("dispose",function(){var t=e.tech(!0).mqtt;if(!t)throw new Error("VideoJS Player "+e.id()+" does not have mqtt tech!");t.destroy()}),i):(s=e.error({code:"PLAYER_ERR_NOT_COMPAT",type:"PLAYER_ERR_NOT_COMPAT",dismiss:!1}),p(i,s))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,m),h(t,null,[{key:"register",value:function(){if(u.a.getPlugin(c.default.name))throw new Error("You can only register the clsp plugin once, and it has already been registered.");window.Paho=s.a;var e=d.default.factory("html5",t.conduits);return u.a.getTech("Html5").registerSourceHandler(e,0),u.a.registerPlugin(c.default.name,t),t}},{key:"getDefaultOptions",value:function(){return{maxRetriesOnError:-1,tourDuration:1e4,enableMetrics:!1}}}]),h(t,[{key:"initializeIOV",value:function(e){var t=e.tech(!0).mqtt;if(!t)throw new Error("VideoJS Player "+e.id()+" does not have mqtt tech!");t.off("metric",this.onMqttHandlerMetric),t.on("metric",this.onMqttHandlerMetric),t.off("error",this.onMqttHandlerError),t.on("error",this.onMqttHandlerError),t.createIOV(e,{enableMetrics:this.options.enableMetrics,defaultNonSslPort:this.options.defaultNonSslPort,defaultSslPort:this.options.defaultSslPort})}},{key:"metric",value:function(e){this.options.enableMetrics&&this.trigger("metric",{metric:e})}},{key:"destroy",value:function(){this.debug("destroying..."),this.player.tech(!0).mqtt.off("metric",this.onMqttHandlerMetric),this._playerOptions=null,this.currentSourceIndex=null,this.debug=null}}]),t}(),e.VERSION=c.default.version,e.utils=c.default,e.conduits=l.default.factory(),e.METRIC_TYPES=["videojs.errorRetriesCount"],t}},"./src/js/plugin/MqttConduitCollection.js":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/debug/src/browser.js"),o=n.n(r),i=n("./src/js/iov/Conduit.js"),s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var a=void 0,u=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onMessage=function(e){t.silly("window on message");var n=e.data.clientId;t.exists(n)?t.getById(n).iov.onMessage(e):"fail"===!e.data.event&&console.error('No conduit with id "'+n+'" exists!')},this.debug=o()("skyline:clsp:plugin:MqttConduitCollection"),this.silly=o()("skyline:silly:clsp:plugin:MqttConduitCollection"),this.debug("constructing..."),this._conduits={},window.addEventListener("message",this.onMessage)}return s(e,null,[{key:"factory",value:function(){return a||(a=new e),a}}]),s(e,[{key:"set",value:function(e,t){return this.debug("setting...",e,t),this._conduits[e]=t,t}},{key:"getById",value:function(e){return this.silly("getting...",e),this._conduits[e]}},{key:"exists",value:function(e){return this.silly("exists?",e),this._conduits.hasOwnProperty(e)}},{key:"remove",value:function(e){delete this._conduits[e]}},{key:"addFromIov",value:function(e,t){this.debug("adding from iov...",e);var n=this.exists(e.id)?this.getById(e.id):i.default.factory(e,t);return this.set(e.id,n)}},{key:"destroy",value:function(){this.debug("destroying..."),this._conduits=null,this.debug=null,this.silly=null,window.removeEventListener("message",this.onMessage)}}]),e}();t.default=u},"./src/js/plugin/MqttHandler.js":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/debug/src/browser.js"),o=n.n(r),i=n("video.js"),s=n.n(i),a=n("./src/js/iov/IOV.js"),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var d=s.a.getComponent("Component"),l=function(e){function t(e,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n,i.mqtt));return s.onVisibilityChange=function(){var e=document.hidden;s.debug("detected tab visibility change.  tab is now "+(e?"hidden":"visible")),e?s.destroyIOV():s.recreateIOV(!1)},s.debug=o()("skyline:clsp:plugin:MqttHandler"),s.debug("constructor"),s.destroyed=!1,s.tech_=n,s.source_=e,s.iov=null,s.conduits=r,document.addEventListener("visibilitychange",s.onVisibilityChange),s}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,d),c(t,[{key:"metric",value:function(e){this.trigger("metric",{metric:e})}},{key:"createIOV",value:function(e,t){this.debug("createIOV"),this.updateIOV(a.default.fromUrl(this.source_.src,this.conduits,e,{},t)),this.iov.initialize()}},{key:"updateIOV",value:function(e){var t=this;this.debug("updateIOV");var n=Boolean(this.iov),r=!1;if(this.iov){if(this.iov.id===e.id)return;this.iov.destroy(),r=!0}this.iov=e,!r&&n||(this.iov.on("onReadyCalledMultipleTimes",function(){t.destroyIOV(),t.recreateIOV()}),this.iov.on("metric",function(e){t.metric(e)}),this.iov.on("criticalError",function(e){console.error(e),t.destroyIOV(),t.trigger("error")}))}},{key:"destroyIOV",value:function(){this.iov&&(this._oldIovVideoJsPlayer=this.iov.videoJsPlayer,this._oldIovOptions=this.iov.options,this.iov.destroy(),this.iov=null)}},{key:"recreateIOV",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.createIOV(this._oldIovVideoJsPlayer,u({},this._oldIovOptions,{changeSourceImmediately:e})),this._oldIovVideoJsPlayer=null,this._oldIovOptions=null}},{key:"destroy",value:function(){this.destroyed||(this.destroyed=!0,this.debug("destroying..."),document.removeEventListener("visibilitychange",this.onVisibilityChange),this._oldIovVideoJsPlayer=null,this._oldIovOptions=null,this.iov.destroy(),this.iov=null,this.dispose(),this.debug=null,this.tech_=null,this.source_=null,this.conduits=null)}}]),t}();t.default=l},"./src/js/plugin/MqttSourceHandler.js":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/debug/src/browser.js"),o=n.n(r),i=n("video.js"),s=n.n(i),a=n("./src/js/plugin/MqttHandler.js"),u=n("./src/js/utils/utils.js"),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var d=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.debug=o()("skyline:clsp:plugin:MqttSourceHandler"),this.debug("constructor"),this.name=u.default.name,this.VERSION=u.default.version,this.mode=t,this.conduits=n,this.defaultLocalOptions={mqtt:{mode:this.mode}}}return c(e,null,[{key:"factory",value:function(t,n){return new e(t,n)}}]),c(e,[{key:"canHandleSource",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.debug("canHandleSource"),e.src?e.src.startsWith("clsp")?u.default.supported()?this.canPlayType(e.type):(this.debug("Browser not supported. Chrome 52+ is required."),!1):(console.error("srcObj.src is not clsp protocol"),!1):(console.error("srcObj doesn't contain src"),this.debug(e),!1)}},{key:"handleSource",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.debug("handleSource");var r=s.a.mergeOptions(s.a.options,n,this.defaultLocalOptions);return t.mqtt=new a.default(e,t,this.conduits,r),t.mqtt}},{key:"canPlayType",value:function(e){return this.debug("canPlayType"),u.default.isSupportedMimeType(e)?(this.debug("found supported mime type"),"maybe"):(this.debug("mime type not supported"),"")}},{key:"destroy",value:function(){this.debug("destroying..."),this.debug=null,this.name=null,this.VERSION=null,this.mode=null,this.conduits=null,this.defaultLocalOptions=null}}]),e}();t.default=d},"./src/js/utils/ListenerBaseClass.js":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/debug/src/browser.js"),o=n.n(r),i=n("./node_modules/lodash/defaults.js"),s=n.n(i),a=n("./node_modules/uuid/v4.js"),u=n.n(a),c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=u()(),this._debugId="skyline:clsp:"+this.constructor.name+":"+this.id,this.debug=o()(this._debugId),this.silly=o()("silly:"+this._debugId),this.debug("Constructing..."),this.options=s()({},t,this.constructor.DEFAULT_OPTIONS),this.metrics={},this.events={};for(var n=0;n<this.constructor.EVENT_NAMES.length;n++)this.events[this.constructor.EVENT_NAMES[n]]=[];this.firstMetricListenerRegistered=!1,this.destroyed=!1}return c(e,[{key:"onFirstMetricListenerRegistered",value:function(){this.debug("onFirstMetricListenerRegistered..."),this.firstMetricListenerRegistered=!0}},{key:"on",value:function(e,t){this.debug("Registering Listener for "+e+" event..."),this.constructor.EVENT_NAMES.includes(e)?(this.events[e].push(t),"metric"!==e||this.firstMetricListenerRegistered||this.onFirstMetricListenerRegistered()):console.warn('"'+e+'" is not a valid event."')}},{key:"trigger",value:function(e,t){if("metric"===e?this.silly("Triggering "+e+" event..."):this.debug("Triggering "+e+" event..."),!this.constructor.EVENT_NAMES.includes(e))throw new Error('"'+e+'" is not a valid event."');for(var n=0;n<this.events[e].length;n++)this.events[e][n](t,this)}},{key:"metric",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.options&&this.options.enableMetrics&&(n||this.constructor.METRIC_TYPES.includes(e))){switch(e){case"iov.clientId":case"iovConduit.clientId":case"iovConduit.guid":case"iovConduit.mimeCodec":case"iovPlayer.clientId":case"iovPlayer.video.currentTime":case"iovPlayer.video.drift":case"iovPlayer.video.segmentInterval":case"iovPlayer.video.segmentIntervalAverage":case"iovPlayer.mediaSource.sourceBuffer.bufferTimeEnd":case"iovPlayer.mediaSource.sourceBuffer.genericErrorRestartCount":case"sourceBuffer.lastKnownBufferSize":case"sourceBuffer.lastMoofSize":this.metrics[e]=t;break;default:this.metrics.hasOwnProperty(e)||(this.metrics[e]=0),this.metrics[e]+=t}this.trigger("metric",{type:e,value:this.metrics[e]})}}},{key:"destroy",value:function(){var e=this;return this.firstMetricListenerRegistered=null,new Promise(function(t,n){setTimeout(function(){e.metrics=null,e.events=null,e.debug=null,e.silly=null,e.options=null,t()},e.options.destroyWait)})}}]),e}();d.DEBUG_PREFIX="skyline:clsp:utils:ListenerBaseClass",d.DEFAULT_OPTIONS={enableMetrics:!1,destroyWait:6e4},d.EVENT_NAMES=["metric"],d.METRIC_TYPES=[],t.default=d},"./src/js/utils/utils.js":function(e,t,n){"use strict";n.r(t);var r=n("./package.json"),o=52,i="video/mp4; codecs='avc1.42E01E'";t.default={version:r.version,name:"clsp",supported:function(){if(!Boolean(window.chrome)||!Boolean(window.chrome.webstore))return!1;if(window.MediaSource=window.MediaSource||window.WebKitMediaSource,!window.MediaSource)return console.error("Media Source Extensions not supported in your browser: Claris Live Streaming will not work!"),!1;try{return parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10)>=o}catch(e){return console.error(e),!1}},isSupportedMimeType:function(e){return e===i}}},"./src/styles/clsp-videojs-plugin.scss":function(e,t){},0:function(e,t,n){e.exports=n("./src/js/clsp-videojs-plugin.js")},"video.js":function(e,t){e.exports=videojs}});